/* Generated by Cython 0.9.8.1.1 on Sun Oct 26 17:32:44 2008 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#if PY_VERSION_HEX < 0x02040000
  #define METH_COEXIST 0
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   PyInt_AsLong(o)
  #define PyNumber_Index(o)    PyNumber_Int(o)
  #define PyIndex_Check(o)     PyNumber_Check(o)
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)

  typedef struct {
       void *buf;
       Py_ssize_t len;
       int readonly;
       const char *format;
       int ndim;
       Py_ssize_t *shape;
       Py_ssize_t *strides;
       Py_ssize_t *suboffsets;
       Py_ssize_t itemsize;
       void *internal;
  } Py_buffer;

  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_LOCK 0x0002
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)

#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyString_Type                PyBytes_Type
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define PyBytes_Type                 PyString_Type
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) PyInstanceMethod_New(func)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
#else
  #define _USE_MATH_DEFINES
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#define __PYX_HAVE_API__realtime_image_analysis
#include "unistd.h"
#include "eigen.h"
#include "motmot_ipp_macros.h"
#include "c_time_time.h"
#include "stdlib.h"
#include "math.h"
#include "ads_wrap_system.h"
#include "stdio.h"
#include "fi_ipp.h"
#include "c_fit_params.h"


#ifdef __GNUC__
#define INLINE __inline__
#elif _WIN32
#define INLINE __inline
#else
#define INLINE 
#endif

typedef struct {PyObject **p; char *s; long n; char is_unicode; char intern; char is_identifier;} __Pyx_StringTabEntry; /*proto*/



static int __pyx_skip_dispatch = 0;


/* Type Conversion Predeclarations */

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyBytes_FromString PyString_FromString
#define __Pyx_PyBytes_AsString   PyString_AsString
#else
#define __Pyx_PyBytes_FromString PyBytes_FromString
#define __Pyx_PyBytes_AsString   PyBytes_AsString
#endif

#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static INLINE int __Pyx_PyObject_IsTrue(PyObject* x);
static INLINE PY_LONG_LONG __pyx_PyInt_AsLongLong(PyObject* x);
static INLINE unsigned PY_LONG_LONG __pyx_PyInt_AsUnsignedLongLong(PyObject* x);
static INLINE Py_ssize_t __pyx_PyIndex_AsSsize_t(PyObject* b);

#define __pyx_PyInt_AsLong(x) (PyInt_CheckExact(x) ? PyInt_AS_LONG(x) : PyInt_AsLong(x))
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))

static INLINE unsigned char __pyx_PyInt_unsigned_char(PyObject* x);
static INLINE unsigned short __pyx_PyInt_unsigned_short(PyObject* x);
static INLINE char __pyx_PyInt_char(PyObject* x);
static INLINE short __pyx_PyInt_short(PyObject* x);
static INLINE int __pyx_PyInt_int(PyObject* x);
static INLINE long __pyx_PyInt_long(PyObject* x);
static INLINE signed char __pyx_PyInt_signed_char(PyObject* x);
static INLINE signed short __pyx_PyInt_signed_short(PyObject* x);
static INLINE signed int __pyx_PyInt_signed_int(PyObject* x);
static INLINE signed long __pyx_PyInt_signed_long(PyObject* x);
static INLINE long double __pyx_PyInt_long_double(PyObject* x);
#ifdef __GNUC__
/* Test for GCC > 2.95 */
#if __GNUC__ > 2 ||               (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
#define likely(x)   __builtin_expect(!!(x), 1)
#define unlikely(x) __builtin_expect(!!(x), 0)
#else /* __GNUC__ > 2 ... */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ */
    
static PyObject *__pyx_m;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;
static const char **__pyx_f;

static INLINE int __Pyx_SplitStarArg(PyObject **args, Py_ssize_t nargs, PyObject **args2); /*proto*/

static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name, int kw_allowed); /*proto*/

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed, char *name, int exact); /*proto*/

static INLINE void __Pyx_RaiseArgtupleTooLong(Py_ssize_t num_expected, Py_ssize_t num_found); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, char *modname); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static int __Pyx_Print(PyObject *, int); /*proto*/
#if PY_MAJOR_VERSION >= 3
static PyObject* __pyx_print = 0;
static PyObject* __pyx_print_kwargs = 0;
#endif

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/

static INLINE PyObject* __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (PyList_Append(L, x) < 0) return NULL;
        Py_INCREF(Py_None);
        return Py_None; // this is just to have an accurate signature
    }
    else {
        return PyObject_CallMethod(L, "append", "(O)", x);
    }
}

static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name, long size);  /*proto*/

static PyObject *__Pyx_ImportModule(char *name); /*proto*/

static int __Pyx_GetVtable(PyObject *dict, void *vtabptr); /*proto*/

static void __Pyx_AddTraceback(const char *funcname); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

/* Type declarations */

typedef void *__pyx_t_6motmot_9FastImage_9FastImage_fiptr;

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":68
 *     pass
 * 
 * cdef class FitParamsClass:             # <<<<<<<<<<<<<<
 *     cdef ipp.IppiMomentState_64f *pState
 *     def __cinit__(self,*args,**kw):
 */

struct __pyx_obj_23realtime_image_analysis_FitParamsClass {
  PyObject_HEAD
  IppiMomentState_64f *pState;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":44
 * # normal symbols (e.g. +=).
 * 
 * cdef class LazyOp:             # <<<<<<<<<<<<<<
 *     pass
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp {
  PyObject_HEAD
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":50
 *     cdef FastImageBase base
 * 
 * cdef class sqrt(LazyOp):             # <<<<<<<<<<<<<<
 *     cdef FastImageBase base
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_sqrt {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp __pyx_base;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase *base;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":9
 *     cdef ipp.IppiSize sz
 * 
 * cdef class Point:             # <<<<<<<<<<<<<<
 *     cdef ipp.IppiPoint pt
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_Point {
  PyObject_HEAD
  IppiPoint pt;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":47
 *     pass
 * 
 * cdef class square(LazyOp):             # <<<<<<<<<<<<<<
 *     cdef FastImageBase base
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_square {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp __pyx_base;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase *base;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":12
 *     cdef ipp.IppiPoint pt
 * 
 * cdef class FastImageBase:             # <<<<<<<<<<<<<<
 *     cdef fiptr im
 *     cdef c_python.Py_intptr_t shape[2] # don't use, purely for making __array_struct__ without extra malloc
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase {
  PyObject_HEAD
  struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImageBase *__pyx_vtab;
  __pyx_t_6motmot_9FastImage_9FastImage_fiptr im;
  Py_intptr_t shape[2];
  Py_intptr_t strides[2];
  int step;
  int view;
  PyObject *basetype;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *imsiz;
  PyObject *source_data;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":26
 * cdef class FastImage32f(FastImageBase) # forward definition
 * 
 * cdef class FastImage8u(FastImageBase):             # <<<<<<<<<<<<<<
 *     cdef void fast_get_absdiff_put(self, FastImage8u other, FastImage8u result, Size size)
 *     cdef void fast_get_sub_put(self, FastImage8u other, FastImage8u result, Size size)
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase __pyx_base;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":6
 * ctypedef void* fiptr # pointer to FastImage base type
 * 
 * cdef class Size:             # <<<<<<<<<<<<<<
 *     cdef ipp.IppiSize sz
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_Size {
  PyObject_HEAD
  IppiSize sz;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":59
 *     cdef float alpha
 * 
 * cdef class convert_to_8u(LazyOp):             # <<<<<<<<<<<<<<
 *     cdef FastImage32f orig32f
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_convert_to_8u {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp __pyx_base;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *orig32f;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":24
 *     cdef FastImageBase c_roi( self, int left, int bottom, Size size)
 * 
 * cdef class FastImage32f(FastImageBase) # forward definition             # <<<<<<<<<<<<<<
 * 
 * cdef class FastImage8u(FastImageBase):
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase __pyx_base;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":119
 *     return fpc.fit(im)
 * 
 * cdef class RealtimeAnalyzer:             # <<<<<<<<<<<<<<
 * 
 *     # full image size
 */

struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer {
  PyObject_HEAD
  int maxwidth;
  int maxheight;
  int _left;
  int _bottom;
  int _right;
  int _top;
  int _roi2_radius;
  Ipp8u _diff_threshold;
  float _clear_threshold;
  Ipp8u _despeckle_threshold;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *_roi_sz;
  int n_rot_samples;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *absdiff_im;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *cmpdiff_im;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *absdiff_im_roi_view;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *cmpdiff_im_roi_view;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *absdiff_im_roi2_view;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *cmpdiff_im_roi2_view;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *mask_im;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *mean_im;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *cmp_im;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *mean_im_roi_view;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *cmp_im_roi_view;
  IppiMomentState_64f *pState;
  PyObject *imname2im;
  int max_num_points;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":62
 *     cdef FastImage32f orig32f
 * 
 * cdef class convert_to_32f(LazyOp):             # <<<<<<<<<<<<<<
 *     cdef FastImage8u orig8u
 * 
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_convert_to_32f {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp __pyx_base;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *orig8u;
};

/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":55
 * # for use with %= ############
 * 
 * cdef class blend_with(LazyOp):             # <<<<<<<<<<<<<<
 *     cdef FastImage8u other8u
 *     cdef float alpha
 */

struct __pyx_obj_6motmot_9FastImage_9FastImage_blend_with {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp __pyx_base;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *other8u;
  float alpha;
};


/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":12
 *     cdef ipp.IppiPoint pt
 * 
 * cdef class FastImageBase:             # <<<<<<<<<<<<<<
 *     cdef fiptr im
 *     cdef c_python.Py_intptr_t shape[2] # don't use, purely for making __array_struct__ without extra malloc
 */

struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImageBase {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase *(*c_roi)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase *, int, int, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
};
static struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImageBase *__pyx_vtabptr_6motmot_9FastImage_9FastImage_FastImageBase;


/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":26
 * cdef class FastImage32f(FastImageBase) # forward definition
 * 
 * cdef class FastImage8u(FastImageBase):             # <<<<<<<<<<<<<<
 *     cdef void fast_get_absdiff_put(self, FastImage8u other, FastImage8u result, Size size)
 *     cdef void fast_get_sub_put(self, FastImage8u other, FastImage8u result, Size size)
 */

struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImage8u {
  struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImageBase __pyx_base;
  void (*fast_get_absdiff_put)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_get_sub_put)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_set_val_masked)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, Ipp8u, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_get_32f_copy_put)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_get_compare_int_put_greater)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, int, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
};
static struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_vtabptr_6motmot_9FastImage_9FastImage_FastImage8u;


/* "/home/astraw/src/motmot/realtime_image_analysis/src/motmot.FastImage.FastImage.pxd":24
 *     cdef FastImageBase c_roi( self, int left, int bottom, Size size)
 * 
 * cdef class FastImage32f(FastImageBase) # forward definition             # <<<<<<<<<<<<<<
 * 
 * cdef class FastImage8u(FastImageBase):
 */

struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImage32f {
  struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImageBase __pyx_base;
  void (*fast_toself_add_weighted_8u)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *, float);
  void (*fast_toself_add_weighted_32f)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *, float);
  void (*fast_get_8u_copy_put)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_toself_square)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_get_square_put)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_get_subtracted_put)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
  void (*fast_toself_multiply)(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *, float, struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *);
};
static struct __pyx_vtabstruct_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_vtabptr_6motmot_9FastImage_9FastImage_FastImage32f;
/* Module declarations from c_lib */

/* Module declarations from c_python */

/* Module declarations from ipp */

/* Module declarations from motmot.FastImage.FastImage */

static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_Size = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_Point = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_FastImageBase = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_LazyOp = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_square = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_sqrt = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_blend_with = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_convert_to_8u = 0;
static PyTypeObject *__pyx_ptype_6motmot_9FastImage_9FastImage_convert_to_32f = 0;
/* Module declarations from fit_params */

/* Module declarations from realtime_image_analysis */

static PyTypeObject *__pyx_ptype_23realtime_image_analysis_FitParamsClass = 0;
static PyTypeObject *__pyx_ptype_23realtime_image_analysis_RealtimeAnalyzer = 0;
static double __pyx_v_23realtime_image_analysis_nan;
static void __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(IppStatus); /*proto*/
static PyObject *__pyx_f_23realtime_image_analysis_print_8u_arr(Ipp8u *, int, int, int); /*proto*/


/* Implementation of realtime_image_analysis */
static char __pyx_k_2[] = "*";
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_21;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_200;
static PyObject *__pyx_int_25;
static char __pyx_k___cinit__[] = "__cinit__";
static PyObject *__pyx_kp___cinit__;
static char __pyx_k___dealloc__[] = "__dealloc__";
static PyObject *__pyx_kp___dealloc__;
static char __pyx_k_fit[] = "fit";
static PyObject *__pyx_kp_fit;
static char __pyx_k___init__[] = "__init__";
static PyObject *__pyx_kp___init__;
static char __pyx_k_distort[] = "distort";
static PyObject *__pyx_kp_distort;
static char __pyx_k_do_work[] = "do_work";
static PyObject *__pyx_kp_do_work;
static char __pyx_k_get_image_view[] = "get_image_view";
static PyObject *__pyx_kp_get_image_view;
static char __pyx_k_time[] = "time";
static PyObject *__pyx_kp_time;
static char __pyx_k_numpy[] = "numpy";
static PyObject *__pyx_kp_numpy;
static char __pyx_k_nx[] = "nx";
static PyObject *__pyx_kp_nx;
static char __pyx_k_warnings[] = "warnings";
static PyObject *__pyx_kp_warnings;
static char __pyx_k_1[] = "motmot.FastImage.FastImage";
static PyObject *__pyx_kp_1;
static char __pyx_k_FastImage[] = "FastImage";
static PyObject *__pyx_kp_FastImage;
static char __pyx_k_nan[] = "nan";
static PyObject *__pyx_kp_nan;
static char __pyx_k_FitParamsError[] = "FitParamsError";
static PyObject *__pyx_kp_FitParamsError;
static char __pyx_k_Exception[] = "Exception";
static PyObject *__pyx_kp_Exception;
static char __pyx_k_3[] = "mean";
static PyObject *__pyx_kp_3;
static char __pyx_k_IppError[] = "IppError";
static PyObject *__pyx_kp_IppError;
static char __pyx_k_set_val[] = "set_val";
static PyObject *__pyx_kp_set_val;
static char __pyx_k_6[] = "absdiff";
static PyObject *__pyx_kp_6;
static char __pyx_k_7[] = "mean";
static PyObject *__pyx_kp_7;
static char __pyx_k_8[] = "mask";
static PyObject *__pyx_kp_8;
static char __pyx_k_9[] = "cmp";
static PyObject *__pyx_kp_9;
static char __pyx_k_10[] = "cmpdiff";
static PyObject *__pyx_kp_10;
static char __pyx_k_roi[] = "roi";
static PyObject *__pyx_kp_roi;
static char __pyx_k__helper[] = "_helper";
static PyObject *__pyx_kp__helper;
static char __pyx_k_ValueError[] = "ValueError";
static PyObject *__pyx_kp_ValueError;
static char __pyx_k_warn[] = "warn";
static PyObject *__pyx_kp_warn;
static char __pyx_k_stacklevel[] = "stacklevel";
static PyObject *__pyx_kp_stacklevel;
static char __pyx_k_append[] = "append";
static PyObject *__pyx_kp_append;
static char __pyx_k__scale_factor[] = "_scale_factor";
static PyObject *__pyx_kp__scale_factor;
static char __pyx_k_toself_add_weighted[] = "toself_add_weighted";
static PyObject *__pyx_kp_toself_add_weighted;
static char __pyx_k_19[] = "get_8u_copy_put";
static PyObject *__pyx_kp_19;
static char __pyx_k_20[] = "get_32f_copy_put";
static PyObject *__pyx_kp_20;
static char __pyx_k_toself_square[] = "toself_square";
static PyObject *__pyx_kp_toself_square;
static char __pyx_k_get_square_put[] = "get_square_put";
static PyObject *__pyx_kp_get_square_put;
static char __pyx_k_get_subtracted_put[] = "get_subtracted_put";
static PyObject *__pyx_kp_get_subtracted_put;
static char __pyx_k_toself_multiply[] = "toself_multiply";
static PyObject *__pyx_kp_toself_multiply;
static char __pyx_k_get_compare_put[] = "get_compare_put";
static PyObject *__pyx_kp_get_compare_put;
static char __pyx_k_CmpGreater[] = "CmpGreater";
static PyObject *__pyx_kp_CmpGreater;
static char __pyx_k_set_val_masked[] = "set_val_masked";
static PyObject *__pyx_kp_set_val_masked;
static PyObject *__pyx_kp_2;
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_ValueError;
static PyObject *__pyx_kp_4;
static char __pyx_k_4[] = "%d";
static PyObject *__pyx_kp_5;
static char __pyx_k_5[] = "fit_params error %d";
static PyObject *__pyx_kp_11;
static PyObject *__pyx_kp_12;
static char __pyx_k_11[] = "input image size (%s) does not correspond to ROI (%s)(set RealtimeAnalyzer.roi before calling)";
static char __pyx_k_12[] = "stopped looking for points (this frame only) because it was taking longer than max_duration_sec";
static PyObject *__pyx_kp_13;
static char __pyx_k_13[] = "setting scale_factor to";
static PyObject *__pyx_kp_14;
static PyObject *__pyx_kp_15;
static PyObject *__pyx_kp_16;
static PyObject *__pyx_kp_17;
static char __pyx_k_14[] = "attempting to set ROI left %d";
static char __pyx_k_15[] = "attempting to set ROI bottom %d";
static char __pyx_k_16[] = "attempting to set ROI right to %d (width %d)";
static char __pyx_k_17[] = "attempting to set ROI top to %d (height %d)";
static PyObject *__pyx_kp_18;
static char __pyx_k_18[] = "unknown result (%d)";

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":44
 *     double time_time()
 * 
 * cdef void CHK_HAVEGIL( ipp.IppStatus errval ) except *:             # <<<<<<<<<<<<<<
 *     if (errval != ipp.ippStsNoErr):
 *         raise FastImage.IppError(errval)
 */

static  void __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(IppStatus __pyx_v_errval) {
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":45
 * 
 * cdef void CHK_HAVEGIL( ipp.IppStatus errval ) except *:
 *     if (errval != ipp.ippStsNoErr):             # <<<<<<<<<<<<<<
 *         raise FastImage.IppError(errval)
 * 
 */
  __pyx_1 = (__pyx_v_errval != ippStsNoErr);
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":46
 * cdef void CHK_HAVEGIL( ipp.IppStatus errval ) except *:
 *     if (errval != ipp.ippStsNoErr):
 *         raise FastImage.IppError(errval)             # <<<<<<<<<<<<<<
 * 
 * ##cdef void SET_ERR( int errval ):
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_FastImage); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = PyObject_GetAttr(__pyx_2, __pyx_kp_IppError); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyInt_FromLong(__pyx_v_errval); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyTuple_New(1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_2 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_4), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L3;
  }
  __pyx_L3:;

  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("realtime_image_analysis.CHK_HAVEGIL");
  __pyx_L0:;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":55
 * ##    c_lib.exit(2)
 * 
 * cdef print_8u_arr(ipp.Ipp8u* src,int width,int height,int src_step):             # <<<<<<<<<<<<<<
 *   cdef int row, col
 *   cdef ipp.Ipp8u* src_rowstart
 */

static  PyObject *__pyx_f_23realtime_image_analysis_print_8u_arr(Ipp8u *__pyx_v_src, int __pyx_v_width, int __pyx_v_height, int __pyx_v_src_step) {
  int __pyx_v_row;
  int __pyx_v_col;
  Ipp8u *__pyx_v_src_rowstart;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":58
 *   cdef int row, col
 *   cdef ipp.Ipp8u* src_rowstart
 *   for row from 0 <= row < height:             # <<<<<<<<<<<<<<
 *     src_rowstart = src+(row*src_step);
 *     for col from 0 <= col < width:
 */
  for (__pyx_v_row = 0; __pyx_v_row < __pyx_v_height; __pyx_v_row++) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":59
 *   cdef ipp.Ipp8u* src_rowstart
 *   for row from 0 <= row < height:
 *     src_rowstart = src+(row*src_step);             # <<<<<<<<<<<<<<
 *     for col from 0 <= col < width:
 *       print "%d"%src_rowstart[col],
 */
    __pyx_v_src_rowstart = (__pyx_v_src + (__pyx_v_row * __pyx_v_src_step));

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":60
 *   for row from 0 <= row < height:
 *     src_rowstart = src+(row*src_step);
 *     for col from 0 <= col < width:             # <<<<<<<<<<<<<<
 *       print "%d"%src_rowstart[col],
 *     print
 */
    for (__pyx_v_col = 0; __pyx_v_col < __pyx_v_width; __pyx_v_col++) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":61
 *     src_rowstart = src+(row*src_step);
 *     for col from 0 <= col < width:
 *       print "%d"%src_rowstart[col],             # <<<<<<<<<<<<<<
 *     print
 *   print
 */
      __pyx_1 = PyInt_FromLong((__pyx_v_src_rowstart[__pyx_v_col])); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = PyNumber_Remainder(__pyx_kp_4, __pyx_1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
      __pyx_2 = 0;
      if (__Pyx_Print(((PyObject *)__pyx_1), 0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    }

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":62
 *     for col from 0 <= col < width:
 *       print "%d"%src_rowstart[col],
 *     print             # <<<<<<<<<<<<<<
 *   print
 * 
 */
    if (__Pyx_Print(((PyObject *)__pyx_empty_tuple), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":63
 *       print "%d"%src_rowstart[col],
 *     print
 *   print             # <<<<<<<<<<<<<<
 * 
 * class FitParamsError(Exception):
 */
  if (__Pyx_Print(((PyObject *)__pyx_empty_tuple), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("realtime_image_analysis.print_8u_arr");
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":70
 * cdef class FitParamsClass:
 *     cdef ipp.IppiMomentState_64f *pState
 *     def __cinit__(self,*args,**kw):             # <<<<<<<<<<<<<<
 *         # image moment calculation initialization
 *         CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &self.pState, ipp.ippAlgHintFast ) )
 */

static int __pyx_pf_23realtime_image_analysis_14FitParamsClass___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_23realtime_image_analysis_14FitParamsClass___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kw = 0;
  int __pyx_r;
  if (unlikely(__pyx_kwds)) {
    if (unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 1))) return -1;
  }
  __pyx_v_kw = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kw)) return -1;
  Py_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":72
 *     def __cinit__(self,*args,**kw):
 *         # image moment calculation initialization
 *         CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &self.pState, ipp.ippAlgHintFast ) )             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
  __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(ippiMomentInitAlloc_64f((&((struct __pyx_obj_23realtime_image_analysis_FitParamsClass *)__pyx_v_self)->pState), ippAlgHintFast)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.FitParamsClass.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_kw);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":74
 *         CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &self.pState, ipp.ippAlgHintFast ) )
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( self.pState ))
 * 
 */

static void __pyx_pf_23realtime_image_analysis_14FitParamsClass___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pf_23realtime_image_analysis_14FitParamsClass___dealloc__(PyObject *__pyx_v_self) {

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":75
 * 
 *     def __dealloc__(self):
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( self.pState ))             # <<<<<<<<<<<<<<
 * 
 *     def fit(self,FastImage.FastImage8u im):
 */
  __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(ippiMomentFree_64f(((struct __pyx_obj_23realtime_image_analysis_FitParamsClass *)__pyx_v_self)->pState)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.FitParamsClass.__dealloc__");
  __pyx_L0:;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":77
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( self.pState ))
 * 
 *     def fit(self,FastImage.FastImage8u im):             # <<<<<<<<<<<<<<
 *         cdef double x0, y0
 *         cdef double Mu00, Uu11, Uu02, Uu20
 */

static PyObject *__pyx_pf_23realtime_image_analysis_14FitParamsClass_fit(PyObject *__pyx_v_self, PyObject *__pyx_v_im); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_14FitParamsClass_fit(PyObject *__pyx_v_self, PyObject *__pyx_v_im) {
  double __pyx_v_x0;
  double __pyx_v_y0;
  double __pyx_v_Mu00;
  double __pyx_v_Uu11;
  double __pyx_v_Uu02;
  double __pyx_v_Uu20;
  int __pyx_v_result;
  int __pyx_v_eigen_err;
  double __pyx_v_area;
  double __pyx_v_rise;
  double __pyx_v_run;
  double __pyx_v_slope;
  double __pyx_v_eccentricity;
  double __pyx_v_evalA;
  double __pyx_v_evalB;
  double __pyx_v_evecA1;
  double __pyx_v_evecB1;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":91
 *                                         im.imsiz.sz.width, im.imsiz.sz.height,
 *                                         <unsigned char*>im.im,
 *                                         im.step)             # <<<<<<<<<<<<<<
 *         if result != fit_params.CFitParamsNoError:
 *             raise FitParamsError('fit_params error %d'%result)
 */
  __pyx_v_result = fit_params(((struct __pyx_obj_23realtime_image_analysis_FitParamsClass *)__pyx_v_self)->pState, (&__pyx_v_x0), (&__pyx_v_y0), (&__pyx_v_Mu00), (&__pyx_v_Uu11), (&__pyx_v_Uu20), (&__pyx_v_Uu02), ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.imsiz->sz.width, ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.imsiz->sz.height, ((unsigned char *)((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.im), ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.step);

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":92
 *                                         <unsigned char*>im.im,
 *                                         im.step)
 *         if result != fit_params.CFitParamsNoError:             # <<<<<<<<<<<<<<
 *             raise FitParamsError('fit_params error %d'%result)
 * 
 */
  __pyx_1 = (__pyx_v_result != CFitParamsNoError);
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":93
 *                                         im.step)
 *         if result != fit_params.CFitParamsNoError:
 *             raise FitParamsError('fit_params error %d'%result)             # <<<<<<<<<<<<<<
 * 
 *         area = Mu00
 */
    __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_FitParamsError); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = PyInt_FromLong(__pyx_v_result); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyNumber_Remainder(__pyx_kp_5, __pyx_3); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyTuple_New(1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_4);
    __pyx_4 = 0;
    __pyx_4 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
    __Pyx_Raise(__pyx_4, 0, 0);
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":95
 *             raise FitParamsError('fit_params error %d'%result)
 * 
 *         area = Mu00             # <<<<<<<<<<<<<<
 *         eigen_err = eigen_2x2_real( Uu20, Uu11,
 *                                     Uu11, Uu02,
 */
  __pyx_v_area = __pyx_v_Mu00;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":99
 *                                     Uu11, Uu02,
 *                                     &evalA, &evecA1,
 *                                     &evalB, &evecB1)             # <<<<<<<<<<<<<<
 *         if eigen_err:
 *             slope = nan
 */
  __pyx_v_eigen_err = eigen_2x2_real(__pyx_v_Uu20, __pyx_v_Uu11, __pyx_v_Uu11, __pyx_v_Uu02, (&__pyx_v_evalA), (&__pyx_v_evecA1), (&__pyx_v_evalB), (&__pyx_v_evecB1));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":100
 *                                     &evalA, &evecA1,
 *                                     &evalB, &evecB1)
 *         if eigen_err:             # <<<<<<<<<<<<<<
 *             slope = nan
 *             eccentricity = 0.0
 */
  __pyx_5 = __pyx_v_eigen_err;
  if (__pyx_5) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":101
 *                                     &evalB, &evecB1)
 *         if eigen_err:
 *             slope = nan             # <<<<<<<<<<<<<<
 *             eccentricity = 0.0
 *         else:
 */
    __pyx_v_slope = __pyx_v_23realtime_image_analysis_nan;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":102
 *         if eigen_err:
 *             slope = nan
 *             eccentricity = 0.0             # <<<<<<<<<<<<<<
 *         else:
 *             rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 */
    __pyx_v_eccentricity = 0.0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":104
 *             eccentricity = 0.0
 *         else:
 *             rise = 1.0 # 2nd component of eigenvectors will always be 1.0             # <<<<<<<<<<<<<<
 *             if evalA > evalB:
 *                 run = evecA1
 */
    __pyx_v_rise = 1.0;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":105
 *         else:
 *             rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 *             if evalA > evalB:             # <<<<<<<<<<<<<<
 *                 run = evecA1
 *                 eccentricity = evalA/evalB
 */
    __pyx_1 = (__pyx_v_evalA > __pyx_v_evalB);
    if (__pyx_1) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":106
 *             rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 *             if evalA > evalB:
 *                 run = evecA1             # <<<<<<<<<<<<<<
 *                 eccentricity = evalA/evalB
 *             else:
 */
      __pyx_v_run = __pyx_v_evecA1;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":107
 *             if evalA > evalB:
 *                 run = evecA1
 *                 eccentricity = evalA/evalB             # <<<<<<<<<<<<<<
 *             else:
 *                 run = evecB1
 */
      __pyx_v_eccentricity = (__pyx_v_evalA / __pyx_v_evalB);
      goto __pyx_L7;
    }
    /*else*/ {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":109
 *                 eccentricity = evalA/evalB
 *             else:
 *                 run = evecB1             # <<<<<<<<<<<<<<
 *                 eccentricity = evalB/evalA
 *             slope = rise/run
 */
      __pyx_v_run = __pyx_v_evecB1;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":110
 *             else:
 *                 run = evecB1
 *                 eccentricity = evalB/evalA             # <<<<<<<<<<<<<<
 *             slope = rise/run
 * 
 */
      __pyx_v_eccentricity = (__pyx_v_evalB / __pyx_v_evalA);
    }
    __pyx_L7:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":111
 *                 run = evecB1
 *                 eccentricity = evalB/evalA
 *             slope = rise/run             # <<<<<<<<<<<<<<
 * 
 *         return (x0, y0, area, slope, eccentricity)
 */
    __pyx_v_slope = (__pyx_v_rise / __pyx_v_run);
  }
  __pyx_L6:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":113
 *             slope = rise/run
 * 
 *         return (x0, y0, area, slope, eccentricity)             # <<<<<<<<<<<<<<
 * 
 * def py_fit_params(FastImage.FastImage8u im):
 */
  __pyx_2 = PyFloat_FromDouble(__pyx_v_x0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(__pyx_v_y0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(__pyx_v_area); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyFloat_FromDouble(__pyx_v_slope); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = PyFloat_FromDouble(__pyx_v_eccentricity); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_8 = PyTuple_New(5); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_8, 0, __pyx_2);
  PyTuple_SET_ITEM(__pyx_8, 1, __pyx_3);
  PyTuple_SET_ITEM(__pyx_8, 2, __pyx_4);
  PyTuple_SET_ITEM(__pyx_8, 3, __pyx_6);
  PyTuple_SET_ITEM(__pyx_8, 4, __pyx_7);
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_6 = 0;
  __pyx_7 = 0;
  __pyx_r = ((PyObject *)__pyx_8);
  __pyx_8 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  __Pyx_AddTraceback("realtime_image_analysis.FitParamsClass.fit");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":115
 *         return (x0, y0, area, slope, eccentricity)
 * 
 * def py_fit_params(FastImage.FastImage8u im):             # <<<<<<<<<<<<<<
 *     cdef FitParamsClass fpc = FitParamsClass()
 *     return fpc.fit(im)
 */

static PyObject *__pyx_pf_23realtime_image_analysis_py_fit_params(PyObject *__pyx_self, PyObject *__pyx_v_im); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_py_fit_params(PyObject *__pyx_self, PyObject *__pyx_v_im) {
  struct __pyx_obj_23realtime_image_analysis_FitParamsClass *__pyx_v_fpc = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  __pyx_self = __pyx_self;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":116
 * 
 * def py_fit_params(FastImage.FastImage8u im):
 *     cdef FitParamsClass fpc = FitParamsClass()             # <<<<<<<<<<<<<<
 *     return fpc.fit(im)
 * 
 */
  __pyx_1 = PyObject_Call(((PyObject*)__pyx_ptype_23realtime_image_analysis_FitParamsClass), ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_23realtime_image_analysis_FitParamsClass))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_v_fpc = ((struct __pyx_obj_23realtime_image_analysis_FitParamsClass *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":117
 * def py_fit_params(FastImage.FastImage8u im):
 *     cdef FitParamsClass fpc = FitParamsClass()
 *     return fpc.fit(im)             # <<<<<<<<<<<<<<
 * 
 * cdef class RealtimeAnalyzer:
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_fpc), __pyx_kp_fit); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_im);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_im);
  __pyx_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  __pyx_r = __pyx_3;
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("realtime_image_analysis.py_fit_params");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_XDECREF(__pyx_v_fpc);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":168
 *     cdef int max_num_points
 * 
 *     def __cinit__(self,*args,**kw):             # <<<<<<<<<<<<<<
 *         # image moment calculation initialization
 *         CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &self.pState, ipp.ippAlgHintFast ) )
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kw = 0;
  int __pyx_r;
  if (unlikely(__pyx_kwds)) {
    if (unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__cinit__", 1))) return -1;
  }
  __pyx_v_kw = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kw)) return -1;
  Py_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":170
 *     def __cinit__(self,*args,**kw):
 *         # image moment calculation initialization
 *         CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &self.pState, ipp.ippAlgHintFast ) )             # <<<<<<<<<<<<<<
 * 
 *     def __dealloc__(self):
 */
  __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(ippiMomentInitAlloc_64f((&((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->pState), ippAlgHintFast)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.__cinit__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_kw);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":172
 *         CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &self.pState, ipp.ippAlgHintFast ) )
 * 
 *     def __dealloc__(self):             # <<<<<<<<<<<<<<
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( self.pState ))
 * 
 */

static void __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___dealloc__(PyObject *__pyx_v_self) {

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":173
 * 
 *     def __dealloc__(self):
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( self.pState ))             # <<<<<<<<<<<<<<
 * 
 *     def __init__(self,object lbrt,int maxwidth, int maxheight, int max_num_points, int roi2_radius):
 */
  __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(ippiMomentFree_64f(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->pState)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 173; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.__dealloc__");
  __pyx_L0:;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":175
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( self.pState ))
 * 
 *     def __init__(self,object lbrt,int maxwidth, int maxheight, int max_num_points, int roi2_radius):             # <<<<<<<<<<<<<<
 *         # software analysis ROI
 *         self.maxwidth = maxwidth
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_lbrt = 0;
  int __pyx_v_maxwidth;
  int __pyx_v_maxheight;
  int __pyx_v_max_num_points;
  int __pyx_v_roi2_radius;
  PyObject *__pyx_v_sz;
  int __pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"lbrt","maxwidth","maxheight","max_num_points","roi2_radius",0};
  if (likely(!__pyx_kwds) && likely(PyTuple_GET_SIZE(__pyx_args) == 5)) {
    __pyx_v_lbrt = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_maxwidth = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_maxwidth == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_maxheight = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_maxheight == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_max_num_points = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_max_num_points == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_roi2_radius = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_roi2_radius == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "Oiiii", __pyx_argnames, &__pyx_v_lbrt, &__pyx_v_maxwidth, &__pyx_v_maxheight, &__pyx_v_max_num_points, &__pyx_v_roi2_radius))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.__init__");
  return -1;
  __pyx_L4:;
  __pyx_v_sz = Py_None; Py_INCREF(Py_None);

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":177
 *     def __init__(self,object lbrt,int maxwidth, int maxheight, int max_num_points, int roi2_radius):
 *         # software analysis ROI
 *         self.maxwidth = maxwidth             # <<<<<<<<<<<<<<
 *         self.maxheight = maxheight
 * 
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxwidth = __pyx_v_maxwidth;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":178
 *         # software analysis ROI
 *         self.maxwidth = maxwidth
 *         self.maxheight = maxheight             # <<<<<<<<<<<<<<
 * 
 *         self.max_num_points = max_num_points
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxheight = __pyx_v_maxheight;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":180
 *         self.maxheight = maxheight
 * 
 *         self.max_num_points = max_num_points             # <<<<<<<<<<<<<<
 *         #print 'realtime analysis with %d points maximum starting'%self.max_num_points
 * 
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->max_num_points = __pyx_v_max_num_points;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":183
 *         #print 'realtime analysis with %d points maximum starting'%self.max_num_points
 * 
 *         self._roi2_radius = roi2_radius             # <<<<<<<<<<<<<<
 *         self._diff_threshold = 11
 *         self._clear_threshold = 0.2
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius = __pyx_v_roi2_radius;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":184
 * 
 *         self._roi2_radius = roi2_radius
 *         self._diff_threshold = 11             # <<<<<<<<<<<<<<
 *         self._clear_threshold = 0.2
 * 
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_diff_threshold = 11;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":185
 *         self._roi2_radius = roi2_radius
 *         self._diff_threshold = 11
 *         self._clear_threshold = 0.2             # <<<<<<<<<<<<<<
 * 
 *         self._despeckle_threshold = 5
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_clear_threshold = 0.2;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":187
 *         self._clear_threshold = 0.2
 * 
 *         self._despeckle_threshold = 5             # <<<<<<<<<<<<<<
 *         self.n_rot_samples = 100*60 # 1 minute
 * 
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_despeckle_threshold = 5;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":188
 * 
 *         self._despeckle_threshold = 5
 *         self.n_rot_samples = 100*60 # 1 minute             # <<<<<<<<<<<<<<
 * 
 *         sz = FastImage.Size(self.maxwidth,self.maxheight)
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->n_rot_samples = (100 * 60);

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":190
 *         self.n_rot_samples = 100*60 # 1 minute
 * 
 *         sz = FastImage.Size(self.maxwidth,self.maxheight)             # <<<<<<<<<<<<<<
 *         # 8u images
 *         self.absdiff_im=FastImage.FastImage8u(sz)
 */
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxwidth); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxheight); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_1 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_Size), ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 190; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_v_sz);
  __pyx_v_sz = __pyx_1;
  __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":192
 *         sz = FastImage.Size(self.maxwidth,self.maxheight)
 *         # 8u images
 *         self.absdiff_im=FastImage.FastImage8u(sz)             # <<<<<<<<<<<<<<
 * 
 *         # 8u background
 */
  __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_sz);
  __pyx_3 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u), ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_3, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":195
 * 
 *         # 8u background
 *         self.mask_im=FastImage.FastImage8u(sz)             # <<<<<<<<<<<<<<
 *         self.mask_im.set_val(0,sz)
 * 
 */
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_sz);
  __pyx_2 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u), ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mask_im));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mask_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":196
 *         # 8u background
 *         self.mask_im=FastImage.FastImage8u(sz)
 *         self.mask_im.set_val(0,sz)             # <<<<<<<<<<<<<<
 * 
 *         self.mean_im=FastImage.FastImage8u(sz)
 */
  __pyx_3 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mask_im), __pyx_kp_set_val); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_0);
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_v_sz);
  __pyx_2 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":198
 *         self.mask_im.set_val(0,sz)
 * 
 *         self.mean_im=FastImage.FastImage8u(sz)             # <<<<<<<<<<<<<<
 *         self.cmp_im=FastImage.FastImage8u(sz)
 *         self.cmp_im.set_val(0,sz)
 */
  __pyx_3 = PyTuple_New(1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_sz);
  __pyx_1 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u), ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":199
 * 
 *         self.mean_im=FastImage.FastImage8u(sz)
 *         self.cmp_im=FastImage.FastImage8u(sz)             # <<<<<<<<<<<<<<
 *         self.cmp_im.set_val(0,sz)
 * 
 */
  __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_sz);
  __pyx_3 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u), ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_3, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":200
 *         self.mean_im=FastImage.FastImage8u(sz)
 *         self.cmp_im=FastImage.FastImage8u(sz)
 *         self.cmp_im.set_val(0,sz)             # <<<<<<<<<<<<<<
 * 
 *         self.cmpdiff_im=FastImage.FastImage8u(sz)
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im), __pyx_kp_set_val); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_int_0);
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_sz);
  __pyx_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":202
 *         self.cmp_im.set_val(0,sz)
 * 
 *         self.cmpdiff_im=FastImage.FastImage8u(sz)             # <<<<<<<<<<<<<<
 * 
 *         # create and update self.imname2im dict
 */
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_sz);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_sz);
  __pyx_2 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u), ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":205
 * 
 *         # create and update self.imname2im dict
 *         self.imname2im = {'absdiff' :self.absdiff_im,             # <<<<<<<<<<<<<<
 *                           'mean'    :self.mean_im,
 *                           'mask'    :self.mask_im,
 */
  __pyx_3 = PyDict_New(); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyDict_SetItem(__pyx_3, __pyx_kp_6, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":206
 *         # create and update self.imname2im dict
 *         self.imname2im = {'absdiff' :self.absdiff_im,
 *                           'mean'    :self.mean_im,             # <<<<<<<<<<<<<<
 *                           'mask'    :self.mask_im,
 *                           'cmp'     :self.cmp_im,
 */
  if (PyDict_SetItem(__pyx_3, __pyx_kp_7, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":207
 *         self.imname2im = {'absdiff' :self.absdiff_im,
 *                           'mean'    :self.mean_im,
 *                           'mask'    :self.mask_im,             # <<<<<<<<<<<<<<
 *                           'cmp'     :self.cmp_im,
 *                           'cmpdiff' :self.cmpdiff_im,
 */
  if (PyDict_SetItem(__pyx_3, __pyx_kp_8, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mask_im)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":208
 *                           'mean'    :self.mean_im,
 *                           'mask'    :self.mask_im,
 *                           'cmp'     :self.cmp_im,             # <<<<<<<<<<<<<<
 *                           'cmpdiff' :self.cmpdiff_im,
 *                           }
 */
  if (PyDict_SetItem(__pyx_3, __pyx_kp_9, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":209
 *                           'mask'    :self.mask_im,
 *                           'cmp'     :self.cmp_im,
 *                           'cmpdiff' :self.cmpdiff_im,             # <<<<<<<<<<<<<<
 *                           }
 * 
 */
  if (PyDict_SetItem(__pyx_3, __pyx_kp_10, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im)) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":205
 * 
 *         # create and update self.imname2im dict
 *         self.imname2im = {'absdiff' :self.absdiff_im,             # <<<<<<<<<<<<<<
 *                           'mean'    :self.mean_im,
 *                           'mask'    :self.mask_im,
 */
  Py_DECREF(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->imname2im);
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->imname2im = ((PyObject *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":212
 *                           }
 * 
 *         self.roi = lbrt             # <<<<<<<<<<<<<<
 * 
 *         # initialize background images
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp_roi, __pyx_v_lbrt) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":215
 * 
 *         # initialize background images
 *         self.mean_im_roi_view.set_val( 0, self._roi_sz )             # <<<<<<<<<<<<<<
 * 
 *     def distort( self, float x0, float y0 ):
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im_roi_view), __pyx_kp_set_val); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_int_0);
  Py_INCREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  PyTuple_SET_ITEM(__pyx_2, 1, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  __pyx_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  Py_DECREF(__pyx_v_sz);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":217
 *         self.mean_im_roi_view.set_val( 0, self._roi_sz )
 * 
 *     def distort( self, float x0, float y0 ):             # <<<<<<<<<<<<<<
 *         if self._helper is None:
 *             return x0, y0
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_distort(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_distort(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  float __pyx_v_x0;
  float __pyx_v_y0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  static char *__pyx_argnames[] = {"x0","y0",0};
  if (likely(!__pyx_kwds) && likely(PyTuple_GET_SIZE(__pyx_args) == 2)) {
    __pyx_v_x0 = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_y0 = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "ff", __pyx_argnames, &__pyx_v_x0, &__pyx_v_y0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.distort");
  return NULL;
  __pyx_L4:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":218
 * 
 *     def distort( self, float x0, float y0 ):
 *         if self._helper is None:             # <<<<<<<<<<<<<<
 *             return x0, y0
 *         return self._helper.distort( x0, y0 )
 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__helper); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = (__pyx_1 == Py_None);
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (__pyx_2) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":219
 *     def distort( self, float x0, float y0 ):
 *         if self._helper is None:
 *             return x0, y0             # <<<<<<<<<<<<<<
 *         return self._helper.distort( x0, y0 )
 * 
 */
    __pyx_1 = PyFloat_FromDouble(__pyx_v_x0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = PyFloat_FromDouble(__pyx_v_y0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyTuple_New(2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_1);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_3);
    __pyx_1 = 0;
    __pyx_3 = 0;
    __pyx_r = ((PyObject *)__pyx_4);
    __pyx_4 = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":220
 *         if self._helper is None:
 *             return x0, y0
 *         return self._helper.distort( x0, y0 )             # <<<<<<<<<<<<<<
 * 
 *     def do_work(self,
 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__helper); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyObject_GetAttr(__pyx_1, __pyx_kp_distort); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_4 = PyFloat_FromDouble(__pyx_v_x0); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyFloat_FromDouble(__pyx_v_y0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(2); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_4);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_1);
  __pyx_4 = 0;
  __pyx_1 = 0;
  __pyx_4 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_5), NULL); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
  __pyx_r = __pyx_4;
  __pyx_4 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.distort");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":222
 *         return self._helper.distort( x0, y0 )
 * 
 *     def do_work(self,             # <<<<<<<<<<<<<<
 *                 FastImage.FastImage8u raw_im_small,
 *                 double timestamp,
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_do_work(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_23realtime_image_analysis_16RealtimeAnalyzer_do_work[] = "find location and orientation of local points (fast enough for realtime use)\n\n        inputs\n        ------\n\n        timestamp\n        framenumber\n        use_roi2\n\n        optional inputs (default to 0)\n        ------------------------------\n        use_cmp -- perform more detailed analysis against cmp image (used with ongoing variance estimation)\n\n        outputs\n        -------\n\n        [ (x0_abs, y0_abs, area, slope, eccentricity) ] -- with a tuple for each point found\n\n        ";
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_do_work(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_raw_im_small = 0;
  double __pyx_v_timestamp;
  int __pyx_v_framenumber;
  int __pyx_v_use_roi2;
  int __pyx_v_use_cmp;
  double __pyx_v_max_duration_sec;
  int __pyx_v_return_debug_values;
  double __pyx_v_x0;
  double __pyx_v_y0;
  double __pyx_v_x0_abs;
  double __pyx_v_y0_abs;
  double __pyx_v_area;
  double __pyx_v_rise;
  double __pyx_v_run;
  double __pyx_v_slope;
  double __pyx_v_eccentricity;
  double __pyx_v_evalA;
  double __pyx_v_evalB;
  double __pyx_v_evecA1;
  double __pyx_v_evecB1;
  double __pyx_v_Mu00;
  double __pyx_v_Uu11;
  double __pyx_v_Uu02;
  double __pyx_v_Uu20;
  int __pyx_v_result;
  int __pyx_v_eigen_err;
  int __pyx_v_index_x;
  int __pyx_v_index_y;
  Ipp8u __pyx_v_max_abs_diff;
  Ipp8u *__pyx_v_im_loc_ptr;
  Ipp8u __pyx_v_max_std_diff;
  Ipp8u __pyx_v_clear_despeckle_thresh;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *__pyx_v_roi2_sz;
  int __pyx_v_left2;
  int __pyx_v_right2;
  int __pyx_v_bottom2;
  int __pyx_v_top2;
  int __pyx_v_found_point;
  int __pyx_v_n_found_points;
  double __pyx_v_entry_time;
  double __pyx_v_now;
  PyObject *__pyx_v_all_points_found;
  PyObject *__pyx_v_pt_tuple;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  double __pyx_3;
  int __pyx_4;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  int __pyx_7;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  PyObject *__pyx_11 = 0;
  PyObject *__pyx_12 = 0;
  static char *__pyx_argnames[] = {"raw_im_small","timestamp","framenumber","use_roi2","use_cmp","max_duration_sec","return_debug_values",0};
  __pyx_v_use_cmp = 0;
  __pyx_v_max_duration_sec = 0.0;
  __pyx_v_return_debug_values = 0;
  if (likely(!__pyx_kwds) && likely(4 <= PyTuple_GET_SIZE(__pyx_args)) && likely(PyTuple_GET_SIZE(__pyx_args) <= 7)) {
    __pyx_v_raw_im_small = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_timestamp = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_framenumber = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_framenumber == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_use_roi2 = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_use_roi2 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (PyTuple_GET_SIZE(__pyx_args) > 4) {
      __pyx_v_use_cmp = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_use_cmp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      if (PyTuple_GET_SIZE(__pyx_args) > 5) {
        __pyx_v_max_duration_sec = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 5)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        if (PyTuple_GET_SIZE(__pyx_args) > 6) {
          __pyx_v_return_debug_values = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 6)); if (unlikely((__pyx_v_return_debug_values == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
        }
      }
    }
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "Odii|idi", __pyx_argnames, &__pyx_v_raw_im_small, &__pyx_v_timestamp, &__pyx_v_framenumber, &__pyx_v_use_roi2, &__pyx_v_use_cmp, &__pyx_v_max_duration_sec, &__pyx_v_return_debug_values))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 222; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.do_work");
  return NULL;
  __pyx_L4:;
  __pyx_v_roi2_sz = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)Py_None); Py_INCREF(Py_None);
  __pyx_v_all_points_found = Py_None; Py_INCREF(Py_None);
  __pyx_v_pt_tuple = Py_None; Py_INCREF(Py_None);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_raw_im_small), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "raw_im_small", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":278
 *         cdef double now
 * 
 *         entry_time = time.time()             # <<<<<<<<<<<<<<
 * 
 *         roi2_sz = FastImage.Size(21,21)
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_time); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_time); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_entry_time = __pyx_3;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":280
 *         entry_time = time.time()
 * 
 *         roi2_sz = FastImage.Size(21,21)             # <<<<<<<<<<<<<<
 * 
 *         all_points_found = [] # len(all_points_found) == n_found_points
 */
  __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_21);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_int_21);
  Py_INCREF(__pyx_int_21);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_int_21);
  __pyx_1 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_Size), ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_6motmot_9FastImage_9FastImage_Size))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_v_roi2_sz));
  __pyx_v_roi2_sz = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":282
 *         roi2_sz = FastImage.Size(21,21)
 * 
 *         all_points_found = [] # len(all_points_found) == n_found_points             # <<<<<<<<<<<<<<
 *         n_found_points = 0
 * 
 */
  __pyx_2 = PyList_New(0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_all_points_found);
  __pyx_v_all_points_found = ((PyObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":283
 * 
 *         all_points_found = [] # len(all_points_found) == n_found_points
 *         n_found_points = 0             # <<<<<<<<<<<<<<
 * 
 *         # This is our near-hack to ensure users update .roi before calling .do_work()
 */
  __pyx_v_n_found_points = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":286
 * 
 *         # This is our near-hack to ensure users update .roi before calling .do_work()
 *         if not ((self._roi_sz.sz.width == raw_im_small.imsiz.sz.width) and             # <<<<<<<<<<<<<<
 *                 (self._roi_sz.sz.height == raw_im_small.imsiz.sz.height)):
 *             raise ValueError("input image size (%s) does not correspond to ROI (%s)"
 */
  __pyx_4 = (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz.width == __pyx_v_raw_im_small->__pyx_base.imsiz->sz.width);
  if (__pyx_4) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":287
 *         # This is our near-hack to ensure users update .roi before calling .do_work()
 *         if not ((self._roi_sz.sz.width == raw_im_small.imsiz.sz.width) and
 *                 (self._roi_sz.sz.height == raw_im_small.imsiz.sz.height)):             # <<<<<<<<<<<<<<
 *             raise ValueError("input image size (%s) does not correspond to ROI (%s)"
 *                              "(set RealtimeAnalyzer.roi before calling)"%(
 */
    __pyx_4 = (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz.height == __pyx_v_raw_im_small->__pyx_base.imsiz->sz.height);
  }
  __pyx_5 = (!__pyx_4);
  if (__pyx_5) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":290
 *             raise ValueError("input image size (%s) does not correspond to ROI (%s)"
 *                              "(set RealtimeAnalyzer.roi before calling)"%(
 *                 str(raw_im_small.imsiz),str(self._roi_sz)))             # <<<<<<<<<<<<<<
 * 
 *         # find difference from mean
 */
    __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(((PyObject *)__pyx_v_raw_im_small->__pyx_base.imsiz));
    PyTuple_SET_ITEM(__pyx_1, 0, ((PyObject *)__pyx_v_raw_im_small->__pyx_base.imsiz));
    __pyx_2 = PyObject_Call(((PyObject*)&PyBytes_Type), ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
    PyTuple_SET_ITEM(__pyx_1, 0, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
    __pyx_6 = PyObject_Call(((PyObject*)&PyBytes_Type), ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_1, 1, __pyx_6);
    __pyx_2 = 0;
    __pyx_6 = 0;
    __pyx_2 = PyNumber_Remainder(__pyx_kp_11, ((PyObject *)__pyx_1)); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_6, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_6), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
    __Pyx_Raise(__pyx_1, 0, 0);
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":293
 * 
 *         # find difference from mean
 *         c_python.Py_BEGIN_ALLOW_THREADS             # <<<<<<<<<<<<<<
 *         # absdiff_im = | raw_im - mean_im |
 *         #raw_im_small.fast_get_absdiff_put( self.mean_im_roi_view,
 */
  Py_BEGIN_ALLOW_THREADS;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":301
 *                                           <ipp.Ipp8u*>raw_im_small.im,raw_im_small.step,
 *                                           <ipp.Ipp8u*>self.absdiff_im_roi_view.im,self.absdiff_im_roi_view.step,
 *                                           self._roi_sz.sz))             # <<<<<<<<<<<<<<
 * 
 *         # mask unused part of absdiff_im to 0
 */
  CHK_NOGIL(ippiAbsDiff_8u_C1R(((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im_roi_view->__pyx_base.step, ((Ipp8u *)__pyx_v_raw_im_small->__pyx_base.im), __pyx_v_raw_im_small->__pyx_base.step, ((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.step, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":309
 * 
 *         CHK_NOGIL( ipp.ippiSet_8u_C1MR( 0, <ipp.Ipp8u*>self.absdiff_im.im, self.absdiff_im.step, self.absdiff_im.imsiz.sz,
 *                                         <ipp.Ipp8u*>self.mask_im.im, self.mask_im.step))             # <<<<<<<<<<<<<<
 * 
 *         if use_cmp:
 */
  CHK_NOGIL(ippiSet_8u_C1MR(0, ((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im->__pyx_base.step, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im->__pyx_base.imsiz->sz, ((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mask_im->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mask_im->__pyx_base.step));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":311
 *                                         <ipp.Ipp8u*>self.mask_im.im, self.mask_im.step))
 * 
 *         if use_cmp:             # <<<<<<<<<<<<<<
 *             # clip the minimum comparison value to diff_threshold
 *             CHK_NOGIL( ipp.ippiThreshold_Val_8u_C1IR(<ipp.Ipp8u*>self.cmp_im_roi_view.im,
 */
  __pyx_7 = __pyx_v_use_cmp;
  if (__pyx_7) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":316
 *                                                self.cmp_im_roi_view.step,
 *                                                self._roi_sz.sz,
 *                                                self._diff_threshold, self._diff_threshold, ipp.ippCmpLess))             # <<<<<<<<<<<<<<
 *         c_python.Py_END_ALLOW_THREADS
 * 
 */
    CHK_NOGIL(ippiThreshold_Val_8u_C1IR(((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im_roi_view->__pyx_base.step, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_diff_threshold, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_diff_threshold, ippCmpLess));
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":317
 *                                                self._roi_sz.sz,
 *                                                self._diff_threshold, self._diff_threshold, ipp.ippCmpLess))
 *         c_python.Py_END_ALLOW_THREADS             # <<<<<<<<<<<<<<
 * 
 *         while n_found_points < self.max_num_points:
 */
  Py_END_ALLOW_THREADS;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":319
 *         c_python.Py_END_ALLOW_THREADS
 * 
 *         while n_found_points < self.max_num_points:             # <<<<<<<<<<<<<<
 *             if max_duration_sec != 0.0:
 *                 now = time.time()
 */
  while (1) {
    __pyx_4 = (__pyx_v_n_found_points < ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->max_num_points);
    if (!__pyx_4) break;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":320
 * 
 *         while n_found_points < self.max_num_points:
 *             if max_duration_sec != 0.0:             # <<<<<<<<<<<<<<
 *                 now = time.time()
 *                 if (now-entry_time) > max_duration_sec:
 */
    __pyx_5 = (__pyx_v_max_duration_sec != 0.0);
    if (__pyx_5) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":321
 *         while n_found_points < self.max_num_points:
 *             if max_duration_sec != 0.0:
 *                 now = time.time()             # <<<<<<<<<<<<<<
 *                 if (now-entry_time) > max_duration_sec:
 *                     warnings.warn('stopped looking for points (this frame only) because it was taking longer than max_duration_sec',
 */
      __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_time); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = PyObject_GetAttr(__pyx_2, __pyx_kp_time); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_1 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_3 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_v_now = __pyx_3;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":322
 *             if max_duration_sec != 0.0:
 *                 now = time.time()
 *                 if (now-entry_time) > max_duration_sec:             # <<<<<<<<<<<<<<
 *                     warnings.warn('stopped looking for points (this frame only) because it was taking longer than max_duration_sec',
 *                                   stacklevel=1)
 */
      __pyx_4 = ((__pyx_v_now - __pyx_v_entry_time) > __pyx_v_max_duration_sec);
      if (__pyx_4) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":323
 *                 now = time.time()
 *                 if (now-entry_time) > max_duration_sec:
 *                     warnings.warn('stopped looking for points (this frame only) because it was taking longer than max_duration_sec',             # <<<<<<<<<<<<<<
 *                                   stacklevel=1)
 *                     break
 */
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_warnings); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_6 = PyObject_GetAttr(__pyx_2, __pyx_kp_warn); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_INCREF(__pyx_kp_12);
        PyTuple_SET_ITEM(__pyx_1, 0, __pyx_kp_12);
        __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":324
 *                 if (now-entry_time) > max_duration_sec:
 *                     warnings.warn('stopped looking for points (this frame only) because it was taking longer than max_duration_sec',
 *                                   stacklevel=1)             # <<<<<<<<<<<<<<
 *                     break
 *             # release GIL
 */
        if (PyDict_SetItem(__pyx_2, __pyx_kp_stacklevel, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_8 = PyEval_CallObjectWithKeywords(__pyx_6, ((PyObject *)__pyx_1), ((PyObject *)__pyx_2)); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
        Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
        Py_DECREF(__pyx_8); __pyx_8 = 0;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":325
 *                     warnings.warn('stopped looking for points (this frame only) because it was taking longer than max_duration_sec',
 *                                   stacklevel=1)
 *                     break             # <<<<<<<<<<<<<<
 *             # release GIL
 *             c_python.Py_BEGIN_ALLOW_THREADS
 */
        goto __pyx_L8;
        goto __pyx_L10;
      }
      __pyx_L10:;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":327
 *                     break
 *             # release GIL
 *             c_python.Py_BEGIN_ALLOW_THREADS             # <<<<<<<<<<<<<<
 * 
 *             # WARNING WARNING WARNING WARNING WARNING WARNING WARNING
 */
    Py_BEGIN_ALLOW_THREADS;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":343
 * 
 *             # find max pixel in ROI
 *             if use_cmp:             # <<<<<<<<<<<<<<
 *                 # cmpdiff_im = absdiff_im - cmp_im (saturates 8u)
 *                 #self.absdiff_im_roi_view.fast_get_sub_put( self.cmp_im_roi_view,
 */
    __pyx_7 = __pyx_v_use_cmp;
    if (__pyx_7) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":351
 *                                                  <ipp.Ipp8u*>self.absdiff_im_roi_view.im, self.absdiff_im_roi_view.step,
 *                                                  <ipp.Ipp8u*>self.cmpdiff_im_roi_view.im, self.cmpdiff_im_roi_view.step,
 *                                                  self._roi_sz.sz,0))             # <<<<<<<<<<<<<<
 *                 CHK_NOGIL( ipp.ippiMaxIndx_8u_C1R(
 *                     <ipp.Ipp8u*>self.cmpdiff_im_roi_view.im,self.cmpdiff_im_roi_view.step,
 */
      CHK_NOGIL(ippiSub_8u_C1RSfs(((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im_roi_view->__pyx_base.step, ((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.step, ((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi_view->__pyx_base.step, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz, 0));

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":354
 *                 CHK_NOGIL( ipp.ippiMaxIndx_8u_C1R(
 *                     <ipp.Ipp8u*>self.cmpdiff_im_roi_view.im,self.cmpdiff_im_roi_view.step,
 *                     self._roi_sz.sz, &max_std_diff, &index_x, &index_y))             # <<<<<<<<<<<<<<
 * 
 *                 im_loc_ptr = (<ipp.Ipp8u*>self.absdiff_im_roi_view.im)+self.absdiff_im_roi_view.step*index_y+index_x
 */
      CHK_NOGIL(ippiMaxIndx_8u_C1R(((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi_view->__pyx_base.step, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz, (&__pyx_v_max_std_diff), (&__pyx_v_index_x), (&__pyx_v_index_y)));

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":356
 *                     self._roi_sz.sz, &max_std_diff, &index_x, &index_y))
 * 
 *                 im_loc_ptr = (<ipp.Ipp8u*>self.absdiff_im_roi_view.im)+self.absdiff_im_roi_view.step*index_y+index_x             # <<<<<<<<<<<<<<
 *                 max_abs_diff = im_loc_ptr[0] # value at maximum difference from std
 *             else:
 */
      __pyx_v_im_loc_ptr = ((((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.im) + (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.step * __pyx_v_index_y)) + __pyx_v_index_x);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":357
 * 
 *                 im_loc_ptr = (<ipp.Ipp8u*>self.absdiff_im_roi_view.im)+self.absdiff_im_roi_view.step*index_y+index_x
 *                 max_abs_diff = im_loc_ptr[0] # value at maximum difference from std             # <<<<<<<<<<<<<<
 *             else:
 *                 max_std_diff=0
 */
      __pyx_v_max_abs_diff = (__pyx_v_im_loc_ptr[0]);
      goto __pyx_L11;
    }
    /*else*/ {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":359
 *                 max_abs_diff = im_loc_ptr[0] # value at maximum difference from std
 *             else:
 *                 max_std_diff=0             # <<<<<<<<<<<<<<
 *                 CHK_NOGIL( ipp.ippiMaxIndx_8u_C1R(
 *                     <ipp.Ipp8u*>self.absdiff_im_roi_view.im,self.absdiff_im_roi_view.step,
 */
      __pyx_v_max_std_diff = 0;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":362
 *                 CHK_NOGIL( ipp.ippiMaxIndx_8u_C1R(
 *                     <ipp.Ipp8u*>self.absdiff_im_roi_view.im,self.absdiff_im_roi_view.step,
 *                     self._roi_sz.sz, &max_abs_diff, &index_x, &index_y))             # <<<<<<<<<<<<<<
 * 
 *             if use_roi2:
 */
      CHK_NOGIL(ippiMaxIndx_8u_C1R(((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view->__pyx_base.step, ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz, (&__pyx_v_max_abs_diff), (&__pyx_v_index_x), (&__pyx_v_index_y)));
    }
    __pyx_L11:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":364
 *                     self._roi_sz.sz, &max_abs_diff, &index_x, &index_y))
 * 
 *             if use_roi2:             # <<<<<<<<<<<<<<
 *                 # find mini-ROI for further analysis (defined in non-ROI space)
 *                 left2 = index_x - self._roi2_radius + self._left
 */
    __pyx_7 = __pyx_v_use_roi2;
    if (__pyx_7) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":366
 *             if use_roi2:
 *                 # find mini-ROI for further analysis (defined in non-ROI space)
 *                 left2 = index_x - self._roi2_radius + self._left             # <<<<<<<<<<<<<<
 *                 right2 = index_x + self._roi2_radius + self._left
 *                 bottom2 = index_y - self._roi2_radius + self._bottom
 */
      __pyx_v_left2 = ((__pyx_v_index_x - ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius) + ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":367
 *                 # find mini-ROI for further analysis (defined in non-ROI space)
 *                 left2 = index_x - self._roi2_radius + self._left
 *                 right2 = index_x + self._roi2_radius + self._left             # <<<<<<<<<<<<<<
 *                 bottom2 = index_y - self._roi2_radius + self._bottom
 *                 top2 = index_y + self._roi2_radius + self._bottom
 */
      __pyx_v_right2 = ((__pyx_v_index_x + ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius) + ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":368
 *                 left2 = index_x - self._roi2_radius + self._left
 *                 right2 = index_x + self._roi2_radius + self._left
 *                 bottom2 = index_y - self._roi2_radius + self._bottom             # <<<<<<<<<<<<<<
 *                 top2 = index_y + self._roi2_radius + self._bottom
 * 
 */
      __pyx_v_bottom2 = ((__pyx_v_index_y - ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius) + ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":369
 *                 right2 = index_x + self._roi2_radius + self._left
 *                 bottom2 = index_y - self._roi2_radius + self._bottom
 *                 top2 = index_y + self._roi2_radius + self._bottom             # <<<<<<<<<<<<<<
 * 
 *                 if left2 < self._left: left2 = self._left
 */
      __pyx_v_top2 = ((__pyx_v_index_y + ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius) + ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":371
 *                 top2 = index_y + self._roi2_radius + self._bottom
 * 
 *                 if left2 < self._left: left2 = self._left             # <<<<<<<<<<<<<<
 *                 if right2 > self._right: right2 = self._right
 *                 if bottom2 < self._bottom: bottom2 = self._bottom
 */
      __pyx_5 = (__pyx_v_left2 < ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left);
      if (__pyx_5) {
        __pyx_v_left2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left;
        goto __pyx_L13;
      }
      __pyx_L13:;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":372
 * 
 *                 if left2 < self._left: left2 = self._left
 *                 if right2 > self._right: right2 = self._right             # <<<<<<<<<<<<<<
 *                 if bottom2 < self._bottom: bottom2 = self._bottom
 *                 if top2 > self._top: top2 = self._top
 */
      __pyx_4 = (__pyx_v_right2 > ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right);
      if (__pyx_4) {
        __pyx_v_right2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right;
        goto __pyx_L14;
      }
      __pyx_L14:;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":373
 *                 if left2 < self._left: left2 = self._left
 *                 if right2 > self._right: right2 = self._right
 *                 if bottom2 < self._bottom: bottom2 = self._bottom             # <<<<<<<<<<<<<<
 *                 if top2 > self._top: top2 = self._top
 *                 roi2_sz.sz.width = right2 - left2 + 1
 */
      __pyx_5 = (__pyx_v_bottom2 < ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom);
      if (__pyx_5) {
        __pyx_v_bottom2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom;
        goto __pyx_L15;
      }
      __pyx_L15:;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":374
 *                 if right2 > self._right: right2 = self._right
 *                 if bottom2 < self._bottom: bottom2 = self._bottom
 *                 if top2 > self._top: top2 = self._top             # <<<<<<<<<<<<<<
 *                 roi2_sz.sz.width = right2 - left2 + 1
 *                 roi2_sz.sz.height = top2 - bottom2 + 1
 */
      __pyx_4 = (__pyx_v_top2 > ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top);
      if (__pyx_4) {
        __pyx_v_top2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top;
        goto __pyx_L16;
      }
      __pyx_L16:;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":375
 *                 if bottom2 < self._bottom: bottom2 = self._bottom
 *                 if top2 > self._top: top2 = self._top
 *                 roi2_sz.sz.width = right2 - left2 + 1             # <<<<<<<<<<<<<<
 *                 roi2_sz.sz.height = top2 - bottom2 + 1
 *             else:
 */
      __pyx_v_roi2_sz->sz.width = ((__pyx_v_right2 - __pyx_v_left2) + 1);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":376
 *                 if top2 > self._top: top2 = self._top
 *                 roi2_sz.sz.width = right2 - left2 + 1
 *                 roi2_sz.sz.height = top2 - bottom2 + 1             # <<<<<<<<<<<<<<
 *             else:
 *                 left2 = self._left
 */
      __pyx_v_roi2_sz->sz.height = ((__pyx_v_top2 - __pyx_v_bottom2) + 1);
      goto __pyx_L12;
    }
    /*else*/ {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":378
 *                 roi2_sz.sz.height = top2 - bottom2 + 1
 *             else:
 *                 left2 = self._left             # <<<<<<<<<<<<<<
 *                 right2 = self._right
 *                 bottom2 = self._bottom
 */
      __pyx_v_left2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":379
 *             else:
 *                 left2 = self._left
 *                 right2 = self._right             # <<<<<<<<<<<<<<
 *                 bottom2 = self._bottom
 *                 top2 = self._top
 */
      __pyx_v_right2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":380
 *                 left2 = self._left
 *                 right2 = self._right
 *                 bottom2 = self._bottom             # <<<<<<<<<<<<<<
 *                 top2 = self._top
 *                 roi2_sz.sz.width = self._roi_sz.sz.width
 */
      __pyx_v_bottom2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":381
 *                 right2 = self._right
 *                 bottom2 = self._bottom
 *                 top2 = self._top             # <<<<<<<<<<<<<<
 *                 roi2_sz.sz.width = self._roi_sz.sz.width
 *                 roi2_sz.sz.height = self._roi_sz.sz.height
 */
      __pyx_v_top2 = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":382
 *                 bottom2 = self._bottom
 *                 top2 = self._top
 *                 roi2_sz.sz.width = self._roi_sz.sz.width             # <<<<<<<<<<<<<<
 *                 roi2_sz.sz.height = self._roi_sz.sz.height
 * 
 */
      __pyx_v_roi2_sz->sz.width = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz.width;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":383
 *                 top2 = self._top
 *                 roi2_sz.sz.width = self._roi_sz.sz.width
 *                 roi2_sz.sz.height = self._roi_sz.sz.height             # <<<<<<<<<<<<<<
 * 
 *             c_python.Py_END_ALLOW_THREADS
 */
      __pyx_v_roi2_sz->sz.height = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz->sz.height;
    }
    __pyx_L12:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":385
 *                 roi2_sz.sz.height = self._roi_sz.sz.height
 * 
 *             c_python.Py_END_ALLOW_THREADS             # <<<<<<<<<<<<<<
 *             # XXX should figure out how not to release GIL here...
 *             self.absdiff_im_roi2_view = self.absdiff_im.roi(left2,bottom2,roi2_sz)
 */
    Py_END_ALLOW_THREADS;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":387
 *             c_python.Py_END_ALLOW_THREADS
 *             # XXX should figure out how not to release GIL here...
 *             self.absdiff_im_roi2_view = self.absdiff_im.roi(left2,bottom2,roi2_sz)             # <<<<<<<<<<<<<<
 *             if use_cmp:
 *                 self.cmpdiff_im_roi2_view = self.cmpdiff_im.roi(left2,bottom2,roi2_sz)
 */
    __pyx_6 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im), __pyx_kp_roi); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PyInt_FromLong(__pyx_v_left2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = PyInt_FromLong(__pyx_v_bottom2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_8 = PyTuple_New(3); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_8, 0, __pyx_1);
    PyTuple_SET_ITEM(__pyx_8, 1, __pyx_2);
    Py_INCREF(((PyObject *)__pyx_v_roi2_sz));
    PyTuple_SET_ITEM(__pyx_8, 2, ((PyObject *)__pyx_v_roi2_sz));
    __pyx_1 = 0;
    __pyx_2 = 0;
    __pyx_1 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_8), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(((PyObject *)__pyx_8)); __pyx_8 = 0;
    if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 387; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view));
    ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_1);
    __pyx_1 = 0;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":388
 *             # XXX should figure out how not to release GIL here...
 *             self.absdiff_im_roi2_view = self.absdiff_im.roi(left2,bottom2,roi2_sz)
 *             if use_cmp:             # <<<<<<<<<<<<<<
 *                 self.cmpdiff_im_roi2_view = self.cmpdiff_im.roi(left2,bottom2,roi2_sz)
 *             c_python.Py_BEGIN_ALLOW_THREADS
 */
    __pyx_7 = __pyx_v_use_cmp;
    if (__pyx_7) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":389
 *             self.absdiff_im_roi2_view = self.absdiff_im.roi(left2,bottom2,roi2_sz)
 *             if use_cmp:
 *                 self.cmpdiff_im_roi2_view = self.cmpdiff_im.roi(left2,bottom2,roi2_sz)             # <<<<<<<<<<<<<<
 *             c_python.Py_BEGIN_ALLOW_THREADS
 * 
 */
      __pyx_2 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im), __pyx_kp_roi); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = PyInt_FromLong(__pyx_v_left2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = PyInt_FromLong(__pyx_v_bottom2); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_1 = PyTuple_New(3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_1, 0, __pyx_6);
      PyTuple_SET_ITEM(__pyx_1, 1, __pyx_8);
      Py_INCREF(((PyObject *)__pyx_v_roi2_sz));
      PyTuple_SET_ITEM(__pyx_1, 2, ((PyObject *)__pyx_v_roi2_sz));
      __pyx_6 = 0;
      __pyx_8 = 0;
      __pyx_6 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
      if (!(__Pyx_TypeTest(__pyx_6, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi2_view));
      ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi2_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_6);
      __pyx_6 = 0;
      goto __pyx_L17;
    }
    __pyx_L17:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":390
 *             if use_cmp:
 *                 self.cmpdiff_im_roi2_view = self.cmpdiff_im.roi(left2,bottom2,roi2_sz)
 *             c_python.Py_BEGIN_ALLOW_THREADS             # <<<<<<<<<<<<<<
 * 
 *             # (to reduce moment arm:) if pixel < self._clear_threshold*max(pixel): pixel=0
 */
    Py_BEGIN_ALLOW_THREADS;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":394
 *             # (to reduce moment arm:) if pixel < self._clear_threshold*max(pixel): pixel=0
 * 
 *             clear_despeckle_thresh = <ipp.Ipp8u>(self._clear_threshold*max_abs_diff)             # <<<<<<<<<<<<<<
 *             if clear_despeckle_thresh < self._despeckle_threshold:
 *                 clear_despeckle_thresh = self._despeckle_threshold
 */
    __pyx_v_clear_despeckle_thresh = ((Ipp8u)(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_clear_threshold * __pyx_v_max_abs_diff));

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":395
 * 
 *             clear_despeckle_thresh = <ipp.Ipp8u>(self._clear_threshold*max_abs_diff)
 *             if clear_despeckle_thresh < self._despeckle_threshold:             # <<<<<<<<<<<<<<
 *                 clear_despeckle_thresh = self._despeckle_threshold
 * 
 */
    __pyx_5 = (__pyx_v_clear_despeckle_thresh < ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_despeckle_threshold);
    if (__pyx_5) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":396
 *             clear_despeckle_thresh = <ipp.Ipp8u>(self._clear_threshold*max_abs_diff)
 *             if clear_despeckle_thresh < self._despeckle_threshold:
 *                 clear_despeckle_thresh = self._despeckle_threshold             # <<<<<<<<<<<<<<
 * 
 *             CHK_NOGIL( ipp.ippiThreshold_Val_8u_C1IR(
 */
      __pyx_v_clear_despeckle_thresh = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_despeckle_threshold;
      goto __pyx_L18;
    }
    __pyx_L18:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":400
 *             CHK_NOGIL( ipp.ippiThreshold_Val_8u_C1IR(
 *                 <ipp.Ipp8u*>self.absdiff_im_roi2_view.im,self.absdiff_im_roi2_view.step,
 *                 roi2_sz.sz, clear_despeckle_thresh, 0, ipp.ippCmpLess))             # <<<<<<<<<<<<<<
 * 
 *             found_point = 1
 */
    CHK_NOGIL(ippiThreshold_Val_8u_C1IR(((Ipp8u *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view->__pyx_base.step, __pyx_v_roi2_sz->sz, __pyx_v_clear_despeckle_thresh, 0, ippCmpLess));

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":402
 *                 roi2_sz.sz, clear_despeckle_thresh, 0, ipp.ippCmpLess))
 * 
 *             found_point = 1             # <<<<<<<<<<<<<<
 * 
 *             if not use_cmp:
 */
    __pyx_v_found_point = 1;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":404
 *             found_point = 1
 * 
 *             if not use_cmp:             # <<<<<<<<<<<<<<
 *                 if max_abs_diff < self._diff_threshold:
 *                     x0=nan
 */
    __pyx_4 = (!__pyx_v_use_cmp);
    if (__pyx_4) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":405
 * 
 *             if not use_cmp:
 *                 if max_abs_diff < self._diff_threshold:             # <<<<<<<<<<<<<<
 *                     x0=nan
 *                     y0=nan
 */
      __pyx_5 = (__pyx_v_max_abs_diff < ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_diff_threshold);
      if (__pyx_5) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":406
 *             if not use_cmp:
 *                 if max_abs_diff < self._diff_threshold:
 *                     x0=nan             # <<<<<<<<<<<<<<
 *                     y0=nan
 *                     x0_abs = nan
 */
        __pyx_v_x0 = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":407
 *                 if max_abs_diff < self._diff_threshold:
 *                     x0=nan
 *                     y0=nan             # <<<<<<<<<<<<<<
 *                     x0_abs = nan
 *                     y0_abs = nan
 */
        __pyx_v_y0 = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":408
 *                     x0=nan
 *                     y0=nan
 *                     x0_abs = nan             # <<<<<<<<<<<<<<
 *                     y0_abs = nan
 *                     found_point = 0 # c int (bool)
 */
        __pyx_v_x0_abs = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":409
 *                     y0=nan
 *                     x0_abs = nan
 *                     y0_abs = nan             # <<<<<<<<<<<<<<
 *                     found_point = 0 # c int (bool)
 *                     max_abs_diff = 0
 */
        __pyx_v_y0_abs = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":410
 *                     x0_abs = nan
 *                     y0_abs = nan
 *                     found_point = 0 # c int (bool)             # <<<<<<<<<<<<<<
 *                     max_abs_diff = 0
 *             else:
 */
        __pyx_v_found_point = 0;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":411
 *                     y0_abs = nan
 *                     found_point = 0 # c int (bool)
 *                     max_abs_diff = 0             # <<<<<<<<<<<<<<
 *             else:
 *                 if max_std_diff == 0:
 */
        __pyx_v_max_abs_diff = 0;
        goto __pyx_L20;
      }
      __pyx_L20:;
      goto __pyx_L19;
    }
    /*else*/ {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":413
 *                     max_abs_diff = 0
 *             else:
 *                 if max_std_diff == 0:             # <<<<<<<<<<<<<<
 *                     x0=nan
 *                     y0=nan
 */
      __pyx_4 = (__pyx_v_max_std_diff == 0);
      if (__pyx_4) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":414
 *             else:
 *                 if max_std_diff == 0:
 *                     x0=nan             # <<<<<<<<<<<<<<
 *                     y0=nan
 *                     x0_abs = nan
 */
        __pyx_v_x0 = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":415
 *                 if max_std_diff == 0:
 *                     x0=nan
 *                     y0=nan             # <<<<<<<<<<<<<<
 *                     x0_abs = nan
 *                     y0_abs = nan
 */
        __pyx_v_y0 = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":416
 *                     x0=nan
 *                     y0=nan
 *                     x0_abs = nan             # <<<<<<<<<<<<<<
 *                     y0_abs = nan
 *                     found_point = 0 # c int (bool)
 */
        __pyx_v_x0_abs = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":417
 *                     y0=nan
 *                     x0_abs = nan
 *                     y0_abs = nan             # <<<<<<<<<<<<<<
 *                     found_point = 0 # c int (bool)
 *             if found_point:
 */
        __pyx_v_y0_abs = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":418
 *                     x0_abs = nan
 *                     y0_abs = nan
 *                     found_point = 0 # c int (bool)             # <<<<<<<<<<<<<<
 *             if found_point:
 *                 result = fit_params.fit_params(
 */
        __pyx_v_found_point = 0;
        goto __pyx_L21;
      }
      __pyx_L21:;
    }
    __pyx_L19:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":419
 *                     y0_abs = nan
 *                     found_point = 0 # c int (bool)
 *             if found_point:             # <<<<<<<<<<<<<<
 *                 result = fit_params.fit_params(
 *                     self.pState, &x0, &y0,
 */
    __pyx_7 = __pyx_v_found_point;
    if (__pyx_7) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":426
 *                     roi2_sz.sz.width, roi2_sz.sz.height,
 *                     <unsigned char*>self.absdiff_im_roi2_view.im,
 *                     self.absdiff_im_roi2_view.step)             # <<<<<<<<<<<<<<
 *                 # note that x0 and y0 are now relative to the ROI origin
 *                 if result == fit_params.CFitParamsNoError:
 */
      __pyx_v_result = fit_params(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->pState, (&__pyx_v_x0), (&__pyx_v_y0), (&__pyx_v_Mu00), (&__pyx_v_Uu11), (&__pyx_v_Uu20), (&__pyx_v_Uu02), __pyx_v_roi2_sz->sz.width, __pyx_v_roi2_sz->sz.height, ((unsigned char *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view->__pyx_base.im), ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view->__pyx_base.step);

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":428
 *                     self.absdiff_im_roi2_view.step)
 *                 # note that x0 and y0 are now relative to the ROI origin
 *                 if result == fit_params.CFitParamsNoError:             # <<<<<<<<<<<<<<
 *                     area = Mu00
 *                     eigen_err = eigen_2x2_real( Uu20, Uu11,
 */
      __pyx_5 = (__pyx_v_result == CFitParamsNoError);
      if (__pyx_5) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":429
 *                 # note that x0 and y0 are now relative to the ROI origin
 *                 if result == fit_params.CFitParamsNoError:
 *                     area = Mu00             # <<<<<<<<<<<<<<
 *                     eigen_err = eigen_2x2_real( Uu20, Uu11,
 *                                                 Uu11, Uu02,
 */
        __pyx_v_area = __pyx_v_Mu00;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":433
 *                                                 Uu11, Uu02,
 *                                                 &evalA, &evecA1,
 *                                                 &evalB, &evecB1)             # <<<<<<<<<<<<<<
 *                     if eigen_err:
 *                         slope = nan
 */
        __pyx_v_eigen_err = eigen_2x2_real(__pyx_v_Uu20, __pyx_v_Uu11, __pyx_v_Uu11, __pyx_v_Uu02, (&__pyx_v_evalA), (&__pyx_v_evecA1), (&__pyx_v_evalB), (&__pyx_v_evecB1));

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":434
 *                                                 &evalA, &evecA1,
 *                                                 &evalB, &evecB1)
 *                     if eigen_err:             # <<<<<<<<<<<<<<
 *                         slope = nan
 *                         eccentricity = 0.0
 */
        __pyx_7 = __pyx_v_eigen_err;
        if (__pyx_7) {

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":435
 *                                                 &evalB, &evecB1)
 *                     if eigen_err:
 *                         slope = nan             # <<<<<<<<<<<<<<
 *                         eccentricity = 0.0
 *                     else:
 */
          __pyx_v_slope = __pyx_v_23realtime_image_analysis_nan;

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":436
 *                     if eigen_err:
 *                         slope = nan
 *                         eccentricity = 0.0             # <<<<<<<<<<<<<<
 *                     else:
 *                         rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 */
          __pyx_v_eccentricity = 0.0;
          goto __pyx_L24;
        }
        /*else*/ {

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":438
 *                         eccentricity = 0.0
 *                     else:
 *                         rise = 1.0 # 2nd component of eigenvectors will always be 1.0             # <<<<<<<<<<<<<<
 *                         if evalA > evalB:
 *                             run = evecA1
 */
          __pyx_v_rise = 1.0;

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":439
 *                     else:
 *                         rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 *                         if evalA > evalB:             # <<<<<<<<<<<<<<
 *                             run = evecA1
 *                             eccentricity = evalA/evalB
 */
          __pyx_4 = (__pyx_v_evalA > __pyx_v_evalB);
          if (__pyx_4) {

            /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":440
 *                         rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 *                         if evalA > evalB:
 *                             run = evecA1             # <<<<<<<<<<<<<<
 *                             eccentricity = evalA/evalB
 *                         else:
 */
            __pyx_v_run = __pyx_v_evecA1;

            /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":441
 *                         if evalA > evalB:
 *                             run = evecA1
 *                             eccentricity = evalA/evalB             # <<<<<<<<<<<<<<
 *                         else:
 *                             run = evecB1
 */
            __pyx_v_eccentricity = (__pyx_v_evalA / __pyx_v_evalB);
            goto __pyx_L25;
          }
          /*else*/ {

            /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":443
 *                             eccentricity = evalA/evalB
 *                         else:
 *                             run = evecB1             # <<<<<<<<<<<<<<
 *                             eccentricity = evalB/evalA
 *                         slope = rise/run
 */
            __pyx_v_run = __pyx_v_evecB1;

            /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":444
 *                         else:
 *                             run = evecB1
 *                             eccentricity = evalB/evalA             # <<<<<<<<<<<<<<
 *                         slope = rise/run
 * 
 */
            __pyx_v_eccentricity = (__pyx_v_evalB / __pyx_v_evalA);
          }
          __pyx_L25:;

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":445
 *                             run = evecB1
 *                             eccentricity = evalB/evalA
 *                         slope = rise/run             # <<<<<<<<<<<<<<
 * 
 *                 elif result == fit_params.CFitParamsZeroMomentError:
 */
          __pyx_v_slope = (__pyx_v_rise / __pyx_v_run);
        }
        __pyx_L24:;
        goto __pyx_L23;
      }

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":447
 *                         slope = rise/run
 * 
 *                 elif result == fit_params.CFitParamsZeroMomentError:             # <<<<<<<<<<<<<<
 *                     x0 = nan
 *                     y0 = nan
 */
      __pyx_5 = (__pyx_v_result == CFitParamsZeroMomentError);
      if (__pyx_5) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":448
 * 
 *                 elif result == fit_params.CFitParamsZeroMomentError:
 *                     x0 = nan             # <<<<<<<<<<<<<<
 *                     y0 = nan
 *                     x0_abs = nan
 */
        __pyx_v_x0 = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":449
 *                 elif result == fit_params.CFitParamsZeroMomentError:
 *                     x0 = nan
 *                     y0 = nan             # <<<<<<<<<<<<<<
 *                     x0_abs = nan
 *                     y0_abs = nan
 */
        __pyx_v_y0 = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":450
 *                     x0 = nan
 *                     y0 = nan
 *                     x0_abs = nan             # <<<<<<<<<<<<<<
 *                     y0_abs = nan
 *                     found_point = 0
 */
        __pyx_v_x0_abs = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":451
 *                     y0 = nan
 *                     x0_abs = nan
 *                     y0_abs = nan             # <<<<<<<<<<<<<<
 *                     found_point = 0
 *                 elif result == fit_params.CFitParamsCentralMomentError:
 */
        __pyx_v_y0_abs = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":452
 *                     x0_abs = nan
 *                     y0_abs = nan
 *                     found_point = 0             # <<<<<<<<<<<<<<
 *                 elif result == fit_params.CFitParamsCentralMomentError:
 *                     slope = nan
 */
        __pyx_v_found_point = 0;
        goto __pyx_L23;
      }

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":453
 *                     y0_abs = nan
 *                     found_point = 0
 *                 elif result == fit_params.CFitParamsCentralMomentError:             # <<<<<<<<<<<<<<
 *                     slope = nan
 *                 else: SET_ERR(1)
 */
      __pyx_4 = (__pyx_v_result == CFitParamsCentralMomentError);
      if (__pyx_4) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":454
 *                     found_point = 0
 *                 elif result == fit_params.CFitParamsCentralMomentError:
 *                     slope = nan             # <<<<<<<<<<<<<<
 *                 else: SET_ERR(1)
 * 
 */
        __pyx_v_slope = __pyx_v_23realtime_image_analysis_nan;
        goto __pyx_L23;
      }
      /*else*/ {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":455
 *                 elif result == fit_params.CFitParamsCentralMomentError:
 *                     slope = nan
 *                 else: SET_ERR(1)             # <<<<<<<<<<<<<<
 * 
 *                 # set x0 and y0 relative to whole frame
 */
        SET_ERR(1);
      }
      __pyx_L23:;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":458
 * 
 *                 # set x0 and y0 relative to whole frame
 *                 if found_point:             # <<<<<<<<<<<<<<
 *                     x0_abs = x0+left2
 *                     y0_abs = y0+bottom2
 */
      __pyx_7 = __pyx_v_found_point;
      if (__pyx_7) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":459
 *                 # set x0 and y0 relative to whole frame
 *                 if found_point:
 *                     x0_abs = x0+left2             # <<<<<<<<<<<<<<
 *                     y0_abs = y0+bottom2
 * 
 */
        __pyx_v_x0_abs = (__pyx_v_x0 + __pyx_v_left2);

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":460
 *                 if found_point:
 *                     x0_abs = x0+left2
 *                     y0_abs = y0+bottom2             # <<<<<<<<<<<<<<
 * 
 *             # grab GIL
 */
        __pyx_v_y0_abs = (__pyx_v_y0 + __pyx_v_bottom2);
        goto __pyx_L26;
      }
      __pyx_L26:;
      goto __pyx_L22;
    }
    __pyx_L22:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":463
 * 
 *             # grab GIL
 *             c_python.Py_END_ALLOW_THREADS             # <<<<<<<<<<<<<<
 * 
 *             if found_point:
 */
    Py_END_ALLOW_THREADS;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":465
 *             c_python.Py_END_ALLOW_THREADS
 * 
 *             if found_point:             # <<<<<<<<<<<<<<
 *                 if not (n_found_points+1>=self.max_num_points): # only modify the image if more follow...
 *                     self.absdiff_im_roi2_view.set_val(0, roi2_sz )
 */
    __pyx_7 = __pyx_v_found_point;
    if (__pyx_7) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":466
 * 
 *             if found_point:
 *                 if not (n_found_points+1>=self.max_num_points): # only modify the image if more follow...             # <<<<<<<<<<<<<<
 *                     self.absdiff_im_roi2_view.set_val(0, roi2_sz )
 * 
 */
      __pyx_5 = (!((__pyx_v_n_found_points + 1) >= ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->max_num_points));
      if (__pyx_5) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":467
 *             if found_point:
 *                 if not (n_found_points+1>=self.max_num_points): # only modify the image if more follow...
 *                     self.absdiff_im_roi2_view.set_val(0, roi2_sz )             # <<<<<<<<<<<<<<
 * 
 *             if not found_point:
 */
        __pyx_8 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi2_view), __pyx_kp_set_val); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_INCREF(__pyx_int_0);
        PyTuple_SET_ITEM(__pyx_2, 0, __pyx_int_0);
        Py_INCREF(((PyObject *)__pyx_v_roi2_sz));
        PyTuple_SET_ITEM(__pyx_2, 1, ((PyObject *)__pyx_v_roi2_sz));
        __pyx_1 = PyObject_Call(__pyx_8, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_8); __pyx_8 = 0;
        Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
        Py_DECREF(__pyx_1); __pyx_1 = 0;
        goto __pyx_L28;
      }
      __pyx_L28:;
      goto __pyx_L27;
    }
    __pyx_L27:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":469
 *                     self.absdiff_im_roi2_view.set_val(0, roi2_sz )
 * 
 *             if not found_point:             # <<<<<<<<<<<<<<
 *                 break
 * 
 */
    __pyx_4 = (!__pyx_v_found_point);
    if (__pyx_4) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":470
 * 
 *             if not found_point:
 *                 break             # <<<<<<<<<<<<<<
 * 
 *             if return_debug_values:
 */
      goto __pyx_L8;
      goto __pyx_L29;
    }
    __pyx_L29:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":472
 *                 break
 * 
 *             if return_debug_values:             # <<<<<<<<<<<<<<
 *                 pt_tuple = (x0_abs, y0_abs, area, slope, eccentricity, index_x, index_y)
 *             else:
 */
    __pyx_7 = __pyx_v_return_debug_values;
    if (__pyx_7) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":473
 * 
 *             if return_debug_values:
 *                 pt_tuple = (x0_abs, y0_abs, area, slope, eccentricity, index_x, index_y)             # <<<<<<<<<<<<<<
 *             else:
 *                 pt_tuple = (x0_abs, y0_abs, area, slope, eccentricity)
 */
      __pyx_6 = PyFloat_FromDouble(__pyx_v_x0_abs); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = PyFloat_FromDouble(__pyx_v_y0_abs); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = PyFloat_FromDouble(__pyx_v_area); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_1 = PyFloat_FromDouble(__pyx_v_slope); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_9 = PyFloat_FromDouble(__pyx_v_eccentricity); if (unlikely(!__pyx_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_10 = PyInt_FromLong(__pyx_v_index_x); if (unlikely(!__pyx_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_11 = PyInt_FromLong(__pyx_v_index_y); if (unlikely(!__pyx_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = PyTuple_New(7); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_12, 0, __pyx_6);
      PyTuple_SET_ITEM(__pyx_12, 1, __pyx_8);
      PyTuple_SET_ITEM(__pyx_12, 2, __pyx_2);
      PyTuple_SET_ITEM(__pyx_12, 3, __pyx_1);
      PyTuple_SET_ITEM(__pyx_12, 4, __pyx_9);
      PyTuple_SET_ITEM(__pyx_12, 5, __pyx_10);
      PyTuple_SET_ITEM(__pyx_12, 6, __pyx_11);
      __pyx_6 = 0;
      __pyx_8 = 0;
      __pyx_2 = 0;
      __pyx_1 = 0;
      __pyx_9 = 0;
      __pyx_10 = 0;
      __pyx_11 = 0;
      Py_DECREF(__pyx_v_pt_tuple);
      __pyx_v_pt_tuple = ((PyObject *)__pyx_12);
      __pyx_12 = 0;
      goto __pyx_L30;
    }
    /*else*/ {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":475
 *                 pt_tuple = (x0_abs, y0_abs, area, slope, eccentricity, index_x, index_y)
 *             else:
 *                 pt_tuple = (x0_abs, y0_abs, area, slope, eccentricity)             # <<<<<<<<<<<<<<
 * 
 *             all_points_found.append(pt_tuple)
 */
      __pyx_6 = PyFloat_FromDouble(__pyx_v_x0_abs); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = PyFloat_FromDouble(__pyx_v_y0_abs); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = PyFloat_FromDouble(__pyx_v_area); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_1 = PyFloat_FromDouble(__pyx_v_slope); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_9 = PyFloat_FromDouble(__pyx_v_eccentricity); if (unlikely(!__pyx_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_10 = PyTuple_New(5); if (unlikely(!__pyx_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_10, 0, __pyx_6);
      PyTuple_SET_ITEM(__pyx_10, 1, __pyx_8);
      PyTuple_SET_ITEM(__pyx_10, 2, __pyx_2);
      PyTuple_SET_ITEM(__pyx_10, 3, __pyx_1);
      PyTuple_SET_ITEM(__pyx_10, 4, __pyx_9);
      __pyx_6 = 0;
      __pyx_8 = 0;
      __pyx_2 = 0;
      __pyx_1 = 0;
      __pyx_9 = 0;
      Py_DECREF(__pyx_v_pt_tuple);
      __pyx_v_pt_tuple = ((PyObject *)__pyx_10);
      __pyx_10 = 0;
    }
    __pyx_L30:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":477
 *                 pt_tuple = (x0_abs, y0_abs, area, slope, eccentricity)
 * 
 *             all_points_found.append(pt_tuple)             # <<<<<<<<<<<<<<
 *             n_found_points = n_found_points+1
 * 
 */
    __pyx_11 = __Pyx_PyObject_Append(__pyx_v_all_points_found, __pyx_v_pt_tuple); if (unlikely(!__pyx_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_11); __pyx_11 = 0;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":478
 * 
 *             all_points_found.append(pt_tuple)
 *             n_found_points = n_found_points+1             # <<<<<<<<<<<<<<
 * 
 *         return all_points_found
 */
    __pyx_v_n_found_points = (__pyx_v_n_found_points + 1);
  }
  __pyx_L8:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":480
 *             n_found_points = n_found_points+1
 * 
 *         return all_points_found             # <<<<<<<<<<<<<<
 * 
 *     def get_image_view(self,which='mean'):
 */
  Py_INCREF(__pyx_v_all_points_found);
  __pyx_r = __pyx_v_all_points_found;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  Py_XDECREF(__pyx_11);
  Py_XDECREF(__pyx_12);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.do_work");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_roi2_sz);
  Py_DECREF(__pyx_v_all_points_found);
  Py_DECREF(__pyx_v_pt_tuple);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":482
 *         return all_points_found
 * 
 *     def get_image_view(self,which='mean'):             # <<<<<<<<<<<<<<
 *         im = self.imname2im[which]
 *         return im
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_get_image_view(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_get_image_view(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_which = 0;
  PyObject *__pyx_v_im;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  static char *__pyx_argnames[] = {"which",0};
  __pyx_v_which = __pyx_kp_3;
  if (likely(!__pyx_kwds) && likely(0 <= PyTuple_GET_SIZE(__pyx_args)) && likely(PyTuple_GET_SIZE(__pyx_args) <= 1)) {
    if (PyTuple_GET_SIZE(__pyx_args) > 0) {
      __pyx_v_which = PyTuple_GET_ITEM(__pyx_args, 0);
    }
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "|O", __pyx_argnames, &__pyx_v_which))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 482; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.get_image_view");
  return NULL;
  __pyx_L4:;
  __pyx_v_im = Py_None; Py_INCREF(Py_None);

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":483
 * 
 *     def get_image_view(self,which='mean'):
 *         im = self.imname2im[which]             # <<<<<<<<<<<<<<
 *         return im
 * 
 */
  __pyx_1 = PyObject_GetItem(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->imname2im, __pyx_v_which); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 483; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_im);
  __pyx_v_im = __pyx_1;
  __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":484
 *     def get_image_view(self,which='mean'):
 *         im = self.imname2im[which]
 *         return im             # <<<<<<<<<<<<<<
 * 
 *     property roi2_radius:
 */
  Py_INCREF(__pyx_v_im);
  __pyx_r = __pyx_v_im;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.get_image_view");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_im);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":487
 * 
 *     property roi2_radius:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._roi2_radius
 *         def __set__(self,value):
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_11roi2_radius___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_11roi2_radius___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":488
 *     property roi2_radius:
 *         def __get__(self):
 *             return self._roi2_radius             # <<<<<<<<<<<<<<
 *         def __set__(self,value):
 *             self._roi2_radius = value
 */
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.roi2_radius.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":489
 *         def __get__(self):
 *             return self._roi2_radius
 *         def __set__(self,value):             # <<<<<<<<<<<<<<
 *             self._roi2_radius = value
 * 
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_11roi2_radius___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_11roi2_radius___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  int __pyx_1;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":490
 *             return self._roi2_radius
 *         def __set__(self,value):
 *             self._roi2_radius = value             # <<<<<<<<<<<<<<
 * 
 *     property clear_threshold:
 */
  __pyx_1 = __pyx_PyInt_int(__pyx_v_value); if (unlikely((__pyx_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 490; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi2_radius = __pyx_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.roi2_radius.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":493
 * 
 *     property clear_threshold:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._clear_threshold
 *         def __set__(self,value):
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_15clear_threshold___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_15clear_threshold___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":494
 *     property clear_threshold:
 *         def __get__(self):
 *             return self._clear_threshold             # <<<<<<<<<<<<<<
 *         def __set__(self,value):
 *             self._clear_threshold = value
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_clear_threshold); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.clear_threshold.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":495
 *         def __get__(self):
 *             return self._clear_threshold
 *         def __set__(self,value):             # <<<<<<<<<<<<<<
 *             self._clear_threshold = value
 * 
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_15clear_threshold___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_15clear_threshold___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  float __pyx_1;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":496
 *             return self._clear_threshold
 *         def __set__(self,value):
 *             self._clear_threshold = value             # <<<<<<<<<<<<<<
 * 
 *     property diff_threshold:
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 496; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_clear_threshold = __pyx_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.clear_threshold.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":499
 * 
 *     property diff_threshold:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._diff_threshold
 *         def __set__(self,value):
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_14diff_threshold___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_14diff_threshold___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":500
 *     property diff_threshold:
 *         def __get__(self):
 *             return self._diff_threshold             # <<<<<<<<<<<<<<
 *         def __set__(self,value):
 *             self._diff_threshold = value
 */
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_diff_threshold); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.diff_threshold.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":501
 *         def __get__(self):
 *             return self._diff_threshold
 *         def __set__(self,value):             # <<<<<<<<<<<<<<
 *             self._diff_threshold = value
 * 
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_14diff_threshold___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_14diff_threshold___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  Ipp8u __pyx_1;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":502
 *             return self._diff_threshold
 *         def __set__(self,value):
 *             self._diff_threshold = value             # <<<<<<<<<<<<<<
 * 
 *     property scale_factor:
 */
  __pyx_1 = __pyx_PyInt_unsigned_char(__pyx_v_value); if (unlikely((__pyx_1 == (unsigned char)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 502; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_diff_threshold = __pyx_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.diff_threshold.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":505
 * 
 *     property scale_factor:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return self._scale_factor
 *         def __set__(self,value):
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_12scale_factor___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_12scale_factor___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":506
 *     property scale_factor:
 *         def __get__(self):
 *             return self._scale_factor             # <<<<<<<<<<<<<<
 *         def __set__(self,value):
 *             print 'setting scale_factor to',value
 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp__scale_factor); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 506; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_r = __pyx_1;
  __pyx_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.scale_factor.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":507
 *         def __get__(self):
 *             return self._scale_factor
 *         def __set__(self,value):             # <<<<<<<<<<<<<<
 *             print 'setting scale_factor to',value
 *             self._scale_factor = value
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_12scale_factor___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_12scale_factor___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
  int __pyx_r;
  PyObject *__pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":508
 *             return self._scale_factor
 *         def __set__(self,value):
 *             print 'setting scale_factor to',value             # <<<<<<<<<<<<<<
 *             self._scale_factor = value
 * 
 */
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_13);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_kp_13);
  Py_INCREF(__pyx_v_value);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_v_value);
  if (__Pyx_Print(((PyObject *)__pyx_1), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 508; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":509
 *         def __set__(self,value):
 *             print 'setting scale_factor to',value
 *             self._scale_factor = value             # <<<<<<<<<<<<<<
 * 
 *     property roi:
 */
  if (PyObject_SetAttr(__pyx_v_self, __pyx_kp__scale_factor, __pyx_v_value) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 509; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.scale_factor.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":512
 * 
 *     property roi:
 *         def __get__(self):             # <<<<<<<<<<<<<<
 *             return (self._left,self._bottom,self._right,self._top)
 *         def __set__(self,object lbrt):
 */

static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_3roi___get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_3roi___get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":513
 *     property roi:
 *         def __get__(self):
 *             return (self._left,self._bottom,self._right,self._top)             # <<<<<<<<<<<<<<
 *         def __set__(self,object lbrt):
 *             cdef int l,b,r,t
 */
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(4); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 513; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 2, __pyx_3);
  PyTuple_SET_ITEM(__pyx_5, 3, __pyx_4);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_r = ((PyObject *)__pyx_5);
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.roi.__get__");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":514
 *         def __get__(self):
 *             return (self._left,self._bottom,self._right,self._top)
 *         def __set__(self,object lbrt):             # <<<<<<<<<<<<<<
 *             cdef int l,b,r,t
 * 
 */

static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_3roi___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_lbrt); /*proto*/
static int __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_3roi___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_lbrt) {
  int __pyx_v_l;
  int __pyx_v_b;
  int __pyx_v_r;
  int __pyx_v_t;
  int __pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  int __pyx_4;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":517
 *             cdef int l,b,r,t
 * 
 *             l,b,r,t = lbrt             # <<<<<<<<<<<<<<
 *             if (l==self._left and b==self._bottom and
 *                 r==self._right and t==self._top):
 */
  if (PyTuple_CheckExact(__pyx_v_lbrt) && PyTuple_GET_SIZE(__pyx_v_lbrt) == 4) {
    PyObject* tuple = __pyx_v_lbrt;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 0);
    Py_INCREF(__pyx_2);
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_l = __pyx_3;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 1);
    Py_INCREF(__pyx_2);
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_b = __pyx_3;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 2);
    Py_INCREF(__pyx_2);
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_r = __pyx_3;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 3);
    Py_INCREF(__pyx_2);
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_t = __pyx_3;
  }
  else {
    __pyx_1 = PyObject_GetIter(__pyx_v_lbrt); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_l = __pyx_3;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_b = __pyx_3;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_r = __pyx_3;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = __pyx_PyInt_int(__pyx_2); if (unlikely((__pyx_3 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_v_t = __pyx_3;
    if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 517; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":518
 * 
 *             l,b,r,t = lbrt
 *             if (l==self._left and b==self._bottom and             # <<<<<<<<<<<<<<
 *                 r==self._right and t==self._top):
 *                 # nothing to do
 */
  __pyx_4 = (__pyx_v_l == ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left);
  if (__pyx_4) {
    __pyx_4 = (__pyx_v_b == ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom);
    if (__pyx_4) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":519
 *             l,b,r,t = lbrt
 *             if (l==self._left and b==self._bottom and
 *                 r==self._right and t==self._top):             # <<<<<<<<<<<<<<
 *                 # nothing to do
 *                 return
 */
      __pyx_4 = (__pyx_v_r == ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right);
      if (__pyx_4) {
        __pyx_4 = (__pyx_v_t == ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top);
      }
    }
  }
  if (__pyx_4) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":521
 *                 r==self._right and t==self._top):
 *                 # nothing to do
 *                 return             # <<<<<<<<<<<<<<
 * 
 *             self._left = l
 */
    __pyx_r = 0;
    goto __pyx_L0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":523
 *                 return
 * 
 *             self._left = l             # <<<<<<<<<<<<<<
 *             self._bottom = b
 *             self._right = r
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left = __pyx_v_l;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":524
 * 
 *             self._left = l
 *             self._bottom = b             # <<<<<<<<<<<<<<
 *             self._right = r
 *             self._top = t
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom = __pyx_v_b;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":525
 *             self._left = l
 *             self._bottom = b
 *             self._right = r             # <<<<<<<<<<<<<<
 *             self._top = t
 * 
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right = __pyx_v_r;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":526
 *             self._bottom = b
 *             self._right = r
 *             self._top = t             # <<<<<<<<<<<<<<
 * 
 *             if self._left < 0:
 */
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top = __pyx_v_t;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":528
 *             self._top = t
 * 
 *             if self._left < 0:             # <<<<<<<<<<<<<<
 *                 raise ValueError('attempting to set ROI left %d'%(self._left))
 *             if self._bottom < 0:
 */
  __pyx_4 = (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left < 0);
  if (__pyx_4) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":529
 * 
 *             if self._left < 0:
 *                 raise ValueError('attempting to set ROI left %d'%(self._left))             # <<<<<<<<<<<<<<
 *             if self._bottom < 0:
 *                 raise ValueError('attempting to set ROI bottom %d'%(self._bottom))
 */
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PyNumber_Remainder(__pyx_kp_14, __pyx_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
    __pyx_1 = 0;
    __pyx_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
    __Pyx_Raise(__pyx_1, 0, 0);
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 529; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":530
 *             if self._left < 0:
 *                 raise ValueError('attempting to set ROI left %d'%(self._left))
 *             if self._bottom < 0:             # <<<<<<<<<<<<<<
 *                 raise ValueError('attempting to set ROI bottom %d'%(self._bottom))
 *             if self._right >= self.maxwidth:
 */
  __pyx_4 = (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom < 0);
  if (__pyx_4) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":531
 *                 raise ValueError('attempting to set ROI left %d'%(self._left))
 *             if self._bottom < 0:
 *                 raise ValueError('attempting to set ROI bottom %d'%(self._bottom))             # <<<<<<<<<<<<<<
 *             if self._right >= self.maxwidth:
 *                 raise ValueError('attempting to set ROI right to %d (width %d)'%(self._right,self.maxwidth))
 */
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PyNumber_Remainder(__pyx_kp_15, __pyx_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
    __pyx_1 = 0;
    __pyx_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
    __Pyx_Raise(__pyx_1, 0, 0);
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 531; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":532
 *             if self._bottom < 0:
 *                 raise ValueError('attempting to set ROI bottom %d'%(self._bottom))
 *             if self._right >= self.maxwidth:             # <<<<<<<<<<<<<<
 *                 raise ValueError('attempting to set ROI right to %d (width %d)'%(self._right,self.maxwidth))
 *             if self._top >= self.maxheight:
 */
  __pyx_4 = (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right >= ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxwidth);
  if (__pyx_4) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":533
 *                 raise ValueError('attempting to set ROI bottom %d'%(self._bottom))
 *             if self._right >= self.maxwidth:
 *                 raise ValueError('attempting to set ROI right to %d (width %d)'%(self._right,self.maxwidth))             # <<<<<<<<<<<<<<
 *             if self._top >= self.maxheight:
 *                 raise ValueError('attempting to set ROI top to %d (height %d)'%(self._top,self.maxheight))
 */
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxwidth); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_5 = PyTuple_New(2); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_1);
    __pyx_2 = 0;
    __pyx_1 = 0;
    __pyx_2 = PyNumber_Remainder(__pyx_kp_16, ((PyObject *)__pyx_5)); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
    __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_5 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __Pyx_Raise(__pyx_5, 0, 0);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 533; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":534
 *             if self._right >= self.maxwidth:
 *                 raise ValueError('attempting to set ROI right to %d (width %d)'%(self._right,self.maxwidth))
 *             if self._top >= self.maxheight:             # <<<<<<<<<<<<<<
 *                 raise ValueError('attempting to set ROI top to %d (height %d)'%(self._top,self.maxheight))
 * 
 */
  __pyx_4 = (((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top >= ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxheight);
  if (__pyx_4) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":535
 *                 raise ValueError('attempting to set ROI right to %d (width %d)'%(self._right,self.maxwidth))
 *             if self._top >= self.maxheight:
 *                 raise ValueError('attempting to set ROI top to %d (height %d)'%(self._top,self.maxheight))             # <<<<<<<<<<<<<<
 * 
 *             self._roi_sz = FastImage.Size( self._right-self._left+1, self._top-self._bottom+1 )
 */
    __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->maxheight); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_5 = PyTuple_New(2); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
    PyTuple_SET_ITEM(__pyx_5, 1, __pyx_1);
    __pyx_2 = 0;
    __pyx_1 = 0;
    __pyx_2 = PyNumber_Remainder(__pyx_kp_17, ((PyObject *)__pyx_5)); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
    __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_5 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __Pyx_Raise(__pyx_5, 0, 0);
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":537
 *                 raise ValueError('attempting to set ROI top to %d (height %d)'%(self._top,self.maxheight))
 * 
 *             self._roi_sz = FastImage.Size( self._right-self._left+1, self._top-self._bottom+1 )             # <<<<<<<<<<<<<<
 * 
 *             self.absdiff_im_roi_view = self.absdiff_im.roi(self._left,self._bottom,self._roi_sz)
 */
  __pyx_2 = PyInt_FromLong(((((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_right - ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left) + 1)); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyInt_FromLong(((((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_top - ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom) + 1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(2); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_1);
  __pyx_2 = 0;
  __pyx_1 = 0;
  __pyx_2 = PyObject_Call(((PyObject*)__pyx_ptype_6motmot_9FastImage_9FastImage_Size), ((PyObject *)__pyx_5), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
  if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_6motmot_9FastImage_9FastImage_Size))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":539
 *             self._roi_sz = FastImage.Size( self._right-self._left+1, self._top-self._bottom+1 )
 * 
 *             self.absdiff_im_roi_view = self.absdiff_im.roi(self._left,self._bottom,self._roi_sz)             # <<<<<<<<<<<<<<
 *             self.mean_im_roi_view = self.mean_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.cmp_im_roi_view = self.cmp_im.roi(self._left,self._bottom,self._roi_sz)
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im), __pyx_kp_roi); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyTuple_New(3); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_6, 0, __pyx_5);
  PyTuple_SET_ITEM(__pyx_6, 1, __pyx_2);
  Py_INCREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  PyTuple_SET_ITEM(__pyx_6, 2, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  __pyx_5 = 0;
  __pyx_2 = 0;
  __pyx_5 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_6), NULL); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
  if (!(__Pyx_TypeTest(__pyx_5, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->absdiff_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_5);
  __pyx_5 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":540
 * 
 *             self.absdiff_im_roi_view = self.absdiff_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.mean_im_roi_view = self.mean_im.roi(self._left,self._bottom,self._roi_sz)             # <<<<<<<<<<<<<<
 *             self.cmp_im_roi_view = self.cmp_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.cmpdiff_im_roi_view = self.cmpdiff_im.roi(self._left,self._bottom,self._roi_sz)
 */
  __pyx_2 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im), __pyx_kp_roi); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(3); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_6);
  Py_INCREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  PyTuple_SET_ITEM(__pyx_5, 2, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  __pyx_1 = 0;
  __pyx_6 = 0;
  __pyx_1 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_5), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
  if (!(__Pyx_TypeTest(__pyx_1, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 540; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im_roi_view));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->mean_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":541
 *             self.absdiff_im_roi_view = self.absdiff_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.mean_im_roi_view = self.mean_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.cmp_im_roi_view = self.cmp_im.roi(self._left,self._bottom,self._roi_sz)             # <<<<<<<<<<<<<<
 *             self.cmpdiff_im_roi_view = self.cmpdiff_im.roi(self._left,self._bottom,self._roi_sz)
 * 
 */
  __pyx_6 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im), __pyx_kp_roi); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_5);
  Py_INCREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  PyTuple_SET_ITEM(__pyx_1, 2, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  __pyx_2 = 0;
  __pyx_5 = 0;
  __pyx_2 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (!(__Pyx_TypeTest(__pyx_2, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im_roi_view));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmp_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":542
 *             self.mean_im_roi_view = self.mean_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.cmp_im_roi_view = self.cmp_im.roi(self._left,self._bottom,self._roi_sz)
 *             self.cmpdiff_im_roi_view = self.cmpdiff_im.roi(self._left,self._bottom,self._roi_sz)             # <<<<<<<<<<<<<<
 * 
 * def fit_slope(FastImage.FastImage8u im):
 */
  __pyx_5 = PyObject_GetAttr(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im), __pyx_kp_roi); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_left); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyInt_FromLong(((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_bottom); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_6);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_1);
  Py_INCREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  PyTuple_SET_ITEM(__pyx_2, 2, ((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->_roi_sz));
  __pyx_6 = 0;
  __pyx_1 = 0;
  __pyx_6 = PyObject_Call(__pyx_5, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (!(__Pyx_TypeTest(__pyx_6, __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 542; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi_view));
  ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)__pyx_v_self)->cmpdiff_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_6);
  __pyx_6 = 0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("realtime_image_analysis.RealtimeAnalyzer.roi.__set__");
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":544
 *             self.cmpdiff_im_roi_view = self.cmpdiff_im.roi(self._left,self._bottom,self._roi_sz)
 * 
 * def fit_slope(FastImage.FastImage8u im):             # <<<<<<<<<<<<<<
 *     cdef ipp.IppiMomentState_64f *pState
 *     cdef double x0, y0
 */

static PyObject *__pyx_pf_23realtime_image_analysis_fit_slope(PyObject *__pyx_self, PyObject *__pyx_v_im); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_fit_slope(PyObject *__pyx_self, PyObject *__pyx_v_im) {
  IppiMomentState_64f *__pyx_v_pState;
  double __pyx_v_x0;
  double __pyx_v_y0;
  double __pyx_v_rise;
  double __pyx_v_run;
  double __pyx_v_slope;
  double __pyx_v_eccentricity;
  double __pyx_v_evalA;
  double __pyx_v_evalB;
  double __pyx_v_evecA1;
  double __pyx_v_evecB1;
  double __pyx_v_Mu00;
  double __pyx_v_Uu11;
  double __pyx_v_Uu02;
  double __pyx_v_Uu20;
  int __pyx_v_result;
  int __pyx_v_eigen_err;
  PyObject *__pyx_v_area;
  PyObject *__pyx_v_x0_abs;
  PyObject *__pyx_v_y0_abs;
  PyObject *__pyx_v_found_point;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  __pyx_self = __pyx_self;
  __pyx_v_area = Py_None; Py_INCREF(Py_None);
  __pyx_v_x0_abs = Py_None; Py_INCREF(Py_None);
  __pyx_v_y0_abs = Py_None; Py_INCREF(Py_None);
  __pyx_v_found_point = Py_None; Py_INCREF(Py_None);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":554
 *     cdef int result, eigen_err
 * 
 *     CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &pState, ipp.ippAlgHintFast ) )             # <<<<<<<<<<<<<<
 *     try:
 *         result = fit_params.fit_params( pState, &x0, &y0,
 */
  __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(ippiMomentInitAlloc_64f((&__pyx_v_pState), ippAlgHintFast)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 554; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":555
 * 
 *     CHK_HAVEGIL( ipp.ippiMomentInitAlloc_64f( &pState, ipp.ippAlgHintFast ) )
 *     try:             # <<<<<<<<<<<<<<
 *         result = fit_params.fit_params( pState, &x0, &y0,
 *                                         &Mu00,
 */
  /*try:*/ {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":561
 *                                         im.imsiz.sz.width, im.imsiz.sz.height,
 *                                         <unsigned char*>im.im,
 *                                         im.step)             # <<<<<<<<<<<<<<
 *         # note that x0 and y0 are now relative to the ROI origin
 *         if result == fit_params.CFitParamsNoError:
 */
    __pyx_v_result = fit_params(__pyx_v_pState, (&__pyx_v_x0), (&__pyx_v_y0), (&__pyx_v_Mu00), (&__pyx_v_Uu11), (&__pyx_v_Uu20), (&__pyx_v_Uu02), ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.imsiz->sz.width, ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.imsiz->sz.height, ((unsigned char *)((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.im), ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)__pyx_v_im)->__pyx_base.step);

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":563
 *                                         im.step)
 *         # note that x0 and y0 are now relative to the ROI origin
 *         if result == fit_params.CFitParamsNoError:             # <<<<<<<<<<<<<<
 *             area = Mu00
 *             eigen_err = eigen_2x2_real( Uu20, Uu11,
 */
    __pyx_1 = (__pyx_v_result == CFitParamsNoError);
    if (__pyx_1) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":564
 *         # note that x0 and y0 are now relative to the ROI origin
 *         if result == fit_params.CFitParamsNoError:
 *             area = Mu00             # <<<<<<<<<<<<<<
 *             eigen_err = eigen_2x2_real( Uu20, Uu11,
 *                                         Uu11, Uu02,
 */
      __pyx_2 = PyFloat_FromDouble(__pyx_v_Mu00); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 564; __pyx_clineno = __LINE__; goto __pyx_L6;}
      Py_DECREF(__pyx_v_area);
      __pyx_v_area = __pyx_2;
      __pyx_2 = 0;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":568
 *                                         Uu11, Uu02,
 *                                         &evalA, &evecA1,
 *                                         &evalB, &evecB1)             # <<<<<<<<<<<<<<
 *             if eigen_err:
 *                 slope = nan
 */
      __pyx_v_eigen_err = eigen_2x2_real(__pyx_v_Uu20, __pyx_v_Uu11, __pyx_v_Uu11, __pyx_v_Uu02, (&__pyx_v_evalA), (&__pyx_v_evecA1), (&__pyx_v_evalB), (&__pyx_v_evecB1));

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":569
 *                                         &evalA, &evecA1,
 *                                         &evalB, &evecB1)
 *             if eigen_err:             # <<<<<<<<<<<<<<
 *                 slope = nan
 *                 eccentricity = 0.0
 */
      __pyx_3 = __pyx_v_eigen_err;
      if (__pyx_3) {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":570
 *                                         &evalB, &evecB1)
 *             if eigen_err:
 *                 slope = nan             # <<<<<<<<<<<<<<
 *                 eccentricity = 0.0
 *             else:
 */
        __pyx_v_slope = __pyx_v_23realtime_image_analysis_nan;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":571
 *             if eigen_err:
 *                 slope = nan
 *                 eccentricity = 0.0             # <<<<<<<<<<<<<<
 *             else:
 *                 rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 */
        __pyx_v_eccentricity = 0.0;
        goto __pyx_L9;
      }
      /*else*/ {

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":573
 *                 eccentricity = 0.0
 *             else:
 *                 rise = 1.0 # 2nd component of eigenvectors will always be 1.0             # <<<<<<<<<<<<<<
 *                 if evalA > evalB:
 *                     run = evecA1
 */
        __pyx_v_rise = 1.0;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":574
 *             else:
 *                 rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 *                 if evalA > evalB:             # <<<<<<<<<<<<<<
 *                     run = evecA1
 *                     eccentricity = evalA/evalB
 */
        __pyx_1 = (__pyx_v_evalA > __pyx_v_evalB);
        if (__pyx_1) {

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":575
 *                 rise = 1.0 # 2nd component of eigenvectors will always be 1.0
 *                 if evalA > evalB:
 *                     run = evecA1             # <<<<<<<<<<<<<<
 *                     eccentricity = evalA/evalB
 *                 else:
 */
          __pyx_v_run = __pyx_v_evecA1;

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":576
 *                 if evalA > evalB:
 *                     run = evecA1
 *                     eccentricity = evalA/evalB             # <<<<<<<<<<<<<<
 *                 else:
 *                     run = evecB1
 */
          __pyx_v_eccentricity = (__pyx_v_evalA / __pyx_v_evalB);
          goto __pyx_L10;
        }
        /*else*/ {

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":578
 *                     eccentricity = evalA/evalB
 *                 else:
 *                     run = evecB1             # <<<<<<<<<<<<<<
 *                     eccentricity = evalB/evalA
 *                 slope = rise/run
 */
          __pyx_v_run = __pyx_v_evecB1;

          /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":579
 *                 else:
 *                     run = evecB1
 *                     eccentricity = evalB/evalA             # <<<<<<<<<<<<<<
 *                 slope = rise/run
 * 
 */
          __pyx_v_eccentricity = (__pyx_v_evalB / __pyx_v_evalA);
        }
        __pyx_L10:;

        /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":580
 *                     run = evecB1
 *                     eccentricity = evalB/evalA
 *                 slope = rise/run             # <<<<<<<<<<<<<<
 * 
 *         elif result == fit_params.CFitParamsZeroMomentError:
 */
        __pyx_v_slope = (__pyx_v_rise / __pyx_v_run);
      }
      __pyx_L9:;
      goto __pyx_L8;
    }

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":582
 *                 slope = rise/run
 * 
 *         elif result == fit_params.CFitParamsZeroMomentError:             # <<<<<<<<<<<<<<
 *             x0 = nan
 *             y0 = nan
 */
    __pyx_1 = (__pyx_v_result == CFitParamsZeroMomentError);
    if (__pyx_1) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":583
 * 
 *         elif result == fit_params.CFitParamsZeroMomentError:
 *             x0 = nan             # <<<<<<<<<<<<<<
 *             y0 = nan
 *             x0_abs = nan
 */
      __pyx_v_x0 = __pyx_v_23realtime_image_analysis_nan;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":584
 *         elif result == fit_params.CFitParamsZeroMomentError:
 *             x0 = nan
 *             y0 = nan             # <<<<<<<<<<<<<<
 *             x0_abs = nan
 *             y0_abs = nan
 */
      __pyx_v_y0 = __pyx_v_23realtime_image_analysis_nan;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":585
 *             x0 = nan
 *             y0 = nan
 *             x0_abs = nan             # <<<<<<<<<<<<<<
 *             y0_abs = nan
 *             found_point = 0
 */
      __pyx_2 = PyFloat_FromDouble(__pyx_v_23realtime_image_analysis_nan); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 585; __pyx_clineno = __LINE__; goto __pyx_L6;}
      Py_DECREF(__pyx_v_x0_abs);
      __pyx_v_x0_abs = __pyx_2;
      __pyx_2 = 0;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":586
 *             y0 = nan
 *             x0_abs = nan
 *             y0_abs = nan             # <<<<<<<<<<<<<<
 *             found_point = 0
 *         elif result == fit_params.CFitParamsCentralMomentError:
 */
      __pyx_2 = PyFloat_FromDouble(__pyx_v_23realtime_image_analysis_nan); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 586; __pyx_clineno = __LINE__; goto __pyx_L6;}
      Py_DECREF(__pyx_v_y0_abs);
      __pyx_v_y0_abs = __pyx_2;
      __pyx_2 = 0;

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":587
 *             x0_abs = nan
 *             y0_abs = nan
 *             found_point = 0             # <<<<<<<<<<<<<<
 *         elif result == fit_params.CFitParamsCentralMomentError:
 *             slope = nan
 */
      Py_INCREF(__pyx_int_0);
      Py_DECREF(__pyx_v_found_point);
      __pyx_v_found_point = __pyx_int_0;
      goto __pyx_L8;
    }

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":588
 *             y0_abs = nan
 *             found_point = 0
 *         elif result == fit_params.CFitParamsCentralMomentError:             # <<<<<<<<<<<<<<
 *             slope = nan
 *         else:
 */
    __pyx_1 = (__pyx_v_result == CFitParamsCentralMomentError);
    if (__pyx_1) {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":589
 *             found_point = 0
 *         elif result == fit_params.CFitParamsCentralMomentError:
 *             slope = nan             # <<<<<<<<<<<<<<
 *         else:
 *             raise ValueError('unknown result (%d)'%result)
 */
      __pyx_v_slope = __pyx_v_23realtime_image_analysis_nan;
      goto __pyx_L8;
    }
    /*else*/ {

      /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":591
 *             slope = nan
 *         else:
 *             raise ValueError('unknown result (%d)'%result)             # <<<<<<<<<<<<<<
 *     finally:
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( pState ))
 */
      __pyx_2 = PyInt_FromLong(__pyx_v_result); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L6;}
      __pyx_4 = PyNumber_Remainder(__pyx_kp_18, __pyx_2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L6;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L6;}
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_4);
      __pyx_4 = 0;
      __pyx_4 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L6;}
      Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
      __Pyx_Raise(__pyx_4, 0, 0);
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 591; __pyx_clineno = __LINE__; goto __pyx_L6;}
    }
    __pyx_L8:;
  }
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_why = 0; goto __pyx_L7;
    __pyx_L6: {
      __pyx_why = 4;
      Py_XDECREF(__pyx_2); __pyx_2 = 0;
      Py_XDECREF(__pyx_4); __pyx_4 = 0;
      PyErr_Fetch(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L7;
    }
    __pyx_L7:;

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":593
 *             raise ValueError('unknown result (%d)'%result)
 *     finally:
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( pState ))             # <<<<<<<<<<<<<<
 * 
 *     return slope, eccentricity
 */
    __pyx_f_23realtime_image_analysis_CHK_HAVEGIL(ippiMomentFree_64f(__pyx_v_pState)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 593; __pyx_clineno = __LINE__; goto __pyx_L11_error;}
    goto __pyx_L12;
    __pyx_L11_error:;
    if (__pyx_why == 4) {
      Py_XDECREF(__pyx_exc_type);
      Py_XDECREF(__pyx_exc_value);
      Py_XDECREF(__pyx_exc_tb);
    }
    goto __pyx_L1_error;
    __pyx_L12:;
    switch (__pyx_why) {
      case 4: {
        PyErr_Restore(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":595
 *         CHK_HAVEGIL( ipp.ippiMomentFree_64f( pState ))
 * 
 *     return slope, eccentricity             # <<<<<<<<<<<<<<
 * 
 * def bg_help_slow( FastImage.FastImage32f running_mean_im,
 */
  __pyx_2 = PyFloat_FromDouble(__pyx_v_slope); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(__pyx_v_eccentricity); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(2); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 595; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
  __pyx_2 = 0;
  __pyx_4 = 0;
  __pyx_r = ((PyObject *)__pyx_5);
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("realtime_image_analysis.fit_slope");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_area);
  Py_DECREF(__pyx_v_x0_abs);
  Py_DECREF(__pyx_v_y0_abs);
  Py_DECREF(__pyx_v_found_point);
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":597
 *     return slope, eccentricity
 * 
 * def bg_help_slow( FastImage.FastImage32f running_mean_im,             # <<<<<<<<<<<<<<
 *                   FastImage.FastImage32f fastframef32_tmp,
 *                   FastImage.FastImage32f running_sumsqf,
 */

static PyObject *__pyx_pf_23realtime_image_analysis_bg_help_slow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_bg_help_slow(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_mean_im = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_fastframef32_tmp = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_sumsqf = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_mean2 = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_stdframe = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_running_mean8u_im = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_hw_roi_frame = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_noisy_pixels_mask = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_compareframe8u = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *__pyx_v_max_frame_size = 0;
  double __pyx_v_ALPHA;
  double __pyx_v_C;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"running_mean_im","fastframef32_tmp","running_sumsqf","mean2","running_stdframe","running_mean8u_im","hw_roi_frame","noisy_pixels_mask","compareframe8u","max_frame_size","ALPHA","C",0};
  __pyx_self = __pyx_self;
  if (likely(!__pyx_kwds) && likely(PyTuple_GET_SIZE(__pyx_args) == 12)) {
    __pyx_v_running_mean_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_fastframef32_tmp = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 1));
    __pyx_v_running_sumsqf = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 2));
    __pyx_v_mean2 = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 3));
    __pyx_v_running_stdframe = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 4));
    __pyx_v_running_mean8u_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 5));
    __pyx_v_hw_roi_frame = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 6));
    __pyx_v_noisy_pixels_mask = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 7));
    __pyx_v_compareframe8u = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 8));
    __pyx_v_max_frame_size = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)PyTuple_GET_ITEM(__pyx_args, 9));
    __pyx_v_ALPHA = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 10)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_C = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 11)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 608; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOOOOOOOOOdd", __pyx_argnames, &__pyx_v_running_mean_im, &__pyx_v_fastframef32_tmp, &__pyx_v_running_sumsqf, &__pyx_v_mean2, &__pyx_v_running_stdframe, &__pyx_v_running_mean8u_im, &__pyx_v_hw_roi_frame, &__pyx_v_noisy_pixels_mask, &__pyx_v_compareframe8u, &__pyx_v_max_frame_size, &__pyx_v_ALPHA, &__pyx_v_C))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.bg_help_slow");
  return NULL;
  __pyx_L4:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_mean_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_mean_im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 597; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fastframef32_tmp), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "fastframef32_tmp", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 598; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_sumsqf), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_sumsqf", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mean2), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "mean2", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 600; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_stdframe), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_stdframe", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 601; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_mean8u_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "running_mean8u_im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_hw_roi_frame), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "hw_roi_frame", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 603; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_noisy_pixels_mask), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "noisy_pixels_mask", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 604; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_compareframe8u), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "compareframe8u", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_max_frame_size), __pyx_ptype_6motmot_9FastImage_9FastImage_Size, 1, "max_frame_size", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 606; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":610
 *                   double C):
 *     # maintain running average
 *     running_mean_im.toself_add_weighted( hw_roi_frame, max_frame_size, ALPHA )             # <<<<<<<<<<<<<<
 *     # maintain 8bit unsigned background image
 *     running_mean_im.get_8u_copy_put( running_mean8u_im, max_frame_size )
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_mean_im), __pyx_kp_toself_add_weighted); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyFloat_FromDouble(__pyx_v_ALPHA); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(3); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_hw_roi_frame));
  PyTuple_SET_ITEM(__pyx_3, 0, ((PyObject *)__pyx_v_hw_roi_frame));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 2, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 610; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":612
 *     running_mean_im.toself_add_weighted( hw_roi_frame, max_frame_size, ALPHA )
 *     # maintain 8bit unsigned background image
 *     running_mean_im.get_8u_copy_put( running_mean8u_im, max_frame_size )             # <<<<<<<<<<<<<<
 * 
 *     # standard deviation calculation
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_mean_im), __pyx_kp_19); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_running_mean8u_im));
  PyTuple_SET_ITEM(__pyx_3, 0, ((PyObject *)__pyx_v_running_mean8u_im));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 612; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":615
 * 
 *     # standard deviation calculation
 *     hw_roi_frame.get_32f_copy_put(fastframef32_tmp,max_frame_size)             # <<<<<<<<<<<<<<
 *     fastframef32_tmp.toself_square(max_frame_size) # current**2
 *     running_sumsqf.toself_add_weighted( fastframef32_tmp, max_frame_size, ALPHA)
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_hw_roi_frame), __pyx_kp_20); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_fastframef32_tmp));
  PyTuple_SET_ITEM(__pyx_3, 0, ((PyObject *)__pyx_v_fastframef32_tmp));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 615; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":616
 *     # standard deviation calculation
 *     hw_roi_frame.get_32f_copy_put(fastframef32_tmp,max_frame_size)
 *     fastframef32_tmp.toself_square(max_frame_size) # current**2             # <<<<<<<<<<<<<<
 *     running_sumsqf.toself_add_weighted( fastframef32_tmp, max_frame_size, ALPHA)
 *     running_mean_im.get_square_put(mean2,max_frame_size)
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_fastframef32_tmp), __pyx_kp_toself_square); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 0, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 616; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":617
 *     hw_roi_frame.get_32f_copy_put(fastframef32_tmp,max_frame_size)
 *     fastframef32_tmp.toself_square(max_frame_size) # current**2
 *     running_sumsqf.toself_add_weighted( fastframef32_tmp, max_frame_size, ALPHA)             # <<<<<<<<<<<<<<
 *     running_mean_im.get_square_put(mean2,max_frame_size)
 *     running_sumsqf.get_subtracted_put(mean2,running_stdframe,max_frame_size)
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_sumsqf), __pyx_kp_toself_add_weighted); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(__pyx_v_ALPHA); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_fastframef32_tmp));
  PyTuple_SET_ITEM(__pyx_2, 0, ((PyObject *)__pyx_v_fastframef32_tmp));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_2, 1, ((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_2, 2, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 617; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":618
 *     fastframef32_tmp.toself_square(max_frame_size) # current**2
 *     running_sumsqf.toself_add_weighted( fastframef32_tmp, max_frame_size, ALPHA)
 *     running_mean_im.get_square_put(mean2,max_frame_size)             # <<<<<<<<<<<<<<
 *     running_sumsqf.get_subtracted_put(mean2,running_stdframe,max_frame_size)
 * 
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_mean_im), __pyx_kp_get_square_put); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_mean2));
  PyTuple_SET_ITEM(__pyx_2, 0, ((PyObject *)__pyx_v_mean2));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_2, 1, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 618; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":619
 *     running_sumsqf.toself_add_weighted( fastframef32_tmp, max_frame_size, ALPHA)
 *     running_mean_im.get_square_put(mean2,max_frame_size)
 *     running_sumsqf.get_subtracted_put(mean2,running_stdframe,max_frame_size)             # <<<<<<<<<<<<<<
 * 
 *     # now create frame for comparison
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_sumsqf), __pyx_kp_get_subtracted_put); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_mean2));
  PyTuple_SET_ITEM(__pyx_2, 0, ((PyObject *)__pyx_v_mean2));
  Py_INCREF(((PyObject *)__pyx_v_running_stdframe));
  PyTuple_SET_ITEM(__pyx_2, 1, ((PyObject *)__pyx_v_running_stdframe));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_2, 2, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_3 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 619; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":622
 * 
 *     # now create frame for comparison
 *     C = 6.0             # <<<<<<<<<<<<<<
 *     running_stdframe.toself_multiply(C,max_frame_size)
 *     running_stdframe.get_8u_copy_put(compareframe8u,max_frame_size)
 */
  __pyx_v_C = 6.0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":623
 *     # now create frame for comparison
 *     C = 6.0
 *     running_stdframe.toself_multiply(C,max_frame_size)             # <<<<<<<<<<<<<<
 *     running_stdframe.get_8u_copy_put(compareframe8u,max_frame_size)
 * 
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_stdframe), __pyx_kp_toself_multiply); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_2 = 0;
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 623; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":624
 *     C = 6.0
 *     running_stdframe.toself_multiply(C,max_frame_size)
 *     running_stdframe.get_8u_copy_put(compareframe8u,max_frame_size)             # <<<<<<<<<<<<<<
 * 
 *     # now we do hack, erm, heuristic for bright points, which aren't gaussian.
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_stdframe), __pyx_kp_19); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(((PyObject *)__pyx_v_compareframe8u));
  PyTuple_SET_ITEM(__pyx_3, 0, ((PyObject *)__pyx_v_compareframe8u));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 624; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":627
 * 
 *     # now we do hack, erm, heuristic for bright points, which aren't gaussian.
 *     running_mean8u_im.get_compare_put( 200, noisy_pixels_mask, max_frame_size, FastImage.CmpGreater)             # <<<<<<<<<<<<<<
 *     compareframe8u.set_val_masked(25, noisy_pixels_mask, max_frame_size)
 * 
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_running_mean8u_im), __pyx_kp_get_compare_put); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_FastImage); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_3, __pyx_kp_CmpGreater); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyTuple_New(4); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_200);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_int_200);
  Py_INCREF(((PyObject *)__pyx_v_noisy_pixels_mask));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_noisy_pixels_mask));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 2, ((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 3, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":628
 *     # now we do hack, erm, heuristic for bright points, which aren't gaussian.
 *     running_mean8u_im.get_compare_put( 200, noisy_pixels_mask, max_frame_size, FastImage.CmpGreater)
 *     compareframe8u.set_val_masked(25, noisy_pixels_mask, max_frame_size)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_1 = PyObject_GetAttr(((PyObject *)__pyx_v_compareframe8u), __pyx_kp_set_val_masked); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(3); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_25);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_int_25);
  Py_INCREF(((PyObject *)__pyx_v_noisy_pixels_mask));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_v_noisy_pixels_mask));
  Py_INCREF(((PyObject *)__pyx_v_max_frame_size));
  PyTuple_SET_ITEM(__pyx_3, 2, ((PyObject *)__pyx_v_max_frame_size));
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 628; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("realtime_image_analysis.bg_help_slow");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":631
 * 
 * 
 * def bg_help( FastImage.FastImage32f running_mean_im,             # <<<<<<<<<<<<<<
 *              FastImage.FastImage32f fastframef32_tmp,
 *              FastImage.FastImage32f running_sumsqf,
 */

static PyObject *__pyx_pf_23realtime_image_analysis_bg_help(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_23realtime_image_analysis_bg_help(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_mean_im = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_fastframef32_tmp = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_sumsqf = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_mean2 = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_stdframe = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_running_mean8u_im = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_hw_roi_frame = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_noisy_pixels_mask = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_compareframe8u = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *__pyx_v_max_frame_size = 0;
  float __pyx_v_ALPHA;
  double __pyx_v_C;
  PyObject *__pyx_r;
  static char *__pyx_argnames[] = {"running_mean_im","fastframef32_tmp","running_sumsqf","mean2","running_stdframe","running_mean8u_im","hw_roi_frame","noisy_pixels_mask","compareframe8u","max_frame_size","ALPHA","C",0};
  __pyx_self = __pyx_self;
  if (likely(!__pyx_kwds) && likely(PyTuple_GET_SIZE(__pyx_args) == 12)) {
    __pyx_v_running_mean_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_fastframef32_tmp = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 1));
    __pyx_v_running_sumsqf = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 2));
    __pyx_v_mean2 = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 3));
    __pyx_v_running_stdframe = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 4));
    __pyx_v_running_mean8u_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 5));
    __pyx_v_hw_roi_frame = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 6));
    __pyx_v_noisy_pixels_mask = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 7));
    __pyx_v_compareframe8u = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 8));
    __pyx_v_max_frame_size = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)PyTuple_GET_ITEM(__pyx_args, 9));
    __pyx_v_ALPHA = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 10)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 641; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_C = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 11)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOOOOOOOOOfd", __pyx_argnames, &__pyx_v_running_mean_im, &__pyx_v_fastframef32_tmp, &__pyx_v_running_sumsqf, &__pyx_v_mean2, &__pyx_v_running_stdframe, &__pyx_v_running_mean8u_im, &__pyx_v_hw_roi_frame, &__pyx_v_noisy_pixels_mask, &__pyx_v_compareframe8u, &__pyx_v_max_frame_size, &__pyx_v_ALPHA, &__pyx_v_C))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.bg_help");
  return NULL;
  __pyx_L4:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_mean_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_mean_im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 631; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fastframef32_tmp), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "fastframef32_tmp", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_sumsqf), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_sumsqf", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 633; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mean2), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "mean2", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 634; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_stdframe), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_stdframe", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_mean8u_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "running_mean8u_im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 636; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_hw_roi_frame), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "hw_roi_frame", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 637; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_noisy_pixels_mask), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "noisy_pixels_mask", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_compareframe8u), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "compareframe8u", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 639; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_max_frame_size), __pyx_ptype_6motmot_9FastImage_9FastImage_Size, 1, "max_frame_size", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":644
 *              double C):
 * 
 *     c_python.Py_BEGIN_ALLOW_THREADS # release GIL             # <<<<<<<<<<<<<<
 *     # maintain running average
 *     #running_mean_im.fast_toself_add_weighted_8u( hw_roi_frame, max_frame_size, ALPHA ) # done
 */
  Py_BEGIN_ALLOW_THREADS;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":649
 *     CHK_NOGIL( ipp.ippiAddWeighted_8u32f_C1IR( <ipp.Ipp8u*>hw_roi_frame.im, hw_roi_frame.step,
 *                                                <ipp.Ipp32f*>running_mean_im.im, running_mean_im.step,
 *                                                max_frame_size.sz, ALPHA))             # <<<<<<<<<<<<<<
 * 
 *     # maintain 8bit unsigned background image
 */
  CHK_NOGIL(ippiAddWeighted_8u32f_C1IR(((Ipp8u *)__pyx_v_hw_roi_frame->__pyx_base.im), __pyx_v_hw_roi_frame->__pyx_base.step, ((Ipp32f *)__pyx_v_running_mean_im->__pyx_base.im), __pyx_v_running_mean_im->__pyx_base.step, __pyx_v_max_frame_size->sz, __pyx_v_ALPHA));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":656
 *         <ipp.Ipp32f*>running_mean_im.im,running_mean_im.step,
 *         <ipp.Ipp8u*>running_mean8u_im.im,running_mean8u_im.step,
 *         max_frame_size.sz, ipp.ippRndNear ))             # <<<<<<<<<<<<<<
 * 
 *     # standard deviation calculation
 */
  CHK_NOGIL(ippiConvert_32f8u_C1R(((Ipp32f *)__pyx_v_running_mean_im->__pyx_base.im), __pyx_v_running_mean_im->__pyx_base.step, ((Ipp8u *)__pyx_v_running_mean8u_im->__pyx_base.im), __pyx_v_running_mean8u_im->__pyx_base.step, __pyx_v_max_frame_size->sz, ippRndNear));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":662
 *     CHK_NOGIL( ipp.ippiConvert_8u32f_C1R(<ipp.Ipp8u*>hw_roi_frame.im, hw_roi_frame.step,
 *                                          <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                          max_frame_size.sz ))             # <<<<<<<<<<<<<<
 * 
 *     #fastframef32_tmp.fast_toself_square(max_frame_size) # current**2 # done
 */
  CHK_NOGIL(ippiConvert_8u32f_C1R(((Ipp8u *)__pyx_v_hw_roi_frame->__pyx_base.im), __pyx_v_hw_roi_frame->__pyx_base.step, ((Ipp32f *)__pyx_v_fastframef32_tmp->__pyx_base.im), __pyx_v_fastframef32_tmp->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":666
 *     #fastframef32_tmp.fast_toself_square(max_frame_size) # current**2 # done
 *     CHK_NOGIL( ipp.ippiSqr_32f_C1IR( <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                      max_frame_size.sz))             # <<<<<<<<<<<<<<
 * 
 *     #running_sumsqf.fast_toself_add_weighted_32f( fastframef32_tmp, max_frame_size, ALPHA) # done
 */
  CHK_NOGIL(ippiSqr_32f_C1IR(((Ipp32f *)__pyx_v_fastframef32_tmp->__pyx_base.im), __pyx_v_fastframef32_tmp->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":671
 *     CHK_NOGIL( ipp.ippiAddWeighted_32f_C1IR( <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                              <ipp.Ipp32f*>running_sumsqf.im, running_sumsqf.step,
 *                                              max_frame_size.sz, ALPHA))             # <<<<<<<<<<<<<<
 *     #running_mean_im.fast_get_square_put(mean2,max_frame_size) # done
 *     CHK_NOGIL( ipp.ippiSqr_32f_C1R( <ipp.Ipp32f*>running_mean_im.im, running_mean_im.step,
 */
  CHK_NOGIL(ippiAddWeighted_32f_C1IR(((Ipp32f *)__pyx_v_fastframef32_tmp->__pyx_base.im), __pyx_v_fastframef32_tmp->__pyx_base.step, ((Ipp32f *)__pyx_v_running_sumsqf->__pyx_base.im), __pyx_v_running_sumsqf->__pyx_base.step, __pyx_v_max_frame_size->sz, __pyx_v_ALPHA));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":675
 *     CHK_NOGIL( ipp.ippiSqr_32f_C1R( <ipp.Ipp32f*>running_mean_im.im, running_mean_im.step,
 *                                     <ipp.Ipp32f*>mean2.im, mean2.step,
 *                                     max_frame_size.sz))             # <<<<<<<<<<<<<<
 *     #running_sumsqf.fast_get_subtracted_put(mean2,running_stdframe,max_frame_size) # done
 *     CHK_NOGIL( ipp.ippiSub_32f_C1R(<ipp.Ipp32f*>mean2.im, mean2.step,
 */
  CHK_NOGIL(ippiSqr_32f_C1R(((Ipp32f *)__pyx_v_running_mean_im->__pyx_base.im), __pyx_v_running_mean_im->__pyx_base.step, ((Ipp32f *)__pyx_v_mean2->__pyx_base.im), __pyx_v_mean2->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":680
 *                                    <ipp.Ipp32f*>running_sumsqf.im, running_sumsqf.step,
 *                                    <ipp.Ipp32f*>running_stdframe.im, running_stdframe.step,
 *                                    max_frame_size.sz))             # <<<<<<<<<<<<<<
 * 
 *     # now create frame for comparison
 */
  CHK_NOGIL(ippiSub_32f_C1R(((Ipp32f *)__pyx_v_mean2->__pyx_base.im), __pyx_v_mean2->__pyx_base.step, ((Ipp32f *)__pyx_v_running_sumsqf->__pyx_base.im), __pyx_v_running_sumsqf->__pyx_base.step, ((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":684
 *     # now create frame for comparison
 *     #running_stdframe.fast_toself_multiply(C,max_frame_size) # done
 *     CHK_NOGIL( ipp.ippiMulC_32f_C1IR(C, <ipp.Ipp32f*>running_stdframe.im, running_stdframe.step, max_frame_size.sz))             # <<<<<<<<<<<<<<
 * 
 *     #running_stdframe.fast_get_8u_copy_put(compareframe8u,max_frame_size) # done
 */
  CHK_NOGIL(ippiMulC_32f_C1IR(__pyx_v_C, ((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":690
 *         <ipp.Ipp32f*>running_stdframe.im,running_stdframe.step,
 *         <ipp.Ipp8u*>compareframe8u.im,compareframe8u.step,
 *         max_frame_size.sz, ipp.ippRndNear ))             # <<<<<<<<<<<<<<
 * 
 *     # now we do hack, erm, heuristic for bright points, which aren't gaussian.
 */
  CHK_NOGIL(ippiConvert_32f8u_C1R(((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, ((Ipp8u *)__pyx_v_compareframe8u->__pyx_base.im), __pyx_v_compareframe8u->__pyx_base.step, __pyx_v_max_frame_size->sz, ippRndNear));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":698
 *                                         <ipp.Ipp8u*>noisy_pixels_mask.im,noisy_pixels_mask.step,
 *                                         max_frame_size.sz,
 *                                         ipp.ippCmpGreater))             # <<<<<<<<<<<<<<
 * 
 *     #compareframe8u.fast_set_val_masked(25, noisy_pixels_mask, max_frame_size) # done
 */
  CHK_NOGIL(ippiCompareC_8u_C1R(((Ipp8u *)__pyx_v_running_mean8u_im->__pyx_base.im), __pyx_v_running_mean8u_im->__pyx_base.step, 200, ((Ipp8u *)__pyx_v_noisy_pixels_mask->__pyx_base.im), __pyx_v_noisy_pixels_mask->__pyx_base.step, __pyx_v_max_frame_size->sz, ippCmpGreater));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":702
 *     #compareframe8u.fast_set_val_masked(25, noisy_pixels_mask, max_frame_size) # done
 *     CHK_NOGIL( ipp.ippiSet_8u_C1MR( 25, <ipp.Ipp8u*>compareframe8u.im, compareframe8u.step, max_frame_size.sz,
 *                                     <ipp.Ipp8u*>noisy_pixels_mask.im, noisy_pixels_mask.step))             # <<<<<<<<<<<<<<
 *     c_python.Py_END_ALLOW_THREADS # acquire GIL
 * 
 */
  CHK_NOGIL(ippiSet_8u_C1MR(25, ((Ipp8u *)__pyx_v_compareframe8u->__pyx_base.im), __pyx_v_compareframe8u->__pyx_base.step, __pyx_v_max_frame_size->sz, ((Ipp8u *)__pyx_v_noisy_pixels_mask->__pyx_base.im), __pyx_v_noisy_pixels_mask->__pyx_base.step));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":703
 *     CHK_NOGIL( ipp.ippiSet_8u_C1MR( 25, <ipp.Ipp8u*>compareframe8u.im, compareframe8u.step, max_frame_size.sz,
 *                                     <ipp.Ipp8u*>noisy_pixels_mask.im, noisy_pixels_mask.step))
 *     c_python.Py_END_ALLOW_THREADS # acquire GIL             # <<<<<<<<<<<<<<
 * 
 * def do_bg_maint( FastImage.FastImage32f running_mean_im,
 */
  Py_END_ALLOW_THREADS;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("realtime_image_analysis.bg_help");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":705
 *     c_python.Py_END_ALLOW_THREADS # acquire GIL
 * 
 * def do_bg_maint( FastImage.FastImage32f running_mean_im,             # <<<<<<<<<<<<<<
 *                  FastImage.FastImage8u hw_roi_frame,
 *                  FastImage.Size max_frame_size,
 */

static PyObject *__pyx_pf_23realtime_image_analysis_do_bg_maint(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_23realtime_image_analysis_do_bg_maint[] = "\n    = Arguments =\n\n    FastImage.FastImage32f running_mean_im   IO - current estimate of mean of x\n    FastImage.FastImage8u hw_roi_frame       Input - current image\n    FastImage.Size max_frame_size            Input - size of all images\n    float ALPHA                              Input\n    FastImage.FastImage8u running_mean8u_im  Output\n    FastImage.FastImage32f fastframef32_tmp  Output (temp/scratch)\n    FastImage.FastImage32f running_sumsqf    IO - current estimate of mean of x^2\n    FastImage.FastImage32f mean2             Output - running_mean_im^2\n    FastImage.FastImage32f std2              Output - running_sumsqf-mean2\n    FastImage.FastImage32f running_stdframe  Output - sqrt(std2)\n    float n_sigma                            Input\n    FastImage.FastImage8u compareframe8u     Output\n    int bright_non_gaussian_cutoff           Input\n    FastImage.FastImage8u noisy_pixels_mask  Input\n    int bright_non_gaussian_replacement      Input\n    int bench                                Input\n\n    = Returns =\n    Benchmarking information if bench != 0\n\n    ";
static PyObject *__pyx_pf_23realtime_image_analysis_do_bg_maint(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_mean_im = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_hw_roi_frame = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *__pyx_v_max_frame_size = 0;
  float __pyx_v_ALPHA;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_running_mean8u_im = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_fastframef32_tmp = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_sumsqf = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_mean2 = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_std2 = 0;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *__pyx_v_running_stdframe = 0;
  float __pyx_v_n_sigma;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_compareframe8u = 0;
  int __pyx_v_bright_non_gaussian_cutoff;
  struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *__pyx_v_noisy_pixels_mask = 0;
  int __pyx_v_bright_non_gaussian_replacement;
  int __pyx_v_bench;
  int __pyx_v_BENCHMARK;
  IppStatus __pyx_v_errval;
  double __pyx_v_t41;
  double __pyx_v_t42;
  double __pyx_v_t43;
  double __pyx_v_t44;
  double __pyx_v_t45;
  double __pyx_v_t46;
  double __pyx_v_t47;
  double __pyx_v_t48;
  double __pyx_v_t49;
  double __pyx_v_t491;
  double __pyx_v_t492;
  PyObject *__pyx_v_res;
  PyObject *__pyx_r;
  int __pyx_1;
  int __pyx_2;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  PyObject *__pyx_11 = 0;
  PyObject *__pyx_12 = 0;
  PyObject *__pyx_13 = 0;
  PyObject *__pyx_14 = 0;
  static char *__pyx_argnames[] = {"running_mean_im","hw_roi_frame","max_frame_size","ALPHA","running_mean8u_im","fastframef32_tmp","running_sumsqf","mean2","std2","running_stdframe","n_sigma","compareframe8u","bright_non_gaussian_cutoff","noisy_pixels_mask","bright_non_gaussian_replacement","bench",0};
  __pyx_self = __pyx_self;
  __pyx_v_bench = 0;
  if (likely(!__pyx_kwds) && likely(15 <= PyTuple_GET_SIZE(__pyx_args)) && likely(PyTuple_GET_SIZE(__pyx_args) <= 16)) {
    __pyx_v_running_mean_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 0));
    __pyx_v_hw_roi_frame = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 1));
    __pyx_v_max_frame_size = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)PyTuple_GET_ITEM(__pyx_args, 2));
    __pyx_v_ALPHA = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 708; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_running_mean8u_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 4));
    __pyx_v_fastframef32_tmp = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 5));
    __pyx_v_running_sumsqf = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 6));
    __pyx_v_mean2 = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 7));
    __pyx_v_std2 = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 8));
    __pyx_v_running_stdframe = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f *)PyTuple_GET_ITEM(__pyx_args, 9));
    __pyx_v_n_sigma = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 10)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_compareframe8u = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 11));
    __pyx_v_bright_non_gaussian_cutoff = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 12)); if (unlikely((__pyx_v_bright_non_gaussian_cutoff == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 717; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_noisy_pixels_mask = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)PyTuple_GET_ITEM(__pyx_args, 13));
    __pyx_v_bright_non_gaussian_replacement = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 14)); if (unlikely((__pyx_v_bright_non_gaussian_replacement == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (PyTuple_GET_SIZE(__pyx_args) > 15) {
      __pyx_v_bench = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 15)); if (unlikely((__pyx_v_bench == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 720; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    }
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOOfOOOOOOfOiOi|i", __pyx_argnames, &__pyx_v_running_mean_im, &__pyx_v_hw_roi_frame, &__pyx_v_max_frame_size, &__pyx_v_ALPHA, &__pyx_v_running_mean8u_im, &__pyx_v_fastframef32_tmp, &__pyx_v_running_sumsqf, &__pyx_v_mean2, &__pyx_v_std2, &__pyx_v_running_stdframe, &__pyx_v_n_sigma, &__pyx_v_compareframe8u, &__pyx_v_bright_non_gaussian_cutoff, &__pyx_v_noisy_pixels_mask, &__pyx_v_bright_non_gaussian_replacement, &__pyx_v_bench))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("realtime_image_analysis.do_bg_maint");
  return NULL;
  __pyx_L4:;
  __pyx_v_res = Py_None; Py_INCREF(Py_None);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_mean_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_mean_im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 705; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_hw_roi_frame), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "hw_roi_frame", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 706; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_max_frame_size), __pyx_ptype_6motmot_9FastImage_9FastImage_Size, 1, "max_frame_size", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_mean8u_im), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "running_mean8u_im", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 709; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_fastframef32_tmp), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "fastframef32_tmp", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 710; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_sumsqf), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_sumsqf", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 711; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mean2), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "mean2", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_std2), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "std2", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_running_stdframe), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f, 1, "running_stdframe", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 714; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_compareframe8u), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "compareframe8u", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 716; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_noisy_pixels_mask), __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u, 1, "noisy_pixels_mask", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 718; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":749
 *     cdef ipp.IppStatus errval
 * 
 *     BENCHMARK = bench             # <<<<<<<<<<<<<<
 *     cdef double t41, t42, t43, t44, t45, t46, t47, t48, t49, t491, t492
 * 
 */
  __pyx_v_BENCHMARK = __pyx_v_bench;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":752
 *     cdef double t41, t42, t43, t44, t45, t46, t47, t48, t49, t491, t492
 * 
 *     c_python.Py_BEGIN_ALLOW_THREADS             # <<<<<<<<<<<<<<
 * 
 *     # maintain running average
 */
  Py_BEGIN_ALLOW_THREADS;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":758
 *     CHK_NOGIL( ipp.ippiAddWeighted_8u32f_C1IR( <ipp.Ipp8u*>hw_roi_frame.im, hw_roi_frame.step,
 *                                                <ipp.Ipp32f*>running_mean_im.im, running_mean_im.step,
 *                                                max_frame_size.sz, ALPHA))             # <<<<<<<<<<<<<<
 *     if BENCHMARK:
 *         t41 = time_time()
 */
  CHK_NOGIL(ippiAddWeighted_8u32f_C1IR(((Ipp8u *)__pyx_v_hw_roi_frame->__pyx_base.im), __pyx_v_hw_roi_frame->__pyx_base.step, ((Ipp32f *)__pyx_v_running_mean_im->__pyx_base.im), __pyx_v_running_mean_im->__pyx_base.step, __pyx_v_max_frame_size->sz, __pyx_v_ALPHA));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":759
 *                                                <ipp.Ipp32f*>running_mean_im.im, running_mean_im.step,
 *                                                max_frame_size.sz, ALPHA))
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t41 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":760
 *                                                max_frame_size.sz, ALPHA))
 *     if BENCHMARK:
 *         t41 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     CHK_NOGIL( ipp.ippiConvert_32f8u_C1R(
 */
    __pyx_v_t41 = time_time();
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":765
 *         <ipp.Ipp32f*>running_mean_im.im,running_mean_im.step,
 *         <ipp.Ipp8u*>running_mean8u_im.im,running_mean8u_im.step,
 *         max_frame_size.sz, ipp.ippRndNear ))             # <<<<<<<<<<<<<<
 * 
 *     if BENCHMARK:
 */
  CHK_NOGIL(ippiConvert_32f8u_C1R(((Ipp32f *)__pyx_v_running_mean_im->__pyx_base.im), __pyx_v_running_mean_im->__pyx_base.step, ((Ipp8u *)__pyx_v_running_mean8u_im->__pyx_base.im), __pyx_v_running_mean8u_im->__pyx_base.step, __pyx_v_max_frame_size->sz, ippRndNear));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":767
 *         max_frame_size.sz, ipp.ippRndNear ))
 * 
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t42 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":768
 * 
 *     if BENCHMARK:
 *         t42 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     # standard deviation calculation
 */
    __pyx_v_t42 = time_time();
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":773
 *     CHK_NOGIL( ipp.ippiConvert_8u32f_C1R(<ipp.Ipp8u*>hw_roi_frame.im, hw_roi_frame.step,
 *                                          <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                          max_frame_size.sz ))             # <<<<<<<<<<<<<<
 *     if BENCHMARK:
 *         t43 = time_time()
 */
  CHK_NOGIL(ippiConvert_8u32f_C1R(((Ipp8u *)__pyx_v_hw_roi_frame->__pyx_base.im), __pyx_v_hw_roi_frame->__pyx_base.step, ((Ipp32f *)__pyx_v_fastframef32_tmp->__pyx_base.im), __pyx_v_fastframef32_tmp->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":774
 *                                          <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                          max_frame_size.sz ))
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t43 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":775
 *                                          max_frame_size.sz ))
 *     if BENCHMARK:
 *         t43 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     # x^2
 */
    __pyx_v_t43 = time_time();
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":779
 *     # x^2
 *     CHK_NOGIL( ipp.ippiSqr_32f_C1IR( <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                      max_frame_size.sz))             # <<<<<<<<<<<<<<
 *     if BENCHMARK:
 *         t44 = time_time()
 */
  CHK_NOGIL(ippiSqr_32f_C1IR(((Ipp32f *)__pyx_v_fastframef32_tmp->__pyx_base.im), __pyx_v_fastframef32_tmp->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":780
 *     CHK_NOGIL( ipp.ippiSqr_32f_C1IR( <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                      max_frame_size.sz))
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t44 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":781
 *                                      max_frame_size.sz))
 *     if BENCHMARK:
 *         t44 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     # <x^2>
 */
    __pyx_v_t44 = time_time();
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":786
 *     CHK_NOGIL( ipp.ippiAddWeighted_32f_C1IR( <ipp.Ipp32f*>fastframef32_tmp.im, fastframef32_tmp.step,
 *                                              <ipp.Ipp32f*>running_sumsqf.im, running_sumsqf.step,
 *                                              max_frame_size.sz, ALPHA))             # <<<<<<<<<<<<<<
 *     if BENCHMARK:
 *         t45 = time_time()
 */
  CHK_NOGIL(ippiAddWeighted_32f_C1IR(((Ipp32f *)__pyx_v_fastframef32_tmp->__pyx_base.im), __pyx_v_fastframef32_tmp->__pyx_base.step, ((Ipp32f *)__pyx_v_running_sumsqf->__pyx_base.im), __pyx_v_running_sumsqf->__pyx_base.step, __pyx_v_max_frame_size->sz, __pyx_v_ALPHA));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":787
 *                                              <ipp.Ipp32f*>running_sumsqf.im, running_sumsqf.step,
 *                                              max_frame_size.sz, ALPHA))
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t45 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":788
 *                                              max_frame_size.sz, ALPHA))
 *     if BENCHMARK:
 *         t45 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     ### GETS SLOWER
 */
    __pyx_v_t45 = time_time();
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":794
 *     CHK_NOGIL( ipp.ippiSqr_32f_C1R( <ipp.Ipp32f*>running_mean_im.im, running_mean_im.step,
 *                                     <ipp.Ipp32f*>mean2.im, mean2.step,
 *                                     max_frame_size.sz))             # <<<<<<<<<<<<<<
 *     if BENCHMARK:
 *         t46 = time_time()
 */
  CHK_NOGIL(ippiSqr_32f_C1R(((Ipp32f *)__pyx_v_running_mean_im->__pyx_base.im), __pyx_v_running_mean_im->__pyx_base.step, ((Ipp32f *)__pyx_v_mean2->__pyx_base.im), __pyx_v_mean2->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":795
 *                                     <ipp.Ipp32f*>mean2.im, mean2.step,
 *                                     max_frame_size.sz))
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t46 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":796
 *                                     max_frame_size.sz))
 *     if BENCHMARK:
 *         t46 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     # <x^2> - <x>^2
 */
    __pyx_v_t46 = time_time();
    goto __pyx_L10;
  }
  __pyx_L10:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":802
 *                                    <ipp.Ipp32f*>running_sumsqf.im, running_sumsqf.step,
 *                                    <ipp.Ipp32f*>std2.im, std2.step,
 *                                    max_frame_size.sz))             # <<<<<<<<<<<<<<
 * 
 *     # sqrt( |<x^2> - <x>^2| )
 */
  CHK_NOGIL(ippiSub_32f_C1R(((Ipp32f *)__pyx_v_mean2->__pyx_base.im), __pyx_v_mean2->__pyx_base.step, ((Ipp32f *)__pyx_v_running_sumsqf->__pyx_base.im), __pyx_v_running_sumsqf->__pyx_base.step, ((Ipp32f *)__pyx_v_std2->__pyx_base.im), __pyx_v_std2->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":810
 *                                    <ipp.Ipp32f*>running_stdframe.im,
 *                                    running_stdframe.step,
 *                                    max_frame_size.sz))             # <<<<<<<<<<<<<<
 *     errval= ipp.ippiSqrt_32f_C1IR(<ipp.Ipp32f*>running_stdframe.im,
 *                                   running_stdframe.step,
 */
  CHK_NOGIL(ippiAbs_32f_C1R(((Ipp32f *)__pyx_v_std2->__pyx_base.im), __pyx_v_std2->__pyx_base.step, ((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, __pyx_v_max_frame_size->sz));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":813
 *     errval= ipp.ippiSqrt_32f_C1IR(<ipp.Ipp32f*>running_stdframe.im,
 *                                   running_stdframe.step,
 *                                   max_frame_size.sz)             # <<<<<<<<<<<<<<
 *     CHK_NOGIL(errval)
 * 
 */
  __pyx_v_errval = ippiSqrt_32f_C1IR(((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, __pyx_v_max_frame_size->sz);

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":814
 *                                   running_stdframe.step,
 *                                   max_frame_size.sz)
 *     CHK_NOGIL(errval)             # <<<<<<<<<<<<<<
 * 
 *     if BENCHMARK:
 */
  CHK_NOGIL(__pyx_v_errval);

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":816
 *     CHK_NOGIL(errval)
 * 
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t47 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":817
 * 
 *     if BENCHMARK:
 *         t47 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     # now create frame for comparison
 */
    __pyx_v_t47 = time_time();
    goto __pyx_L11;
  }
  __pyx_L11:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":820
 * 
 *     # now create frame for comparison
 *     if n_sigma != 1.0:             # <<<<<<<<<<<<<<
 *         CHK_NOGIL( ipp.ippiMulC_32f_C1IR(n_sigma, <ipp.Ipp32f*>running_stdframe.im, running_stdframe.step, max_frame_size.sz))
 * 
 */
  __pyx_2 = (__pyx_v_n_sigma != 1.0);
  if (__pyx_2) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":821
 *     # now create frame for comparison
 *     if n_sigma != 1.0:
 *         CHK_NOGIL( ipp.ippiMulC_32f_C1IR(n_sigma, <ipp.Ipp32f*>running_stdframe.im, running_stdframe.step, max_frame_size.sz))             # <<<<<<<<<<<<<<
 * 
 *     if BENCHMARK:
 */
    CHK_NOGIL(ippiMulC_32f_C1IR(__pyx_v_n_sigma, ((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, __pyx_v_max_frame_size->sz));
    goto __pyx_L12;
  }
  __pyx_L12:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":823
 *         CHK_NOGIL( ipp.ippiMulC_32f_C1IR(n_sigma, <ipp.Ipp32f*>running_stdframe.im, running_stdframe.step, max_frame_size.sz))
 * 
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t48 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":824
 * 
 *     if BENCHMARK:
 *         t48 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     CHK_NOGIL( ipp.ippiConvert_32f8u_C1R(
 */
    __pyx_v_t48 = time_time();
    goto __pyx_L13;
  }
  __pyx_L13:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":829
 *         <ipp.Ipp32f*>running_stdframe.im,running_stdframe.step,
 *         <ipp.Ipp8u*>compareframe8u.im,compareframe8u.step,
 *         max_frame_size.sz, ipp.ippRndNear ))             # <<<<<<<<<<<<<<
 * 
 *     if BENCHMARK:
 */
  CHK_NOGIL(ippiConvert_32f8u_C1R(((Ipp32f *)__pyx_v_running_stdframe->__pyx_base.im), __pyx_v_running_stdframe->__pyx_base.step, ((Ipp8u *)__pyx_v_compareframe8u->__pyx_base.im), __pyx_v_compareframe8u->__pyx_base.step, __pyx_v_max_frame_size->sz, ippRndNear));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":831
 *         max_frame_size.sz, ipp.ippRndNear ))
 * 
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t49 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":832
 * 
 *     if BENCHMARK:
 *         t49 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     # now we do hack, erm, heuristic for bright points, which aren't gaussian.
 */
    __pyx_v_t49 = time_time();
    goto __pyx_L14;
  }
  __pyx_L14:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":838
 *                                         bright_non_gaussian_cutoff,
 *                                         <ipp.Ipp8u*>noisy_pixels_mask.im,noisy_pixels_mask.step,
 *                                         max_frame_size.sz,ipp.ippCmpGreater))             # <<<<<<<<<<<<<<
 * 
 *     if BENCHMARK:
 */
  CHK_NOGIL(ippiCompareC_8u_C1R(((Ipp8u *)__pyx_v_running_mean8u_im->__pyx_base.im), __pyx_v_running_mean8u_im->__pyx_base.step, __pyx_v_bright_non_gaussian_cutoff, ((Ipp8u *)__pyx_v_noisy_pixels_mask->__pyx_base.im), __pyx_v_noisy_pixels_mask->__pyx_base.step, __pyx_v_max_frame_size->sz, ippCmpGreater));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":840
 *                                         max_frame_size.sz,ipp.ippCmpGreater))
 * 
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t491 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":841
 * 
 *     if BENCHMARK:
 *         t491 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     CHK_NOGIL( ipp.ippiSet_8u_C1MR( bright_non_gaussian_replacement,
 */
    __pyx_v_t491 = time_time();
    goto __pyx_L15;
  }
  __pyx_L15:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":845
 *     CHK_NOGIL( ipp.ippiSet_8u_C1MR( bright_non_gaussian_replacement,
 *                                     <ipp.Ipp8u*>compareframe8u.im, compareframe8u.step, max_frame_size.sz,
 *                                     <ipp.Ipp8u*>noisy_pixels_mask.im, noisy_pixels_mask.step))             # <<<<<<<<<<<<<<
 *     if BENCHMARK:
 *         t492 = time_time()
 */
  CHK_NOGIL(ippiSet_8u_C1MR(__pyx_v_bright_non_gaussian_replacement, ((Ipp8u *)__pyx_v_compareframe8u->__pyx_base.im), __pyx_v_compareframe8u->__pyx_base.step, __pyx_v_max_frame_size->sz, ((Ipp8u *)__pyx_v_noisy_pixels_mask->__pyx_base.im), __pyx_v_noisy_pixels_mask->__pyx_base.step));

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":846
 *                                     <ipp.Ipp8u*>compareframe8u.im, compareframe8u.step, max_frame_size.sz,
 *                                     <ipp.Ipp8u*>noisy_pixels_mask.im, noisy_pixels_mask.step))
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         t492 = time_time()
 * 
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":847
 *                                     <ipp.Ipp8u*>noisy_pixels_mask.im, noisy_pixels_mask.step))
 *     if BENCHMARK:
 *         t492 = time_time()             # <<<<<<<<<<<<<<
 * 
 *     c_python.Py_END_ALLOW_THREADS
 */
    __pyx_v_t492 = time_time();
    goto __pyx_L16;
  }
  __pyx_L16:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":849
 *         t492 = time_time()
 * 
 *     c_python.Py_END_ALLOW_THREADS             # <<<<<<<<<<<<<<
 * 
 *     if BENCHMARK:
 */
  Py_END_ALLOW_THREADS;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":851
 *     c_python.Py_END_ALLOW_THREADS
 * 
 *     if BENCHMARK:             # <<<<<<<<<<<<<<
 *         res = t41, t42, t43, t44, t45, t46, t47, t48, t49, t491, t492
 *     else:
 */
  __pyx_1 = __pyx_v_BENCHMARK;
  if (__pyx_1) {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":852
 * 
 *     if BENCHMARK:
 *         res = t41, t42, t43, t44, t45, t46, t47, t48, t49, t491, t492             # <<<<<<<<<<<<<<
 *     else:
 *         res = None
 */
    __pyx_3 = PyFloat_FromDouble(__pyx_v_t41); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyFloat_FromDouble(__pyx_v_t42); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_5 = PyFloat_FromDouble(__pyx_v_t43); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = PyFloat_FromDouble(__pyx_v_t44); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_7 = PyFloat_FromDouble(__pyx_v_t45); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_8 = PyFloat_FromDouble(__pyx_v_t46); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_9 = PyFloat_FromDouble(__pyx_v_t47); if (unlikely(!__pyx_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_10 = PyFloat_FromDouble(__pyx_v_t48); if (unlikely(!__pyx_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_11 = PyFloat_FromDouble(__pyx_v_t49); if (unlikely(!__pyx_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_12 = PyFloat_FromDouble(__pyx_v_t491); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_13 = PyFloat_FromDouble(__pyx_v_t492); if (unlikely(!__pyx_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_14 = PyTuple_New(11); if (unlikely(!__pyx_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 852; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_14, 0, __pyx_3);
    PyTuple_SET_ITEM(__pyx_14, 1, __pyx_4);
    PyTuple_SET_ITEM(__pyx_14, 2, __pyx_5);
    PyTuple_SET_ITEM(__pyx_14, 3, __pyx_6);
    PyTuple_SET_ITEM(__pyx_14, 4, __pyx_7);
    PyTuple_SET_ITEM(__pyx_14, 5, __pyx_8);
    PyTuple_SET_ITEM(__pyx_14, 6, __pyx_9);
    PyTuple_SET_ITEM(__pyx_14, 7, __pyx_10);
    PyTuple_SET_ITEM(__pyx_14, 8, __pyx_11);
    PyTuple_SET_ITEM(__pyx_14, 9, __pyx_12);
    PyTuple_SET_ITEM(__pyx_14, 10, __pyx_13);
    __pyx_3 = 0;
    __pyx_4 = 0;
    __pyx_5 = 0;
    __pyx_6 = 0;
    __pyx_7 = 0;
    __pyx_8 = 0;
    __pyx_9 = 0;
    __pyx_10 = 0;
    __pyx_11 = 0;
    __pyx_12 = 0;
    __pyx_13 = 0;
    Py_DECREF(__pyx_v_res);
    __pyx_v_res = ((PyObject *)__pyx_14);
    __pyx_14 = 0;
    goto __pyx_L17;
  }
  /*else*/ {

    /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":854
 *         res = t41, t42, t43, t44, t45, t46, t47, t48, t49, t491, t492
 *     else:
 *         res = None             # <<<<<<<<<<<<<<
 *     return res
 * 
 */
    Py_INCREF(Py_None);
    Py_DECREF(__pyx_v_res);
    __pyx_v_res = Py_None;
  }
  __pyx_L17:;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":855
 *     else:
 *         res = None
 *     return res             # <<<<<<<<<<<<<<
 * 
 * 
 */
  Py_INCREF(__pyx_v_res);
  __pyx_r = __pyx_v_res;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  Py_XDECREF(__pyx_11);
  Py_XDECREF(__pyx_12);
  Py_XDECREF(__pyx_13);
  Py_XDECREF(__pyx_14);
  __Pyx_AddTraceback("realtime_image_analysis.do_bg_maint");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_res);
  return __pyx_r;
}

static PyObject *__pyx_tp_new_23realtime_image_analysis_FitParamsClass(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  if (__pyx_pf_23realtime_image_analysis_14FitParamsClass___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_23realtime_image_analysis_FitParamsClass(PyObject *o) {
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pf_23realtime_image_analysis_14FitParamsClass___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  (*Py_TYPE(o)->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_23realtime_image_analysis_FitParamsClass[] = {
  {"fit", (PyCFunction)__pyx_pf_23realtime_image_analysis_14FitParamsClass_fit, METH_O, 0},
  {0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_FitParamsClass = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_FitParamsClass = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_FitParamsClass = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_FitParamsClass = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_NEWBUFFER)
  0, /*bf_getbuffer*/
  #endif
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_NEWBUFFER)
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_23realtime_image_analysis_FitParamsClass = {
  PyVarObject_HEAD_INIT(0, 0)
  "realtime_image_analysis.FitParamsClass", /*tp_name*/
  sizeof(struct __pyx_obj_23realtime_image_analysis_FitParamsClass), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_23realtime_image_analysis_FitParamsClass, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_FitParamsClass, /*tp_as_number*/
  &__pyx_tp_as_sequence_FitParamsClass, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_FitParamsClass, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_FitParamsClass, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_23realtime_image_analysis_FitParamsClass, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_23realtime_image_analysis_FitParamsClass, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static PyObject *__pyx_tp_new_23realtime_image_analysis_RealtimeAnalyzer(PyTypeObject *t, PyObject *a, PyObject *k) {
  struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *p;
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  p = ((struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)o);
  p->_roi_sz = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)Py_None); Py_INCREF(Py_None);
  p->absdiff_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->cmpdiff_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->absdiff_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->cmpdiff_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->absdiff_im_roi2_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->cmpdiff_im_roi2_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->mask_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->mean_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->cmp_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->mean_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->cmp_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  p->imname2im = Py_None; Py_INCREF(Py_None);
  if (__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___cinit__(o, a, k) < 0) {
    Py_DECREF(o); o = 0;
  }
  return o;
}

static void __pyx_tp_dealloc_23realtime_image_analysis_RealtimeAnalyzer(PyObject *o) {
  struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *p = (struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)o;
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  Py_XDECREF(((PyObject *)p->_roi_sz));
  Py_XDECREF(((PyObject *)p->absdiff_im));
  Py_XDECREF(((PyObject *)p->cmpdiff_im));
  Py_XDECREF(((PyObject *)p->absdiff_im_roi_view));
  Py_XDECREF(((PyObject *)p->cmpdiff_im_roi_view));
  Py_XDECREF(((PyObject *)p->absdiff_im_roi2_view));
  Py_XDECREF(((PyObject *)p->cmpdiff_im_roi2_view));
  Py_XDECREF(((PyObject *)p->mask_im));
  Py_XDECREF(((PyObject *)p->mean_im));
  Py_XDECREF(((PyObject *)p->cmp_im));
  Py_XDECREF(((PyObject *)p->mean_im_roi_view));
  Py_XDECREF(((PyObject *)p->cmp_im_roi_view));
  Py_XDECREF(p->imname2im);
  (*Py_TYPE(o)->tp_free)(o);
}

static int __pyx_tp_traverse_23realtime_image_analysis_RealtimeAnalyzer(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *p = (struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)o;
  if (p->_roi_sz) {
    e = (*v)(((PyObject*)p->_roi_sz), a); if (e) return e;
  }
  if (p->absdiff_im) {
    e = (*v)(((PyObject*)p->absdiff_im), a); if (e) return e;
  }
  if (p->cmpdiff_im) {
    e = (*v)(((PyObject*)p->cmpdiff_im), a); if (e) return e;
  }
  if (p->absdiff_im_roi_view) {
    e = (*v)(((PyObject*)p->absdiff_im_roi_view), a); if (e) return e;
  }
  if (p->cmpdiff_im_roi_view) {
    e = (*v)(((PyObject*)p->cmpdiff_im_roi_view), a); if (e) return e;
  }
  if (p->absdiff_im_roi2_view) {
    e = (*v)(((PyObject*)p->absdiff_im_roi2_view), a); if (e) return e;
  }
  if (p->cmpdiff_im_roi2_view) {
    e = (*v)(((PyObject*)p->cmpdiff_im_roi2_view), a); if (e) return e;
  }
  if (p->mask_im) {
    e = (*v)(((PyObject*)p->mask_im), a); if (e) return e;
  }
  if (p->mean_im) {
    e = (*v)(((PyObject*)p->mean_im), a); if (e) return e;
  }
  if (p->cmp_im) {
    e = (*v)(((PyObject*)p->cmp_im), a); if (e) return e;
  }
  if (p->mean_im_roi_view) {
    e = (*v)(((PyObject*)p->mean_im_roi_view), a); if (e) return e;
  }
  if (p->cmp_im_roi_view) {
    e = (*v)(((PyObject*)p->cmp_im_roi_view), a); if (e) return e;
  }
  if (p->imname2im) {
    e = (*v)(p->imname2im, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_23realtime_image_analysis_RealtimeAnalyzer(PyObject *o) {
  struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *p = (struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer *)o;
  PyObject* tmp;
  tmp = ((PyObject*)p->_roi_sz);
  p->_roi_sz = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_Size *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->absdiff_im);
  p->absdiff_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->cmpdiff_im);
  p->cmpdiff_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->absdiff_im_roi_view);
  p->absdiff_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->cmpdiff_im_roi_view);
  p->cmpdiff_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->absdiff_im_roi2_view);
  p->absdiff_im_roi2_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->cmpdiff_im_roi2_view);
  p->cmpdiff_im_roi2_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->mask_im);
  p->mask_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->mean_im);
  p->mean_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->cmp_im);
  p->cmp_im = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->mean_im_roi_view);
  p->mean_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->cmp_im_roi_view);
  p->cmp_im_roi_view = ((struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u *)Py_None); Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->imname2im);
  p->imname2im = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}

static PyObject *__pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_roi2_radius(PyObject *o, void *x) {
  return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_11roi2_radius___get__(o);
}

static int __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_roi2_radius(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_11roi2_radius___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_clear_threshold(PyObject *o, void *x) {
  return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_15clear_threshold___get__(o);
}

static int __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_clear_threshold(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_15clear_threshold___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_diff_threshold(PyObject *o, void *x) {
  return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_14diff_threshold___get__(o);
}

static int __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_diff_threshold(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_14diff_threshold___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_scale_factor(PyObject *o, void *x) {
  return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_12scale_factor___get__(o);
}

static int __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_scale_factor(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_12scale_factor___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static PyObject *__pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_roi(PyObject *o, void *x) {
  return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_3roi___get__(o);
}

static int __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_roi(PyObject *o, PyObject *v, void *x) {
  if (v) {
    return __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_3roi___set__(o, v);
  }
  else {
    PyErr_SetString(PyExc_NotImplementedError, "__del__");
    return -1;
  }
}

static struct PyMethodDef __pyx_methods_23realtime_image_analysis_RealtimeAnalyzer[] = {
  {"distort", (PyCFunction)__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_distort, METH_VARARGS|METH_KEYWORDS, 0},
  {"do_work", (PyCFunction)__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_do_work, METH_VARARGS|METH_KEYWORDS, __pyx_doc_23realtime_image_analysis_16RealtimeAnalyzer_do_work},
  {"get_image_view", (PyCFunction)__pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer_get_image_view, METH_VARARGS|METH_KEYWORDS, 0},
  {0, 0, 0, 0}
};

static struct PyGetSetDef __pyx_getsets_23realtime_image_analysis_RealtimeAnalyzer[] = {
  {"roi2_radius", __pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_roi2_radius, __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_roi2_radius, 0, 0},
  {"clear_threshold", __pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_clear_threshold, __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_clear_threshold, 0, 0},
  {"diff_threshold", __pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_diff_threshold, __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_diff_threshold, 0, 0},
  {"scale_factor", __pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_scale_factor, __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_scale_factor, 0, 0},
  {"roi", __pyx_getprop_23realtime_image_analysis_16RealtimeAnalyzer_roi, __pyx_setprop_23realtime_image_analysis_16RealtimeAnalyzer_roi, 0, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_RealtimeAnalyzer = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_RealtimeAnalyzer = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_RealtimeAnalyzer = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_RealtimeAnalyzer = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_NEWBUFFER)
  0, /*bf_getbuffer*/
  #endif
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_NEWBUFFER)
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_23realtime_image_analysis_RealtimeAnalyzer = {
  PyVarObject_HEAD_INIT(0, 0)
  "realtime_image_analysis.RealtimeAnalyzer", /*tp_name*/
  sizeof(struct __pyx_obj_23realtime_image_analysis_RealtimeAnalyzer), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_23realtime_image_analysis_RealtimeAnalyzer, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_RealtimeAnalyzer, /*tp_as_number*/
  &__pyx_tp_as_sequence_RealtimeAnalyzer, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_RealtimeAnalyzer, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_RealtimeAnalyzer, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_23realtime_image_analysis_RealtimeAnalyzer, /*tp_traverse*/
  __pyx_tp_clear_23realtime_image_analysis_RealtimeAnalyzer, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_23realtime_image_analysis_RealtimeAnalyzer, /*tp_methods*/
  0, /*tp_members*/
  __pyx_getsets_23realtime_image_analysis_RealtimeAnalyzer, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_23realtime_image_analysis_16RealtimeAnalyzer___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_23realtime_image_analysis_RealtimeAnalyzer, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static struct PyMethodDef __pyx_methods[] = {
  {"py_fit_params", (PyCFunction)__pyx_pf_23realtime_image_analysis_py_fit_params, METH_O, 0},
  {"fit_slope", (PyCFunction)__pyx_pf_23realtime_image_analysis_fit_slope, METH_O, 0},
  {"bg_help_slow", (PyCFunction)__pyx_pf_23realtime_image_analysis_bg_help_slow, METH_VARARGS|METH_KEYWORDS, 0},
  {"bg_help", (PyCFunction)__pyx_pf_23realtime_image_analysis_bg_help, METH_VARARGS|METH_KEYWORDS, 0},
  {"do_bg_maint", (PyCFunction)__pyx_pf_23realtime_image_analysis_do_bg_maint, METH_VARARGS|METH_KEYWORDS, __pyx_doc_23realtime_image_analysis_do_bg_maint},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    "realtime_image_analysis",
    0, /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp___cinit__, __pyx_k___cinit__, sizeof(__pyx_k___cinit__), 0, 1, 1},
  {&__pyx_kp___dealloc__, __pyx_k___dealloc__, sizeof(__pyx_k___dealloc__), 0, 1, 1},
  {&__pyx_kp_fit, __pyx_k_fit, sizeof(__pyx_k_fit), 0, 1, 1},
  {&__pyx_kp___init__, __pyx_k___init__, sizeof(__pyx_k___init__), 0, 1, 1},
  {&__pyx_kp_distort, __pyx_k_distort, sizeof(__pyx_k_distort), 0, 1, 1},
  {&__pyx_kp_do_work, __pyx_k_do_work, sizeof(__pyx_k_do_work), 0, 1, 1},
  {&__pyx_kp_get_image_view, __pyx_k_get_image_view, sizeof(__pyx_k_get_image_view), 0, 1, 1},
  {&__pyx_kp_time, __pyx_k_time, sizeof(__pyx_k_time), 1, 1, 1},
  {&__pyx_kp_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 1, 1, 1},
  {&__pyx_kp_nx, __pyx_k_nx, sizeof(__pyx_k_nx), 0, 1, 1},
  {&__pyx_kp_warnings, __pyx_k_warnings, sizeof(__pyx_k_warnings), 1, 1, 1},
  {&__pyx_kp_1, __pyx_k_1, sizeof(__pyx_k_1), 1, 1, 1},
  {&__pyx_kp_FastImage, __pyx_k_FastImage, sizeof(__pyx_k_FastImage), 0, 1, 1},
  {&__pyx_kp_nan, __pyx_k_nan, sizeof(__pyx_k_nan), 1, 1, 1},
  {&__pyx_kp_FitParamsError, __pyx_k_FitParamsError, sizeof(__pyx_k_FitParamsError), 0, 1, 1},
  {&__pyx_kp_Exception, __pyx_k_Exception, sizeof(__pyx_k_Exception), 1, 1, 1},
  {&__pyx_kp_3, __pyx_k_3, sizeof(__pyx_k_3), 0, 1, 0},
  {&__pyx_kp_IppError, __pyx_k_IppError, sizeof(__pyx_k_IppError), 1, 1, 1},
  {&__pyx_kp_set_val, __pyx_k_set_val, sizeof(__pyx_k_set_val), 1, 1, 1},
  {&__pyx_kp_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 1, 0},
  {&__pyx_kp_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 1, 0},
  {&__pyx_kp_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 1, 0},
  {&__pyx_kp_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 1, 0},
  {&__pyx_kp_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 1, 0},
  {&__pyx_kp_roi, __pyx_k_roi, sizeof(__pyx_k_roi), 1, 1, 1},
  {&__pyx_kp__helper, __pyx_k__helper, sizeof(__pyx_k__helper), 1, 1, 1},
  {&__pyx_kp_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 1, 1, 1},
  {&__pyx_kp_warn, __pyx_k_warn, sizeof(__pyx_k_warn), 1, 1, 1},
  {&__pyx_kp_stacklevel, __pyx_k_stacklevel, sizeof(__pyx_k_stacklevel), 1, 1, 1},
  {&__pyx_kp_append, __pyx_k_append, sizeof(__pyx_k_append), 1, 1, 1},
  {&__pyx_kp__scale_factor, __pyx_k__scale_factor, sizeof(__pyx_k__scale_factor), 1, 1, 1},
  {&__pyx_kp_toself_add_weighted, __pyx_k_toself_add_weighted, sizeof(__pyx_k_toself_add_weighted), 1, 1, 1},
  {&__pyx_kp_19, __pyx_k_19, sizeof(__pyx_k_19), 1, 1, 1},
  {&__pyx_kp_20, __pyx_k_20, sizeof(__pyx_k_20), 1, 1, 1},
  {&__pyx_kp_toself_square, __pyx_k_toself_square, sizeof(__pyx_k_toself_square), 1, 1, 1},
  {&__pyx_kp_get_square_put, __pyx_k_get_square_put, sizeof(__pyx_k_get_square_put), 1, 1, 1},
  {&__pyx_kp_get_subtracted_put, __pyx_k_get_subtracted_put, sizeof(__pyx_k_get_subtracted_put), 1, 1, 1},
  {&__pyx_kp_toself_multiply, __pyx_k_toself_multiply, sizeof(__pyx_k_toself_multiply), 1, 1, 1},
  {&__pyx_kp_get_compare_put, __pyx_k_get_compare_put, sizeof(__pyx_k_get_compare_put), 1, 1, 1},
  {&__pyx_kp_CmpGreater, __pyx_k_CmpGreater, sizeof(__pyx_k_CmpGreater), 1, 1, 1},
  {&__pyx_kp_set_val_masked, __pyx_k_set_val_masked, sizeof(__pyx_k_set_val_masked), 1, 1, 1},
  {&__pyx_kp_2, __pyx_k_2, sizeof(__pyx_k_2), 1, 0, 0},
  {&__pyx_kp_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 0, 0},
  {&__pyx_kp_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 0},
  {&__pyx_kp_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 0, 0},
  {&__pyx_kp_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 0, 0},
  {&__pyx_kp_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 0, 0},
  {&__pyx_kp_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 0, 0},
  {&__pyx_kp_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 0, 0},
  {&__pyx_kp_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 0, 0},
  {&__pyx_kp_17, __pyx_k_17, sizeof(__pyx_k_17), 0, 0, 0},
  {&__pyx_kp_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 0, 0},
  {0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_Exception = __Pyx_GetName(__pyx_b, __pyx_kp_Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_ValueError = __Pyx_GetName(__pyx_b, __pyx_kp_ValueError); if (!__pyx_builtin_ValueError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitGlobals(void) {
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_21 = PyInt_FromLong(21); if (unlikely(!__pyx_int_21)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_200 = PyInt_FromLong(200); if (unlikely(!__pyx_int_200)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_25 = PyInt_FromLong(25); if (unlikely(!__pyx_int_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initrealtime_image_analysis(void); /*proto*/
PyMODINIT_FUNC initrealtime_image_analysis(void)
#else
PyMODINIT_FUNC PyInit_realtime_image_analysis(void); /*proto*/
PyMODINIT_FUNC PyInit_realtime_image_analysis(void)
#endif
{
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  double __pyx_3;
  PyObject *__pyx_4 = 0;
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Libary function declarations ---*/
  __pyx_init_filenames();
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("realtime_image_analysis", __pyx_methods, 0, 0, PYTHON_API_VERSION);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (!__pyx_m) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  #if PY_MAJOR_VERSION < 3
  Py_INCREF(__pyx_m);
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME);
  if (!__pyx_b) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_skip_dispatch = 0;
  /*--- Global init code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  if (PyType_Ready(&__pyx_type_23realtime_image_analysis_FitParamsClass) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttrString(__pyx_m, "FitParamsClass", (PyObject *)&__pyx_type_23realtime_image_analysis_FitParamsClass) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_23realtime_image_analysis_FitParamsClass = &__pyx_type_23realtime_image_analysis_FitParamsClass;
  if (PyType_Ready(&__pyx_type_23realtime_image_analysis_RealtimeAnalyzer) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttrString(__pyx_m, "RealtimeAnalyzer", (PyObject *)&__pyx_type_23realtime_image_analysis_RealtimeAnalyzer) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_23realtime_image_analysis_RealtimeAnalyzer = &__pyx_type_23realtime_image_analysis_RealtimeAnalyzer;
  /*--- Type import code ---*/
  __pyx_ptype_6motmot_9FastImage_9FastImage_Size = __Pyx_ImportType("motmot.FastImage.FastImage", "Size", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_Size)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_Size)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_Point = __Pyx_ImportType("motmot.FastImage.FastImage", "Point", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_Point)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_Point)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_FastImageBase = __Pyx_ImportType("motmot.FastImage.FastImage", "FastImageBase", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImageBase)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_FastImageBase)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_GetVtable(__pyx_ptype_6motmot_9FastImage_9FastImage_FastImageBase->tp_dict, &__pyx_vtabptr_6motmot_9FastImage_9FastImage_FastImageBase) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f = __Pyx_ImportType("motmot.FastImage.FastImage", "FastImage32f", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage32f)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_GetVtable(__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage32f->tp_dict, &__pyx_vtabptr_6motmot_9FastImage_9FastImage_FastImage32f) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u = __Pyx_ImportType("motmot.FastImage.FastImage", "FastImage8u", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_FastImage8u)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__Pyx_GetVtable(__pyx_ptype_6motmot_9FastImage_9FastImage_FastImage8u->tp_dict, &__pyx_vtabptr_6motmot_9FastImage_9FastImage_FastImage8u) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_LazyOp = __Pyx_ImportType("motmot.FastImage.FastImage", "LazyOp", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_LazyOp)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_LazyOp)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_square = __Pyx_ImportType("motmot.FastImage.FastImage", "square", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_square)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_square)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_sqrt = __Pyx_ImportType("motmot.FastImage.FastImage", "sqrt", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_sqrt)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_sqrt)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_blend_with = __Pyx_ImportType("motmot.FastImage.FastImage", "blend_with", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_blend_with)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_blend_with)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_convert_to_8u = __Pyx_ImportType("motmot.FastImage.FastImage", "convert_to_8u", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_convert_to_8u)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_convert_to_8u)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_6motmot_9FastImage_9FastImage_convert_to_32f = __Pyx_ImportType("motmot.FastImage.FastImage", "convert_to_32f", sizeof(struct __pyx_obj_6motmot_9FastImage_9FastImage_convert_to_32f)); if (unlikely(!__pyx_ptype_6motmot_9FastImage_9FastImage_convert_to_32f)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":9
 * # processing images on one CPU while grabbing them on another.
 * 
 * import time             # <<<<<<<<<<<<<<
 * import numpy as nx
 * import warnings
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_time, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_time, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":10
 * 
 * import time
 * import numpy as nx             # <<<<<<<<<<<<<<
 * import warnings
 * 
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_numpy, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_nx, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":11
 * import time
 * import numpy as nx
 * import warnings             # <<<<<<<<<<<<<<
 * 
 * #cimport FastImage
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_warnings, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_warnings, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":15
 * #cimport FastImage
 * cimport motmot.FastImage.FastImage as FastImage
 * import motmot.FastImage.FastImage as FastImage             # <<<<<<<<<<<<<<
 * 
 * cdef double nan
 */
  __pyx_1 = PyList_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_2);
  PyList_SET_ITEM(__pyx_1, 0, __pyx_kp_2);
  __pyx_2 = __Pyx_Import(__pyx_kp_1, ((PyObject *)__pyx_1)); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_FastImage, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":18
 * 
 * cdef double nan
 * nan = nx.nan             # <<<<<<<<<<<<<<
 * 
 * cimport c_lib
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_nx); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_nan); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_23realtime_image_analysis_nan = __pyx_3;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/realtime_image_analysis.pyx":65
 *   print
 * 
 * class FitParamsError(Exception):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_builtin_Exception);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_builtin_Exception);
  __pyx_4 = __Pyx_CreateClass(((PyObject *)__pyx_2), ((PyObject *)__pyx_1), __pyx_kp_FitParamsError, "realtime_image_analysis"); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_FitParamsError, __pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/home/astraw/src/motmot/realtime_image_analysis/src/c_lib.pxd":1
 * #emacs, this is -*-Python-*- mode             # <<<<<<<<<<<<<<
 * 
 * cdef extern from "stdlib.h":
 */
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  __Pyx_AddTraceback("realtime_image_analysis");
  #if PY_MAJOR_VERSION >= 3
  return NULL;
  #endif
}

static const char *__pyx_filenames[] = {
  "realtime_image_analysis.pyx",
  "motmot.FastImage.FastImage.pxd",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static INLINE int __Pyx_SplitStarArg(
    PyObject **args, 
    Py_ssize_t nargs,
    PyObject **args2)
{
    PyObject *args1 = 0;
    args1 = PyTuple_GetSlice(*args, 0, nargs);
    if (!args1) {
        *args2 = 0;
        return -1;
    }
    *args2 = PyTuple_GetSlice(*args, nargs, PyTuple_GET_SIZE(*args));
    if (!*args2) {
        Py_DECREF(args1);
        return -1;
    }
    *args = args1;
    return 0;
}

static int __Pyx_CheckKeywordStrings(
    PyObject *kwdict,
    const char* function_name,
    int kw_allowed)
{
    PyObject* key = 0;
    Py_ssize_t pos = 0;
    while (PyDict_Next(kwdict, &pos, &key, 0)) {
        #if PY_MAJOR_VERSION < 3
        if (unlikely(!PyString_Check(key))) {
        #else
        if (unlikely(!PyUnicode_Check(key))) {
        #endif
            PyErr_Format(PyExc_TypeError,
                         "%s() keywords must be strings", function_name);
            return 0;
        }
    }
    if (unlikely(!kw_allowed) && unlikely(key)) {
        PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION < 3
                     "'%s' is an invalid keyword argument for this function",
                     PyString_AsString(key));
        #else
                     "'%U' is an invalid keyword argument for this function",
                     key);
        #endif
        return 0;
    }
    return 1;
}

static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed, char *name, int exact) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (none_allowed && obj == Py_None) return 1;
    else if (exact) {
        if (Py_TYPE(obj) == type) return 1;
    }
    else {
        if (PyObject_TypeCheck(obj, type)) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%s' has incorrect type (expected %s, got %s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

static INLINE void __Pyx_RaiseArgtupleTooLong(
    Py_ssize_t num_expected,
    Py_ssize_t num_found)
{
    const char* error_message =
    #if PY_VERSION_HEX < 0x02050000
        "function takes at most %d positional arguments (%d given)";
    #else
        "function takes at most %zd positional arguments (%zd given)";
    #endif
    PyErr_Format(PyExc_TypeError, error_message, num_expected, num_found);
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = PyObject_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunction(__import__, "OOOO",
        name, global_dict, empty_dict, list);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;

    #if PY_MAJOR_VERSION < 3
    py_modname = PyString_FromString(modname);
    #else
    py_modname = PyUnicode_FromString(modname);
    #endif
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    result = PyClass_New(bases, dict, name);
    #else
    result = PyObject_CallFunctionObjArgs((PyObject *)&PyType_Type, name, bases, dict, NULL);
    #endif
bad:
    Py_XDECREF(py_modname);
    return result;
}

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                type = 0;
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) Py_TYPE(type);
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }
    PyErr_Restore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

#if PY_MAJOR_VERSION < 3
static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject("stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}

static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject *f;
    PyObject* v;
    int i;
    
    if (!(f = __Pyx_GetStdout()))
        return -1;
    for (i=0; i < PyTuple_GET_SIZE(arg_tuple); i++) {
        if (PyFile_SoftSpace(f, 1)) {
            if (PyFile_WriteString(" ", f) < 0)
                return -1;
        }
        v = PyTuple_GET_ITEM(arg_tuple, i);
        if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
            return -1;
        if (PyString_Check(v)) {
            char *s = PyString_AsString(v);
            Py_ssize_t len = PyString_Size(v);
            if (len > 0 &&
                isspace(Py_CHARMASK(s[len-1])) &&
                s[len-1] != ' ')
                    PyFile_SoftSpace(f, 0);
        }
    }
    if (newline) {
        if (PyFile_WriteString("\n", f) < 0)
            return -1;
        PyFile_SoftSpace(f, 0);
    }
    return 0;
}

#else /* Python 3 has a print function */
static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject* kwargs = 0;
    PyObject* result = 0;
    PyObject* end_string;
    if (!__pyx_print) {
        __pyx_print = PyObject_GetAttrString(__pyx_b, "print");
        if (!__pyx_print)
            return -1;
    }
    if (!newline) {
        if (!__pyx_print_kwargs) {
            __pyx_print_kwargs = PyDict_New();
            if (!__pyx_print_kwargs)
                return -1;
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (!end_string)
                return -1;
            if (PyDict_SetItemString(__pyx_print_kwargs, "end", end_string) < 0) {
                Py_DECREF(end_string);
                return -1;
            }
            Py_DECREF(end_string);
        }
        kwargs = __pyx_print_kwargs;
    }
    result = PyObject_Call(__pyx_print, arg_tuple, kwargs);
    if (!result)
        return -1;
    Py_DECREF(result);
    return 0;
}
#endif

static int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (!type) {
        PyErr_Format(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (obj == Py_None || PyObject_TypeCheck(obj, type))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %s to %s",
        Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

static PyObject *__Pyx_UnpackItem(PyObject *iter, Py_ssize_t index) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred()) {
            PyErr_Format(PyExc_ValueError,
                #if PY_VERSION_HEX < 0x02050000
                    "need more than %d values to unpack", (int)index);
                #else
                    "need more than %zd values to unpack", index);
                #endif
        }
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        PyErr_SetString(PyExc_ValueError, "too many values to unpack");
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

#ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(char *module_name, char *class_name,
    long size)
{
    PyObject *py_module = 0;
    PyObject *result = 0;
    PyObject *py_name = 0;

    #if PY_MAJOR_VERSION < 3
    py_name = PyString_FromString(module_name);
    #else
    py_name = PyUnicode_FromString(module_name);
    #endif
    if (!py_name)
        goto bad;

    py_module = __Pyx_ImportModule(module_name);
    if (!py_module)
        goto bad;
    result = PyObject_GetAttrString(py_module, class_name);
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError, 
            "%s.%s is not a type object",
            module_name, class_name);
        goto bad;
    }
    if (((PyTypeObject *)result)->tp_basicsize != size) {
        PyErr_Format(PyExc_ValueError, 
            "%s.%s does not appear to be the correct type object",
            module_name, class_name);
        goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(py_name);
    Py_XDECREF(result);
    return 0;
}
#endif

#ifndef __PYX_HAVE_RT_ImportModule
#define __PYX_HAVE_RT_ImportModule
static PyObject *__Pyx_ImportModule(char *name) {
    PyObject *py_name = 0;
    PyObject *py_module = 0;

    #if PY_MAJOR_VERSION < 3
    py_name = PyString_FromString(name);
    #else
    py_name = PyUnicode_FromString(name);
    #endif
    if (!py_name)
        goto bad;
    py_module = PyImport_Import(py_name);
    Py_DECREF(py_name);
    return py_module;
bad:
    Py_XDECREF(py_name);
    return 0;
}
#endif

static int __Pyx_GetVtable(PyObject *dict, void *vtabptr) {
    int result;
    PyObject *pycobj;
    
    pycobj = PyMapping_GetItemString(dict, "__pyx_vtable__");
    if (!pycobj)
        goto bad;
    *(void **)vtabptr = PyCObject_AsVoidPtr(pycobj);
    if (!*(void **)vtabptr)
        goto bad;
    result = 0;
    goto done;

bad:
    result = -1;
done:
    Py_XDECREF(pycobj);
    return result;
}

#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(const char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;

    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(__pyx_filename);
    #else
    py_srcfile = PyUnicode_FromString(__pyx_filename);
    #endif
    if (!py_srcfile) goto bad;
    if (__pyx_clineno) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    #if PY_MAJOR_VERSION < 3
    empty_string = PyString_FromStringAndSize("", 0);
    #else
    empty_string = PyBytes_FromStringAndSize("", 0);
    #endif
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        #if PY_MAJOR_VERSION >= 3
        0,            /*int kwonlyargcount,*/
        #endif
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        __pyx_empty_tuple,  /*PyObject *consts,*/
        __pyx_empty_tuple,  /*PyObject *names,*/
        __pyx_empty_tuple,  /*PyObject *varnames,*/
        __pyx_empty_tuple,  /*PyObject *freevars,*/
        __pyx_empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_Get(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode && (!t->is_identifier)) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_identifier || (t->is_unicode && t->intern)) {
            *t->p = PyUnicode_InternFromString(t->s);
        } else if (t->is_unicode) {
            *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

/* Type Conversion Functions */

static INLINE Py_ssize_t __pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}

static INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   if (x == Py_True) return 1;
   else if (x == Py_False) return 0;
   else return PyObject_IsTrue(x);
}

static INLINE PY_LONG_LONG __pyx_PyInt_AsLongLong(PyObject* x) {
    if (PyInt_CheckExact(x)) {
        return PyInt_AS_LONG(x);
    }
    else if (PyLong_CheckExact(x)) {
        return PyLong_AsLongLong(x);
    }
    else {
        PY_LONG_LONG val;
        PyObject* tmp = PyNumber_Int(x); if (!tmp) return (PY_LONG_LONG)-1;
        val = __pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE unsigned PY_LONG_LONG __pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
    if (PyInt_CheckExact(x)) {
        long val = PyInt_AS_LONG(x);
        if (unlikely(val < 0)) {
            PyErr_SetString(PyExc_TypeError, "Negative assignment to unsigned type.");
            return (unsigned PY_LONG_LONG)-1;
        }
        return val;
    }
    else if (PyLong_CheckExact(x)) {
        return PyLong_AsUnsignedLongLong(x);
    }
    else {
        PY_LONG_LONG val;
        PyObject* tmp = PyNumber_Int(x); if (!tmp) return (PY_LONG_LONG)-1;
        val = __pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}


static INLINE unsigned char __pyx_PyInt_unsigned_char(PyObject* x) {
    if (sizeof(unsigned char) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        unsigned char val = (unsigned char)long_val;
        if (unlikely((val != long_val)  || (long_val < 0))) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to unsigned char");
            return (unsigned char)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE unsigned short __pyx_PyInt_unsigned_short(PyObject* x) {
    if (sizeof(unsigned short) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        unsigned short val = (unsigned short)long_val;
        if (unlikely((val != long_val)  || (long_val < 0))) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to unsigned short");
            return (unsigned short)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE char __pyx_PyInt_char(PyObject* x) {
    if (sizeof(char) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        char val = (char)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to char");
            return (char)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE short __pyx_PyInt_short(PyObject* x) {
    if (sizeof(short) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        short val = (short)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to short");
            return (short)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE int __pyx_PyInt_int(PyObject* x) {
    if (sizeof(int) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        int val = (int)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to int");
            return (int)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE long __pyx_PyInt_long(PyObject* x) {
    if (sizeof(long) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        long val = (long)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to long");
            return (long)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed char __pyx_PyInt_signed_char(PyObject* x) {
    if (sizeof(signed char) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed char val = (signed char)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed char");
            return (signed char)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed short __pyx_PyInt_signed_short(PyObject* x) {
    if (sizeof(signed short) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed short val = (signed short)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed short");
            return (signed short)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed int __pyx_PyInt_signed_int(PyObject* x) {
    if (sizeof(signed int) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed int val = (signed int)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed int");
            return (signed int)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed long __pyx_PyInt_signed_long(PyObject* x) {
    if (sizeof(signed long) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed long val = (signed long)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed long");
            return (signed long)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE long double __pyx_PyInt_long_double(PyObject* x) {
    if (sizeof(long double) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        long double val = (long double)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to long double");
            return (long double)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

